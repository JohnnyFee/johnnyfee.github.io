<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>jQuery Defered | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="javascript">
    <meta name="description" content="Deferred Object PatternThe Deferred Object pattern is the key pattern used by a number of JavaScript applications for decoupling of the request from the code that handles the results of the request an">
<meta property="og:type" content="article">
<meta property="og:title" content="jQuery Defered">
<meta property="og:url" content="http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="Deferred Object PatternThe Deferred Object pattern is the key pattern used by a number of JavaScript applications for decoupling of the request from the code that handles the results of the request an">
<meta property="og:updated_time" content="2017-04-21T12:57:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jQuery Defered">
<meta name="twitter:description" content="Deferred Object PatternThe Deferred Object pattern is the key pattern used by a number of JavaScript applications for decoupling of the request from the code that handles the results of the request an">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.17">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">jQuery Defered</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">jQuery Defered</h1>
        <h5 class="subtitle">
            
                <time datetime="2014-10-22T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2014-10-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript/">JavaScript</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Deferred-Object-Pattern"><span class="post-toc-text">Deferred Object Pattern</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Register-Success-Callback-Using-deferred-done"><span class="post-toc-text">Register Success Callback Using deferred.done()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Register-Failure-Callback-Using-deferred-fail"><span class="post-toc-text">Register Failure Callback Using deferred.fail()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Register-Progress-Callback-Using-deferred-progress"><span class="post-toc-text">Register Progress Callback Using deferred.progress()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Simpler-Callback-registration-with-then"><span class="post-toc-text">Simpler Callback registration with .then()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Synchronizing-Multiple-Asynchronous-Events-with-when"><span class="post-toc-text">Synchronizing Multiple Asynchronous Events with $.when()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Resolve-a-Deferred-Object"><span class="post-toc-text">Resolve a Deferred Object</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Reject-a-Deferred-Object"><span class="post-toc-text">Reject a Deferred Object</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Use-of-Promise"><span class="post-toc-text">Use of Promise</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-jquery-defered"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">jQuery Defered</h1>
        <div class="post-meta">
            <time class="post-time" title="2014-10-23 00:00:00" datetime="2014-10-22T16:00:00.000Z"  itemprop="datePublished">2014-10-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript/">JavaScript</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Deferred-Object-Pattern"><a href="#Deferred-Object-Pattern" class="headerlink" title="Deferred Object Pattern"></a>Deferred Object Pattern</h2><p>The Deferred Object pattern is the key pattern used by a number of JavaScript applications for decoupling of the request from the code that handles the results of the request and allows multiple callbacks to be attached upon notification of a result. To achieve such a decoupling, the Deferred Object provides functions that allow the callback functions to be registered for handling the success, failure, or the progress of the request. Deferred Object framework is available as part of the jQuery library.<br>Here’s how to create a deferred object in jQuery:</p>
<a id="more"></a>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> deferred = $.Deferred();</div><div class="line"><span class="comment">// var deferred =  new Deferred();</span></div><div class="line"><span class="comment">// var deferred = jQuery.Deferred();</span></div></pre></td></tr></table></figure>
<h3 id="Register-Success-Callback-Using-deferred-done"><a href="#Register-Success-Callback-Using-deferred-done" class="headerlink" title="Register Success Callback Using deferred.done()"></a>Register Success Callback Using deferred.done()</h3><p>The <code>.done()</code> function allows a callback function to be registered with the Deferred Object. This callback function will be called once the request is successfully completed when <code>.resolve()</code> is called on the Deferred Object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">deferred.done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Success callback: "</span> + data);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Register-Failure-Callback-Using-deferred-fail"><a href="#Register-Failure-Callback-Using-deferred-fail" class="headerlink" title="Register Failure Callback Using deferred.fail()"></a>Register Failure Callback Using deferred.fail()</h3><p>The <code>.fail()</code> function allows the registration of a callback that will be called if the request fails with any error when <code>.reject()</code> is called on the Deferred Object. The function can provide the appropriate error code and message that describes the error encountered.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">deferred.fail(<span class="function"><span class="keyword">function</span>(<span class="params">errCode, errMsg</span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"Failure callback: "</span> + errCode + <span class="string">" - "</span> + errMsg);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Register-Progress-Callback-Using-deferred-progress"><a href="#Register-Progress-Callback-Using-deferred-progress" class="headerlink" title="Register Progress Callback Using deferred.progress()"></a>Register Progress Callback Using deferred.progress()</h3><p>The <code>.progress()</code> function provides the option to update the caller of the progress of the request. The callback function can be called multiple times during the lifetime of the request while <code>.notify()</code> is being called on the Deferred Object. In contrast, the <code>.done()</code> and <code>.fail()</code> callbacks are executed only once per lifecycle of the request.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">deferred.progress(<span class="function"><span class="keyword">function</span>(<span class="params">percentage</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Progress callback: "</span> + percentage);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>In addition to using the Deferred Object to indicate success or failure of the request, it can be used to indicate the status of the request as well. The callback function that needs to be provided with the status update of the request can be registered using the <code>.progress()</code> or using the third parameter of the <code>.then()</code> function.</p>
<p>To be able to update the status by calling the progress callback registered, the Deferred Object provides the <code>.notify()</code> function that takes the progress update parameters as arguments. For example, this callback can be used to update the UI elements such as the progress bar for providing feedback to the user.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">progressBar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> deferred = $.Deferred();</div><div class="line"></div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">var</span> intervalId = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        deferred.notify(++i);</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">99</span>) &#123;</div><div class="line">                        clearInterval(intervalId);</div><div class="line">                &#125;</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> deferred.promise();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> promise = progressBar();</div><div class="line"></div><div class="line">promise.progress(<span class="function"><span class="keyword">function</span>(<span class="params">percentage</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(percentage + <span class="string">"% completed"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The progress callback function can be called multiple times during the lifetime of the request. In contrast, the <code>deferred.resolve()</code> and <code>deferred.reject()</code> functions are only executed once per the lifecycle of the request.</p>
<p>In the following simple example, we can see the whole picture of how the Deferred Object is used.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestDB</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 1 - create the Deferred</span></div><div class="line">    <span class="keyword">var</span> deferred = $.Deferred();</div><div class="line"></div><div class="line">    XMLHttpRequest xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">    xhr.open(<span class="string">"GET"</span>, <span class="string">"/api/contact"</span>, <span class="literal">true</span>);</div><div class="line">    xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt;= <span class="number">300</span>)</div><div class="line">                            || xhr.status == <span class="number">304</span>) &#123;</div><div class="line">                            <span class="comment">// 3a - triggers the .then() or</span></div><div class="line">                            <span class="comment">// .done() callbacks</span></div><div class="line">                            <span class="keyword">var</span> response = &#123; <span class="attr">name</span>: <span class="string">"O'reilly"</span> &#125;;</div><div class="line">                            deferred.resolve(response);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="comment">// 3b - triggers the .fail() callback with</span></div><div class="line">                            <span class="comment">// an error code and a message</span></div><div class="line">                            deferred.reject(<span class="number">404</span>, <span class="string">"File not found."</span>);</div><div class="line">                    &#125;</div><div class="line">            &#125;</div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line">    xhr.send();</div><div class="line"></div><div class="line">    <span class="comment">// 2 - return the promise right away</span></div><div class="line">    <span class="keyword">return</span> deferred.promise();</div><div class="line">&#125;</div><div class="line"></div><div class="line">$.when(RequestDB()).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">    <span class="comment">// 3a1 - access to returned parameters</span></div><div class="line">    <span class="built_in">console</span>.log(data.name);</div><div class="line">&#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">errCode, errMsg</span>) </span>&#123;</div><div class="line">    <span class="comment">// 3b1 - access to fail messages</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Failure callback: "</span> + errCode + <span class="string">" - "</span> + errMsg);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>When the <code>requestDB()</code> function is called by the <code>$.when()</code> function, there are four steps expected to happen:</p>
<ol>
<li>We create a Deferred Object that can then facilitate callbacks to be fired based on the expected results from the program.</li>
<li>Once the Deferred Object is created, we return this object immediately so the consumer application can attach different utility functions, such as <code>.done()</code>, <code>.then()</code>, or <code>.fail()</code>, to handle its outcome.</li>
<li>If the application returns a result successfully from the source, then we have to let the consumer application know about this outcome. In this case, we call the <code>.resolve()</code> function with or without return parameter <code>response</code>.<pre><code>1.  Once the Deferred Object resolves the result with a success outcome and passes any parameters to a handling function we can access these parameters (including the `response` parameter) from the anonymous callback functions in `.done()` or `.then()`. In our case, the `response` JSON object holds the return data, and we should be able to access the key/value pairs within the callback function.
2.  If the outcome results in a failure, we can also let the consumer application know about it. It is good practice to pass descriptive messages to the consumer application about what went wrong while processing the request. In our case, we pass an error code and a message to the consumer application to handle the result accordingly.
3.  if we receive a failure from our request, then the `.fail()` function is able to pass us the parameters that are dispatched from `.reject()`. In our case, we can access the error code and the message from our anonymous function in order to handle this failure with a friendlier error message to the users in the UI.
</code></pre></li>
</ol>
<h3 id="Simpler-Callback-registration-with-then"><a href="#Simpler-Callback-registration-with-then" class="headerlink" title="Simpler Callback registration with .then()"></a>Simpler Callback registration with .then()</h3><p>The <code>.then()</code> function provides a convenient way to specify the success, fail, and progress callback functions in one place. All of the callback parameters are optional, which allows the developer to declare the callbacks only for the functions that are of interest. The <code>.then()</code> function is fired when the <code>.resolve()</code> or <code>.reject()</code> functions are called on the Deferred Object.</p>
<p>The structure of the <code>deferred.then()</code> function is as follows:</p>
<pre><code>deferred.then(successCallback, failCallback, progressCallback);
</code></pre><p>Combining the example given for <code>.done()</code>, <code>.fail()</code>, and <code>.progress()</code>, to use the <code>.then()</code> function, we would be able to achieve an equivalent behavior as shown here:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">deferred.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Success callback"</span>);</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">errCode, errMsg</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Failure callback: "</span> + errCode + <span class="string">" - "</span> + errMsg);</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Progress callback"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Synchronizing-Multiple-Asynchronous-Events-with-when"><a href="#Synchronizing-Multiple-Asynchronous-Events-with-when" class="headerlink" title="Synchronizing Multiple Asynchronous Events with $.when()"></a>Synchronizing Multiple Asynchronous Events with $.when()</h3><p>You can also synchronize one or more events using deferred’s <code>$.when()</code> helper function, as in the following example. The <code>$.when()</code> function waits for all its tasks to be executed, and once supplied deferred events are resolved, depending on the events’ success and failure states, <code>.then()</code> or <code>.fail()</code> callbacks will be fired. If one of the tasks fails, then <code>.fail()</code> will be invoked.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doThis</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> $.get(<span class="string">'this.html'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doThat</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> $.get(<span class="string">'that.html'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$.when(doThis(), doThat()).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Both events are successful."</span>);</div><div class="line">&#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">errCode, errMsg</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"One or more events are failed."</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Resolve-a-Deferred-Object"><a href="#Resolve-a-Deferred-Object" class="headerlink" title="Resolve a Deferred Object"></a>Resolve a Deferred Object</h3><p>The potential of the Deferred Object is seen by allowing the success callback(s) to be called when the request is completed successfully.</p>
<p>The Deferred Object can be used to invoke the success callback(s) by calling the <code>.resolve()</code> function on the Deferred Object. The <code>.resolve()</code> function can be used to provide the callback function(s) with the arguments that communicate the artifacts of the request.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> deferred =  <span class="keyword">new</span> Deferred();</div><div class="line"></div><div class="line"><span class="comment">// register the success callback with two args</span></div><div class="line">deferred.done(<span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123;</div><div class="line">        alert(<span class="string">"Success callback with two artifacts"</span>);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// Do some processing resulting in artifact1 and artifact2</span></div><div class="line">        .</div><div class="line">        .</div><div class="line">        .</div><div class="line"><span class="comment">// Calling the resolve function on the Deferred Object with two artifacts as</span></div><div class="line"><span class="comment">// arguments will trigger the success callback to be called with the same.</span></div><div class="line">deferred.resolve(artifact1, artifact2);</div></pre></td></tr></table></figure>
<h3 id="Reject-a-Deferred-Object"><a href="#Reject-a-Deferred-Object" class="headerlink" title="Reject a Deferred Object"></a>Reject a Deferred Object</h3><p>Similarly, the other important usage of the Deferred Object is to notify any interested parties to the failure of an async request.</p>
<p>The Deferred Object can be used to invoke the failure callback(s) by calling the <code>.reject()</code> function on the Deferred Object. Similar to the success callback, the <code>.reject()</code> function can be used to provide the failure callback(s) with error codes and error messages that describe the cause of the failure.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> deferred =  <span class="keyword">new</span> Deferred();</div><div class="line"></div><div class="line"><span class="comment">// register the failure callback with the errorCode and errorMsg args</span></div><div class="line">deferred.fail(<span class="function"><span class="keyword">function</span>(<span class="params">errorCode, errorMsg</span>) </span>&#123;</div><div class="line">        alert(<span class="string">"Failure callback: "</span> +errorCode+ <span class="string">" &amp; message"</span> + errorMsg);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// Do some processing resulting in an error with errCode and corresponding</span></div><div class="line"><span class="comment">// error message errMsg</span></div><div class="line">        .</div><div class="line">        .</div><div class="line"><span class="comment">// Calling the reject function on the Deferred Object with the error code</span></div><div class="line"><span class="comment">// and err message would be passed back to the callback function(s) that</span></div><div class="line"><span class="comment">// have been registered.</span></div><div class="line">deferred.reject(errCode, errMsg);</div></pre></td></tr></table></figure>
<h2 id="Use-of-Promise"><a href="#Use-of-Promise" class="headerlink" title="Use of Promise"></a>Use of Promise</h2><p>A typical usage of a Deferred Object pattern would be to provide the caller of a function with a handle to a Deferred Object. The caller can use the handle to set the callbacks that it is interested in.</p>
<p>In addition, the function that created the Deferred Object would want to restrict the ability to finalize the Deferred Object by calling <code>.resolve()</code> or <code>.reject()</code>, to only itself or its downstream functions.</p>
<p>Both the requirements are supported in the Deferred Object framework by the <code>.promise()</code> function. The <code>.promise()</code> function returns a Deferred Object that can be used only to set the callbacks but not call the functions that could alter the state of the object. The called function can return this to the caller, which can then set the callback functions required upon the Deferred action completion.</p>
<p>For example, consider an Ajax request to download a web page. The call flow showing the usage of promise is as follows:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajaxRequest</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> deferred =  <span class="keyword">new</span> Deferred();</div><div class="line"></div><div class="line">        <span class="comment">// Initiate the request to download url and pass the</span></div><div class="line">        <span class="comment">// Deferred Object to enable the downstream downloader</span></div><div class="line">        <span class="comment">// to call resolve() or reject() and progress() as necessary</span></div><div class="line">        download(url, deferred);</div><div class="line"></div><div class="line">        <span class="comment">// Return the Deferred Promise Object to enable the</span></div><div class="line">        <span class="comment">// callbacks to be set by the caller</span></div><div class="line">        <span class="keyword">return</span> deferred.promise();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">caller</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        ajaxRequest(<span class="string">"http://oreilly.com"</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                alert(<span class="string">"Page successfully downloaded"</span>);</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">errCode, errorMsg</span>) </span>&#123;</div><div class="line">                alert(<span class="string">"Failure Callback: "</span> + errCode + <span class="string">" - "</span> + errorMsg);</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"Progress update called"</span>);</div><div class="line">        &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-04-21T12:57:17.000Z" itemprop="dateUpdated">2017-04-21 20:57:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/JavaScript/2014-10-23-jquery-defered.html" target="_blank" rel="external">http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&title=《jQuery Defered》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&title=《jQuery Defered》 — Balance&source=Deferred Object PatternThe Deferred Object pattern is the key pattern used by..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《jQuery Defered》 — Balance&url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/Mobile/2014-10-25-mobile-dpr.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">设备像素比 devicePixelRatio 简单介绍</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Angular/2014-10-22-angular-core.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Angular Core</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&title=《jQuery Defered》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&title=《jQuery Defered》 — Balance&source=Deferred Object PatternThe Deferred Object pattern is the key pattern used by..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《jQuery Defered》 — Balance&url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/JavaScript/2014-10-23-jquery-defered.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACsElEQVR42u3ay3IbMQwEQP//TzvXpBKvZgDSVqV6Typb+2geFtQAHx/x8fnbkfz9q/8mn5NzDx94eHh4i0f/+3i+2b1zN1fAw8PD+x7eV2/U5xf38/efy8bm0ZNnxsPDw3sf3vPnFpZsl/Hw8PD+P94MOdtY4+Hh4b0Pr710HukmW+18OS5mLXh4eHgxL+8ivc/nK/09PDw8vHVXvY1Qf7ZV9o9r4uHh4V3g5S/cNiCYLU1enIrhMDw8PLxrvCRiyAOIdoGSIjHcfOPh4eFd4+1bYu1fnu+etM2igoGHh4d3lJc0kE7dvh0myBtgxWYaDw8Pb82blYekeLSlpY0hhs0wPDw8vEO8zUv8RoC7aY+9CCPw8PDwjvKSwHQzWJDHxPvvFDfGw8PDK3nJw7U/+9urtYxiufHw8PAu8GaFYT8IlV95s7nHw8PDu8ebhQubAYI8qD01joCHh4d3lvei6R43otrr5CHvbOnx8PDwvoeXt5c2L+5hrDBr1+Hh4eEd5bU/8vNbtoXh1NDVi5QaDw8Pb83Lt7PtQ8+a/Zto48XQFR4eHt5R3iZo2HynLSd1ScDDw8O7wGtf3LNANo8zZiFvNBOBh4eHd5TXBgrJy70tAG01SxYUDw8P7wZvEyXsW1xtQ2tWhPDw8PBu8GaMfFucP1AeSRQRBh4eHt41Xhs3tAuRbJHzMlOchYeHh3eNNwsOiuHReCk3LbEiq8bDw8Mb8T7LYzNq0DaxZsXjj//i4eHhXeC1P/vzcGGzmc4D32E8gYeHh7fmbS6dt8raQYH9qBYeHh7ebd5mgzt79a8qVb5weHh4eG/Ma5ths1Zc/Tx4eHh4b8Brm1ttqcgHBVaTEXh4eHhrXh4E5E2pdpRqNrr64iw8PDy8C7z2R/4+PmgHvPLicSDDwMPDw3s69xd698U6UUF5sAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
