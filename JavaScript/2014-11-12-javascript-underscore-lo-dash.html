<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>JavaScript UnderScore | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="javascript">
    <meta name="description" content="The spiritual successor to underscore.js, lodash maintains backwards compatibility with underscore code (if you use the compatible version), and takes bold steps forward to help you manipulate those o">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript UnderScore">
<meta property="og:url" content="http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="The spiritual successor to underscore.js, lodash maintains backwards compatibility with underscore code (if you use the compatible version), and takes bold steps forward to help you manipulate those o">
<meta property="og:image" content="http://filimanjaro.com/blog/wp-content/uploads/2014/11/lodash-naive.gif">
<meta property="og:image" content="http://filimanjaro.com/blog/wp-content/uploads/2014/11/grafika.gif">
<meta property="og:image" content="http://filimanjaro.com/blog/wp-content/uploads/2014/11/benchmark.jpg">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript UnderScore">
<meta name="twitter:description" content="The spiritual successor to underscore.js, lodash maintains backwards compatibility with underscore code (if you use the compatible version), and takes bold steps forward to help you manipulate those o">
<meta name="twitter:image" content="http://filimanjaro.com/blog/wp-content/uploads/2014/11/lodash-naive.gif">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">JavaScript UnderScore</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">JavaScript UnderScore</h1>
        <h5 class="subtitle">
            
                <time datetime="2014-11-11T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2014-11-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript/">JavaScript</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Lazy-Evaluation"><span class="post-toc-text">Lazy Evaluation</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Pipelining"><span class="post-toc-text">Pipelining</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Deferred-execution"><span class="post-toc-text">Deferred execution</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Array"><span class="post-toc-text">Array</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Collections"><span class="post-toc-text">Collections - [{},{},{}]</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Objects"><span class="post-toc-text">Objects - {}</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Chains"><span class="post-toc-text">Chains - _.()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Wrap-up"><span class="post-toc-text">Wrap up</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reference"><span class="post-toc-text">Reference</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-javascript-underscore-lo-dash"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">JavaScript UnderScore</h1>
        <div class="post-meta">
            <time class="post-time" title="2014-11-12 00:00:00" datetime="2014-11-11T16:00:00.000Z"  itemprop="datePublished">2014-11-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/JavaScript/">JavaScript</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>The spiritual successor to underscore.js, lodash maintains backwards compatibility with underscore code (if you use the compatible version), and takes bold steps forward to help you manipulate those objects and arrays quickly and easily.</p>
<p>There are many more methods to lodash then I’ve covered here, these are the ones I find myself using the most.</p>
<p>I always thought libraries like Lo-Dash can’t really get any&nbsp;faster than they already are. Lo‑Dash almost perfectly mixes <a href="https://www.youtube.com/watch?v=NthmeLEhDDM" title="Unorthodox Performance" target="_blank" rel="external">various techniques</a> to squeeze out the most from JavaScript. It uses JavaScript fastest statements, adaptive algorithms, it even measures performance to avoid accidental regressions in subsequent releases.</p>
<a id="more"></a>
<h2 id="Lazy-Evaluation"><a href="#Lazy-Evaluation" class="headerlink" title="Lazy Evaluation"></a>Lazy Evaluation</h2><p>But it seems I was wrong – it is actually possible to make Lo-Dash significantly faster. All you need to do is stop thinking about micro-optimizations and start figuring&nbsp;out the right&nbsp;algorithm to use. For example,&nbsp;in a typical loop we usually&nbsp;tend to optimize a single‑iteration time:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var len = getLength();</div><div class="line">for(var i = 0; i &lt; len; i++) &#123;</div><div class="line">    operation(); // &lt;- 10ms - how to make it 9ms?!</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>But it’s often hard and very limited. Instead, it&nbsp;makes&nbsp;a lot&nbsp;more sense in some cases to optimize&nbsp;<code>getLength()</code> function. The smaller the number it returns, the less <code>10ms</code>&nbsp;cycles we have.</p>
<p>This is roughly the idea behind&nbsp;the lazy evaluation in Lo-Dash. It’s about reducing the number of cycles, not reducing a cycle time. Let’s consider the following example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function priceLt(x) &#123;</div><div class="line">   return function(item) &#123; return item.price &lt; x; &#125;;</div><div class="line">&#125;</div><div class="line">var gems = [</div><div class="line">   &#123; name: &apos;Sunstone&apos;, price: 4 &#125;, &#123; name: &apos;Amethyst&apos;, price: 15 &#125;,</div><div class="line">   &#123; name: &apos;Prehnite&apos;, price: 20&#125;, &#123; name: &apos;Sugilite&apos;, price: 7  &#125;,</div><div class="line">   &#123; name: &apos;Diopside&apos;, price: 3 &#125;, &#123; name: &apos;Feldspar&apos;, price: 13 &#125;,</div><div class="line">   &#123; name: &apos;Dioptase&apos;, price: 2 &#125;, &#123; name: &apos;Sapphire&apos;, price: 20 &#125;</div><div class="line">];</div><div class="line"></div><div class="line">var chosen = _(gems).filter(priceLt(10)).take(3).value();</div></pre></td></tr></table></figure>
<p>We want to take&nbsp;only&nbsp;first 3 gems with price lower than $10. Regular Lo-Dash approach (strict evaluation) filters all 8 gems – then returns the first three&nbsp;that passed filtering:</p>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://filimanjaro.com/blog/wp-content/uploads/2014/11/lodash-naive.gif" alt="Lodash naïve approach](http://johnnyimages.qiniudn.com/lodash-naive.gif)" title="">
                </div>
                <div class="image-caption">Lodash naïve approach](http://johnnyimages.qiniudn.com/lodash-naive.gif)</div>
            </figure></p>
<p>It’s not cool though. It processes all 8 elements, while in fact we need to read only 5 of them. Lazy evaluation algorithm, on the contrary, processes the minimal number of elements in an array to get the correct result. Check it out in action:</p>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://filimanjaro.com/blog/wp-content/uploads/2014/11/grafika.gif" alt="Lo-Dash regular approach](http://filimanjaro.com/blog/wp-content/uploads/2014/11/grafika.gif)" title="">
                </div>
                <div class="image-caption">Lo-Dash regular approach](http://filimanjaro.com/blog/wp-content/uploads/2014/11/grafika.gif)</div>
            </figure></p>
<p>We’ve easily gained 37.5% performance boost. But it’s not all we can achieve, actually it’s quite easy to find an example with ×1000+ perf boost. Let’s have a look:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var phoneNumbers = [5554445555, 1424445656, 5554443333, … ×99,999];</div><div class="line"></div><div class="line">// get 100 phone numbers containing „55”</div><div class="line">function contains55(str) &#123;</div><div class="line">    return str.contains(&quot;55&quot;); </div><div class="line">&#125;;</div><div class="line"></div><div class="line">var r = _(phoneNumbers).map(String).filter(contains55).take(100);</div></pre></td></tr></table></figure>
<p>In such an example map and filter is ran on 99,999 elements, while it may be sufficient to run&nbsp;it only on e.g. 1,000&nbsp;elements. The performance gain is massive here (<a href="http://jsperf.com/lazy-demo" title="jsperf benchmark" target="_blank" rel="external">benchmark</a>):</p>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://filimanjaro.com/blog/wp-content/uploads/2014/11/benchmark.jpg" alt="benchmark](http://filimanjaro.com/blog/wp-content/uploads/2014/11/benchmark.jpg)" title="">
                </div>
                <div class="image-caption">benchmark](http://filimanjaro.com/blog/wp-content/uploads/2014/11/benchmark.jpg)</div>
            </figure></p>
<h2 id="Pipelining"><a href="#Pipelining" class="headerlink" title="Pipelining"></a>Pipelining</h2><p>Lazy evaluation brings another benefit, which I call a “pipelining”. The idea behind is to avoid&nbsp;creating intermediary arrays during the chain execution.&nbsp;Instead we should perform all operations&nbsp;on a single element in place. So, the following piece of code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var result = _(source).map(func1).map(func2).map(func3).value();</div></pre></td></tr></table></figure>
<p>would translate roughly to this in regular Lo-Dash (strict evaluation)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var result = [], temp1 = [], temp2 = [], temp3 = [];</div><div class="line"></div><div class="line">for(var i = 0; i &lt; source.length; i++) &#123;</div><div class="line">   temp1[i] = func1(source[i]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">for(i = 0; i &lt; source.length; i++) &#123;</div><div class="line">   temp2[i] = func2(temp1[i]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">for(i = 0; i &lt; source.length; i++) &#123;</div><div class="line">   temp3[i] = func3(temp2[i]);</div><div class="line">&#125;</div><div class="line">result = temp3;</div></pre></td></tr></table></figure>
<p>While with the lazy evaluation turned on it’d perform more like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var result = [];</div><div class="line">for(var i = 0; i &lt; source.length; i++) &#123;</div><div class="line">   result[i] = func3(func2(func1(source[i])));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Lack of temporary arrays may give us&nbsp;a significant performance gain, especially when source arrays are huge&nbsp;and memory&nbsp;access is expensive.</p>
<h2 id="Deferred-execution"><a href="#Deferred-execution" class="headerlink" title="Deferred execution"></a>Deferred execution</h2><p>Another benefit that&nbsp;was brought together with the lazy evaluation is deferred execution. Whenever you create a chain, it’s not computed&nbsp;until <code>.value()</code> is called implicitly or explicitly. This approach helps to prepare a query first and execute&nbsp;it later with the most recent data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var wallet = _(assets).filter(ownedBy(&apos;me&apos;))</div><div class="line">                      .pluck(&apos;value&apos;)</div><div class="line">                      .reduce(sum);</div><div class="line"></div><div class="line">$json.get(&quot;/new/assets&quot;).success(function(data) &#123;</div><div class="line">    assets.push.apply(assets, data); // update assets</div><div class="line">    wallet.value(); // returns most up-to-date value</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>It may also speed up execution time in some cases. We can create a complex query early and then, when time is critical, execute it.</p>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p><strong>first</strong></p>
<p>Pop, shift, slice? How about just give me the <code>_.first</code> x numbers of elements.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> ,<span class="number">5</span> ];</div><div class="line">_.first(array, <span class="number">3</span>);</div><div class="line"><span class="comment">// returns [1,2,3]</span></div></pre></td></tr></table></figure>
<p><strong>rest</strong></p>
<p>Push, unshift or splice? Wha</p>
<p>Push, unshift or splice? What about when you just want the last few items of an array?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var array = [ 1, 2, 3, 4 ,5 ];</div><div class="line">    _.rest(array, 3);</div><div class="line">    // returns [1,2,3]</div></pre></td></tr></table></figure>
<p><strong>compact</strong></p>
<p>Sometimes you end up with a bunch of empty fields in an array. <code>_.compact</code> removes everything which evaluates to <code>false</code>, <code>null</code>, <code>0</code>, <code>undefined</code> or <code>NaN</code>. Useful for keeping data tidy.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var array = [ 0, 1, 0, 2, false, true ];</div><div class="line">_.compact(array);</div><div class="line">// returns [ 1,2, true]</div></pre></td></tr></table></figure>
<p><strong>flatten</strong></p>
<p>Nested arrays are often part of working with JavaScript, use <code>_.flatten</code> to get rid of the un-needed structure.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var array = [[ 1,2 ], [3,4]];</div><div class="line">_.flatten(array);</div><div class="line">// returns [1,2,3,4]</div></pre></td></tr></table></figure>
<p><strong>each</strong></p>
<p>Good old forEach, except it works in all browsers and is a little trimmer.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var array = [1,2,3];</div><div class="line">_.each(array, function(v,i)&#123;</div><div class="line">  array[i] = v*2;</div><div class="line">&#125;);</div><div class="line">// does not return anything, just sets array to [ 2, 4, 6 ];</div></pre></td></tr></table></figure>
<p>It’s important to notice that lodash uses the following formats on anonymous functions:</p>
<p>Dealing with arrays</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">function(value, i)</div></pre></td></tr></table></figure>
<p>Dealing with objects</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">function(value, key)</div></pre></td></tr></table></figure>
<p>This may be second nature to anyone used to <code>for-in</code> loops, but it could be a stumbling block for anyone used to the key, value notation.</p>
<p>Collections are arrays of objects, and while the above functions work perfectly well on them, there are other ways we can traverse and manipulate them. </p>
<h2 id="Collections"><a href="#Collections" class="headerlink" title="Collections - [{},{},{}]"></a>Collections - [{},{},{}]</h2><p><strong>map</strong></p>
<p><code>Map</code> is useful when you need to transform values of an array or object. Unlike each, this generates a new array. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function toDogYears(dog)&#123;</div><div class="line">  return dog.age*7;</div><div class="line">&#125;;</div><div class="line">var dogs = [&#123; name: &quot;arf&quot;, age: 3&#125;, &#123;name:&apos;bark&apos;, age: 5&#125;]</div><div class="line"></div><div class="line">_.map(dogs, toDogYears);</div><div class="line">//returns [21,35]</div></pre></td></tr></table></figure>
<p><strong>reduce</strong></p>
<p><code>_.reduce</code> turns an array or collection into a single value, using an accumulator as a starting point and passing it into a function for each iteration.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// array reduction</div><div class="line">var array = [ 1,2,3 ];</div><div class="line">_.reduce(array, function(total, number)&#123;</div><div class="line">  return total + number;</div><div class="line">&#125;, 0);</div><div class="line"></div><div class="line">// object reduction</div><div class="line">var workers = [&#123; name: &apos;john&apos;, years: 5 &#125;, &#123;name: &apos;susan&apos;, years: 3&#125;, &#123;name: &apos;lucy&apos;, years: 2 &#125;];</div><div class="line"></div><div class="line">_.reduce(workers, function(combined, worker)&#123;</div><div class="line">  return combined.years += worker.years</div><div class="line">&#125;,&#123;&#125;);</div><div class="line">// returns &#123; years: 10 &#125;;</div></pre></td></tr></table></figure>
<p><strong>filter</strong></p>
<p>For the next three functions, assume this dataset:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var cats = [&#123; name: &apos;fuzzy&apos;, color: &apos;orange&apos;, age: 12 &#125;,</div><div class="line">&#123; name: &apos;tiny&apos;, color: &apos;red&apos;, age: 7 &#125;,</div><div class="line">&#123; name: &apos;grumpy&apos;, color: &apos;white&apos;, age: 5 &#125; ]</div></pre></td></tr></table></figure>
<p><code>_.filter</code> returns an array of objects which all pass a truth test.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">_.filter(cats, function getYoungerCats(cat)&#123;</div><div class="line">return (cat.age &lt; 10);</div><div class="line">&#125;);</div><div class="line">// returns [ &#123; name: &apos;tiny&apos;, color: &apos;red&apos;, age: 7 &#125;, &#123; name: &apos;grumpy&apos;, color: &apos;white&apos;, age: 5 &#125; ]</div></pre></td></tr></table></figure>
<p><strong>pluck</strong></p>
<p>Pluck is similar to reduce, except you get an ordered list of properties as an array, instead of an accumulated value. Useful when you need to build isolated datasets out of large collections.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.pluck(cats, &apos;name&apos;);</div><div class="line">// return [ &apos;fuzzy&apos;, &apos;tiny&apos;, &apos;grumpy&apos;]</div></pre></td></tr></table></figure>
<p><strong>where</strong></p>
<p>Where is a shorthand for what you might otherwise accomplish with <code>_.filter</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.where(cats, &#123; color: &apos;red&apos;&#125;);</div><div class="line">// returns [&#123; name: &apos;fuzzy&apos;, color: &apos;orange&apos;, age: 12 &#125;]</div></pre></td></tr></table></figure>
<h2 id="Objects"><a href="#Objects" class="headerlink" title="Objects - {}"></a>Objects - {}</h2><p><strong>clone</strong></p>
<p>One of the gotchas in JavaScript-land is using an object as a property of another object, and we change that property, thinking that we are affecting a copy of the object. Not true. Only a pointer to the original object is stored.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var obj = &#123; &apos;a&apos; : true, &apos;b&apos;: true &#125;;</div><div class="line">var smartContainer = &#123; foo: _.clone(obj) &#125;</div><div class="line">smartContainer.foo.a = false;</div><div class="line">// obj.a == true</div><div class="line">// original object was not changed</div><div class="line"></div><div class="line">var container = &#123; foo: obj &#125;;</div><div class="line">container.foo.a = false;</div><div class="line">// obj.a == false</div><div class="line">// original object changed, even though it&apos;s inside another object</div></pre></td></tr></table></figure>
<p><strong>extend</strong></p>
<p><code>_.extend</code> divides your development experience into before you used extend and after you used extend. Simply, it merges objects. Properties of subsequent objects will override earlier.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.extend(&#123; type: &apos;ball&apos;, color: &apos;blue&apos; &#125;, &#123; name: &apos;bob&apos;, color: &apos;red&apos; &#125;);</div><div class="line">// &#123; type: &apos;ball&apos;, color: &apos;red&apos;, name: &apos;bob&apos; &#125;</div></pre></td></tr></table></figure>
<p><strong>has</strong></p>
<p>Useful as a safe alternative to <code>if (obj.prop)</code> conditional testing.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">if ( _.has(obj, &apos;prop&apos;)) &#123; &#125;</div></pre></td></tr></table></figure>
<p><strong>isEmpty / isPlainObject / isUndefined / isEqual / isNull</strong></p>
<p>These simple conditional tests are extremely useful, abstract away all sorts of edge cases, and are easy to use.</p>
<p><strong>transform</strong></p>
<p><code>_.transform</code> is similar to reduce, in that it runs a function for each element of an array or object. Transform does not need an explicit starting point for the accumulator however.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var coords = &#123; lat: 35.34534534534, long: 40.3552523434 &#125;;</div><div class="line">_.transform( coords, function roundCoords(result, val, key)&#123;</div><div class="line">return result[&quot;short&quot;+key] = Math.round(val);</div><div class="line">&#125;);</div><div class="line">// returns &#123; shortlat: 35, shortlong: 40 &#125;</div></pre></td></tr></table></figure>
<p><strong>pick</strong></p>
<p><code>_.pick</code> can be handy when you need to turn a large object into a specific smaller one.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var userModel = &#123; attributes: [ &apos;username&apos; , &apos;email&apos;] &#125;;</div><div class="line">var customerData = &#123; username: &apos;foo&apos;, email: &quot;a@a.com&quot;, address:&quot;123 Fine St&quot;, phone:&quot;1234561231&quot; &#125;&#125;</div><div class="line"></div><div class="line">_.pick(customerData, _.(userModel);</div><div class="line">// returns &#123; username: &apos;foo&apos;, email: &quot;a@a.com&quot; &#125;</div></pre></td></tr></table></figure>
<h2 id="Chains"><a href="#Chains" class="headerlink" title="Chains - _.()"></a>Chains - _.()</h2><p>Chains allow you to put together all your lodash knowledge in a very powerful sequence of code. </p>
<p>Chains can be started with <code>_.chain(value)</code> or the shorthand <code>_(value)</code>.</p>
<p>The value is then substituted for the input value for each chainable function that supports it. You can see a list of what methods are and aren’t supported <a href="https://lodash.com/docs#_" target="_blank" rel="external">here</a>, as well as the native Array methods supported by lodash. </p>
<p>If you want your chain to return a value, not just manipulate provided arrays, you have to use <code>.value()</code> at the end of your chain. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var array = [1,2,3,4];</div><div class="line">_(array)</div><div class="line">    .map( function(val)&#123; return val*val; &#125; )</div><div class="line">    .filter( function(val)&#123; return ( val % 2 === 0) &#125; )</div><div class="line">    .reverse()</div><div class="line">    .value();</div><div class="line">// returns [16,4]</div></pre></td></tr></table></figure>
<p>Chains keep code concise and readable for easy maintenance. If, for debugging, or for detailed manipulation, you need to access an array in the middle of chaining, you can use the <code>_.tap</code> method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var array = [1,2,3,4];</div><div class="line">_(array)</div><div class="line">    .tap(function(arr)&#123; arr.splice(2,1,&apos;three&apos;); &#125;)</div><div class="line">    .filter( function(val)&#123; return ( val % 2 !== 0 )&#125; )</div><div class="line">    .value();</div><div class="line">// returns [1, &apos;three&apos;]</div></pre></td></tr></table></figure>
<h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap up"></a>Wrap up</h2><p>Lazy evaluation is not the new idea in the industry. It has&nbsp;already been there with excellent libraries like <a href="http://en.wikipedia.org/wiki/Language_Integrated_Query" title="LINQ" target="_blank" rel="external">LINQ</a>, <a href="http://danieltao.com/lazy.js/" title="Lazy.js" target="_blank" rel="external">Lazy.js</a> and many others. The main difference Lo-Dash makes, I believe, is that you still have good ol` Underscore API with a new powerful engine inside.&nbsp;No new library to learn, no significant code changes to make, just&nbsp;a pending upgrade.</p>
<p>But even if you’re not going to use Lo-Dash, I hope this article inspired you. Now,&nbsp;when you find&nbsp;a bottleneck in your application, stop trying to optimize&nbsp;it in jsperf.com try/fail style. Instead go,&nbsp;grab a coffee and start thinking about algorithms. Creativity is important here, but a good math background won’t hurt&nbsp;too&nbsp;(<a href="http://mitpress.mit.edu/books/introduction-algorithms" title="Introduction to Algorithms - book" target="_blank" rel="external">book</a>). Good luck!</p>
<p>_TBC… I’d like to write another – more advanced – post explaining how the Lazy algorithm is implemented in detail. If you like the idea, vote on it by following me on <a href="http://twitter.com/filip_zawada" title="My Twitter" target="_blank" rel="external">Twitter</a>._</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://filimanjaro.com/blog/2014/introducing-lazy-evaluation" target="_blank" rel="external">How to Speed Up Lo-Dash ×100? Introducing Lazy Evaluation.</a></li>
<li><a href="https://www.airpair.com/node.js/posts/utilities-for-everyday-node-development" target="_blank" rel="external">Utilities for Everyday Node.js Development</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/JavaScript/2014-11-12-javascript-underscore-lo-dash.html" target="_blank" rel="external">http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&title=《JavaScript UnderScore》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&title=《JavaScript UnderScore》 — Balance&source=The spiritual successor to underscore.js, lodash maintains backwards compatib..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JavaScript UnderScore》 — Balance&url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/Grunt/2014-11-25-grunt-angular-fullstack-yo.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">使用 Yoeman generator-angular-fullstack 生成工程的 Gruntfile 源码分析</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/JavaScript/2014-11-12-javascript-console.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Console object you didn’t know</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2018</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&title=《JavaScript UnderScore》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&title=《JavaScript UnderScore》 — Balance&source=The spiritual successor to underscore.js, lodash maintains backwards compatib..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JavaScript UnderScore》 — Balance&url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/JavaScript/2014-11-12-javascript-underscore-lo-dash.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACvUlEQVR42u3aQW4bMRAEQP//087VgSOpe4ZUjKT2ZFjrXRYFkHTPfHzE1+eX6+tv8k+TZ+ZvPHzh4eHhLYb+/WoBj/5qdn0fZz5mPDw8vNu8Ryvqo3uST58v/e1A880GDw8P76fxNuzNnXh4eHj/Eq94WbAl7AMOPDw8vPfwkpe1AW4+Hfnh+2LWgoeHhxfz8irSz/n5Sn0PDw8Pb11VTxbcUxvDqYLZb8/Hw8PDu8DLF9wZO48e2s0pD3zx8PDw3snLB3HvAL1v/MLDw8M7y5s1Acwi1LbQNSuqFb0JeHh4eCPe7Pg7ix7aicgLYC8mBQ8PD+8oLy8vPX/cPlxoj/XRu/Dw8PAu8Nqh5+WuBJ+XwfJxPsxa8PDw8K7xZsfZ2XDze9ppHb4eDw8PL+AlS/DsZZsiVv72FxOHh4eHd4GXRLH7CGOTMbexb5FS4+Hh4a15+WF604Iwm4J8mqKsBQ8PD2/Bm7U65YOYNXLt3/5x+wV4eHj/MS8PJtp2gbYxaxP4FpEEHh4e3iFeDmuX7FkxbJPE1mUwPDw8vBHvbLFq1p6VbDz5F4CHh4d3jzcbSrsot/hkEzq24+Hh4eGVvByTBAr7Jq395A4fh4eHhxfz8oB1dqRuD9D5dxKNEw8PD+8CLwlP20V884S2xSqZRDw8PLwbvHwOZl0Jp2KOeunHw8PDeyMvX9yThfv5b1pM3QSGh4eHd5mXlO03y3dePCuW/jzMxcPDw1vzPssr3yry4CA/XtftC3h4eHgXeO2C224bbWDRRrpt8oCHh4d3ipdvBrMleHawbo/1L3rK8PDw8C7wNoWrWbA73KM2WQseHh7eX+LNGqGSAW3uPLYx4OHh4V3j5dFDfk++zeQxBx4eHt49Xlv0areKNrzIC29R0xUeHh7eUd7sn/x9oSsvaOVH7WMZBh4eHt6fP/0FO9QNAcWFQXoAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
