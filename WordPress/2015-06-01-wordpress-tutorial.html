<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>WordPress Tutorial | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,wordpress">
    <meta name="description" content="MVC plugins for WordPress
WP MVC
Churro
Tina MVC

There are a couple of ways to Vap an MVC process to WordPress.
Models = pluginsIn an MVC framework, the code that stores the underlying data structure">
<meta property="og:type" content="article">
<meta property="og:title" content="WordPress Tutorial">
<meta property="og:url" content="http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="MVC plugins for WordPress
WP MVC
Churro
Tina MVC

There are a couple of ways to Vap an MVC process to WordPress.
Models = pluginsIn an MVC framework, the code that stores the underlying data structure">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WordPress Tutorial">
<meta name="twitter:description" content="MVC plugins for WordPress
WP MVC
Churro
Tina MVC

There are a couple of ways to Vap an MVC process to WordPress.
Models = pluginsIn an MVC framework, the code that stores the underlying data structure">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">WordPress Tutorial</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">WordPress Tutorial</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-05-31T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2015-06-01
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WordPress/">WordPress</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MVC-plugins-for-WordPress"><span class="post-toc-text">MVC plugins for WordPress</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Models-plugins"><span class="post-toc-text">Models = plugins</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Views-themes"><span class="post-toc-text">Views = themes</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Controllers-template-loader"><span class="post-toc-text">Controllers = template loader</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WordPress-Directory-Structure"><span class="post-toc-text">WordPress Directory Structure</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Settings"><span class="post-toc-text">Settings</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Do-You-Really-Need-a-Settings-Page"><span class="post-toc-text">Do You Really Need a Settings Page?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Could-You-Use-a-Hook-or-Filter-Instead"><span class="post-toc-text">Could You Use a Hook or Filter Instead?</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Use-Standards-When-Adding-Settings"><span class="post-toc-text">Use Standards When Adding Settings</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Ignore-Standards-When-Adding-Settings"><span class="post-toc-text">Ignore Standards When Adding Settings</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Rewrite"><span class="post-toc-text">Rewrite</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Adding-Rewrite-Rules"><span class="post-toc-text">Adding Rewrite Rules</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Flushing-Rewrite-Rules"><span class="post-toc-text">Flushing Rewrite Rules</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Other-Rewrite-Functions"><span class="post-toc-text">Other Rewrite Functions</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WP-Cron"><span class="post-toc-text">WP-Cron</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Adding-Custom-Intervals"><span class="post-toc-text">Adding Custom Intervals</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Scheduling-Single-Events"><span class="post-toc-text">Scheduling Single Events</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kicking-Off-Cron-Jobs-from-the-Server"><span class="post-toc-text">Kicking Off Cron Jobs from the Server</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Using-Server-Crons-Only"><span class="post-toc-text">Using Server Crons Only</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WP-Mail"><span class="post-toc-text">WP Mail</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sending-Nicer-Emails-with-WordPress"><span class="post-toc-text">Sending Nicer Emails with WordPress</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#File-Header-API"><span class="post-toc-text">File Header API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Adding-File-Headers-to-Your-Own-Files"><span class="post-toc-text">Adding File Headers to Your Own Files</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Adding-New-Headers-to-Plugins-and-Themes"><span class="post-toc-text">Adding New Headers to Plugins and Themes</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tutorial"><span class="post-toc-text">Tutorial</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-wordpress-tutorial"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">WordPress Tutorial</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-06-01 00:00:00" datetime="2015-05-31T16:00:00.000Z"  itemprop="datePublished">2015-06-01</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WordPress/">WordPress</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="MVC-plugins-for-WordPress"><a href="#MVC-plugins-for-WordPress" class="headerlink" title="MVC plugins for WordPress"></a>MVC plugins for WordPress</h2><ul>
<li><a href="http://bit.ly/wp-mvc" target="_blank" rel="external">WP MVC</a></li>
<li><a href="http://bit.ly/churro-plugin" target="_blank" rel="external">Churro</a></li>
<li><a href="http://bit.ly/tina-mvc" target="_blank" rel="external">Tina MVC</a></li>
</ul>
<p>There are a couple of ways to Vap an MVC process to WordPress.</p>
<h3 id="Models-plugins"><a href="#Models-plugins" class="headerlink" title="Models = plugins"></a>Models = plugins</h3><p>In an MVC framework, the code that stores the underlying data structures and business logic are found in the models. This is where the programmers will spend the majority of their time.</p>
<p>In WordPress, plugins are the proper place to store new data structures, complex business logic, and custom post type definitions.</p>
<p>This comparison breaks down in a couple of ways. First, many plugins add view-like functionality and contain design elements. Take any plugin that adds a widget to be used in your pages. Second, forms and other design components used in the WordPress dashboard are generally handled in plugins as well.</p>
<p>One way to make the separation of concerns more clear when adding view-like components to your WordPress plugins is to create a “templates” or “pages” folder and put your frontend code into it. Common practice is to allow templates to override the template used by the plugin. For example, when using WordPress with the Paid Memberships Pro plugin, you can place a folder called “paid-memberships-pro/pages” into your active theme to override the default page templates.</p>
<h3 id="Views-themes"><a href="#Views-themes" class="headerlink" title="Views = themes"></a>Views = themes</h3><p>In an MVC framework, the code to display data to the user is written in the views. This is where designers will spend the majority of their time.</p>
<p>In WordPress, themes are the proper place to store templating code and logic.</p>
<p>Again, the comparison here doesn’t map one to one, but “views = themes” is a good starting point.</p>
<h3 id="Controllers-template-loader"><a href="#Controllers-template-loader" class="headerlink" title="Controllers = template loader"></a>Controllers = template loader</h3><p>In an MVC framework, the code to process user input (in the form of URLs or <code>$_GET</code> or <code>$_POST</code> data) and decide which models and views to use to handle a request are stored in the controllers. Controller code is generally handled by a programmer and often set up once and forgotten about. The meat of the programming in an MVC application happens in the models and views.</p>
<p>In WordPress, all page requests (unless they are accessing a cached <em>.html</em> file) are processed through the index.php file and processed by WordPress according to the Template Hierarchy. The template loader figures out which file in the template should be used to display the page to the end user. For example, use <em>search.php</em> to show search results, <em>single.php</em> to show a single post, etc.</p>
<p>For a better understanding of how MVC frameworks work, the PHP framework <a href="http://bit.ly/yii-guide" target="_blank" rel="external">Yii</a> has a great resource explaining how to best use their MVC architecture.</p>
<p>For a better understanding of how to develop web applications using WordPress as a framework, continue reading this book.</p>
<h2 id="WordPress-Directory-Structure"><a href="#WordPress-Directory-Structure" class="headerlink" title="WordPress Directory Structure"></a>WordPress Directory Structure</h2><ul>
<li><em>wp-config.php</em> the only file you may need to ever alter</li>
<li><p><em>/wp-admin</em></p>
<p>  This directory contains core directories and files for managing the WordPress admin interface. Another key file in this directory is <em>admin-ajax.php</em>, which all AJAX requests should be run through.</p>
</li>
<li><p><em>/wp-includes</em></p>
<p>  This directory contains core directories and files for various WordPress functionality.</p>
</li>
<li><p><em>/wp-content</em></p>
<p>  This directory contains subdirectories for the plugins and themes you have installed on your site and any media files you upload to your site. If you create a plugin that needs to store dynamic files of its own, it is a best practice to place them somewhere in the <em>wp-content</em> folder so they are included in a content backup.</p>
<p>  The following directories are subdirectories of the <em>wp-content</em> directory.</p>
<ul>
<li><p><em>/wp-content/plugins</em></p>
<p>  Any WordPress plugin you install on your WordPress site will be located in this directory. By default, WordPress comes with the Hello Dolly and Akismet plugins.</p>
</li>
<li><p><em>/wp-content/themes</em></p>
<p>  Any WordPress themes you install on your WordPress site will be located in this directory. By default, WordPress comes with the Twenty Eleven, Twenty Twelve, Twenty Thirteen, and Twenty Fourteen themes.</p>
</li>
<li><p><em>/wp-content/uploads</em></p>
<p>  Once you start uploading any photos or files to your media library, you will start seeing this directory being populated with those uploaded files. All uploaded media is stored in the <em>uploads</em> directory.</p>
</li>
<li><p><em>/wp-content/mu-plugins</em></p>
<p>  In WordPress, you can force the use of any plugin by creating a <em>mu-plugins</em> directory inside of the <em>wp-content</em> directory. This directory does not exist unless you create it. The “mu” stands for “must use,” and any plugin you put in the <em>mu-plugins</em> folder will automatically run without needing to be manually activated on the admin plugins page. In fact, you won’t even see any must use plugins listed there.</p>
<p>  Must use plugins are especially useful on multisite installs of WordPress so you can use plugins that your individual network site admins won’t be able to deactivate.</p>
</li>
</ul>
</li>
</ul>
<h2 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h2><p>WordPress offers an API that can be used to generate options and settings forms for your plugins in the admin dashboard.</p>
<p>The Settings API is very thoroughly documented in <a href="http://bit.ly/settings-api" target="_blank" rel="external">the WordPress Codex</a>. There is also a great tutorial by Tom Mcfarlin at Tutsplus called <a href="http://bit.ly/guide-wp" target="_blank" rel="external">The Complete Guide to the WordPress Settings API</a>. These resources cover the details of adding menu pages and settings within them for use in your plugins and themes. Below are some tips specific to app developers.</p>
<h3 id="Do-You-Really-Need-a-Settings-Page"><a href="#Do-You-Really-Need-a-Settings-Page" class="headerlink" title="Do You Really Need a Settings Page?"></a>Do You Really Need a Settings Page?</h3><p>Before spending the time to create a settings page and adding to the technical debt of your app, consider using a global variable to store an array of the options used by your plugin or app:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">global $schoolpress_settings;</div><div class="line">$schoolpress_settings = array(</div><div class="line">  &apos;info_email&apos; =&gt; &apos;info@schoolpress.me&apos;,</div><div class="line">  &apos;info_email_name&apos; =&gt; &apos;SchoolPress&apos;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>For apps that won’t be managed by nondevelopers and/or won’t be distributed, using a global of settings may be enough. Just store a global variable like the one in the preceding code at the top of your plugin file or inside of a <em>includes/settings.php</em> file. Why build the UI if you aren’t going to use it?</p>
<p>Even if your plugin or theme will eventually be distributed, we like to start with a global variable like this anyway. The settings that you think you need in the beginning may not be the ones you need at the end of your project. Settings may be added or removed throughout development. Settings you think need a dropdown may need a free text field instead. The Settings API makes it easy to add settings and update them later, but it is still much easier to change one element in a global array than it is to add or modify a handful of function calls and definitions.</p>
<p>If most of the statements below apply to you, consider using a global variable for your settings instead of building a settings UI:</p>
<ul>
<li>This plugin is not going to be distributed outside my team.</li>
<li>The only people changing these settings are developers.</li>
<li>These settings do not need to be different across our different environments.</li>
<li>These settings are likely to change before release.</li>
</ul>
<h3 id="Could-You-Use-a-Hook-or-Filter-Instead"><a href="#Could-You-Use-a-Hook-or-Filter-Instead" class="headerlink" title="Could You Use a Hook or Filter Instead?"></a>Could You Use a Hook or Filter Instead?</h3><p>Another alternative to adding a setting to your plugin through the Settings API is to use a hook or filter instead. If a setting you are imagining would only be used by a minority of your users, consider adding a hook or filter to facilitate the setting.</p>
<p>For example, someone using our WP-Doc plugin may request the ability to restrict <em>.doc</em> generation to admins only or a specific subset of WordPress roles. We could add a settings page with a list of roles with checkboxes to enable or disable <em>.doc</em> downloads for that role. Maybe it should just be one checkbox to enable downloads for all roles or just admins. Maybe it should be a free text field to enter a capability name to check for before allowing the download.</p>
<p>A filter might be a better way to do this. We can add a capability check before the <em>.doc</em> is served and use a filter to let developers override the default array of capabilities checked. This code should be added to the <code>wpdoc_template_redirect()</code> function of the WP-Doc plugin, before the <em>.doc</em> page is rendered:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">//don&apos;t require any caps by default, but allow developers to add checks</div><div class="line">$caps = apply_filters(&apos;wpdoc_caps&apos;, array());</div><div class="line"></div><div class="line">if(!empty($caps))</div><div class="line">&#123;</div><div class="line">  //guilty until proven innocent</div><div class="line">  $hascap = false;</div><div class="line"></div><div class="line">  //must be logged in to have any caps at all</div><div class="line">  if(is_user_logged_in())</div><div class="line">  &#123;</div><div class="line">    //make sure the current user has one of the caps</div><div class="line">    foreach($caps as $cap)</div><div class="line">    &#123;</div><div class="line">      if(current_user_can($cap))</div><div class="line">      &#123;</div><div class="line">        $hascap = true;</div><div class="line">        break;  //stop checking</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if(!$hascap)</div><div class="line">  &#123;</div><div class="line">    //don&apos;t show them the file</div><div class="line">    header(&apos;HTTP/1.1 503 Service Unavailable&apos;, true, 503);</div><div class="line">    echo &quot;HTTP/1.1 503 Service Unavailable&quot;;</div><div class="line">    exit;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You could then override the wpdoc_caps array by adding actions like these:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//require any user account</div><div class="line">add_filter(&apos;wpdoc_caps&apos;, function($caps) &#123; return array(&apos;read&apos;); &#125;);</div><div class="line"></div><div class="line">//require admin account</div><div class="line">add_filter(&apos;wpdoc_caps&apos;, function($caps) &#123; return array(&apos;manage_options&apos;); &#125;);</div><div class="line"></div><div class="line">//authors only or users with a custom capability (doc)</div><div class="line">add_filter(&apos;wpdoc_caps&apos;, function($caps) &#123; return array(&apos;edit_post&apos;, &apos;doc&apos;); &#125;);</div></pre></td></tr></table></figure>
<p>The preceding example uses anonymous functions, also known as closures, so the add_filter() call can be written on one line without using a separate callback function. This syntax requires PHP version 5.3 or higher.</p>
<p>To recap, the more the following statements are true, the more it makes sense to use a hook or filter instead of a settings UI:</p>
<ul>
<li>Only a small number of people will want to change this setting.</li>
<li>The people changing this setting are likely to be developers.</li>
<li>The people changing this setting are likely to have custom needs.</li>
<li>This setting would require a large number of individual settings or more complicated UI.</li>
</ul>
<h3 id="Use-Standards-When-Adding-Settings"><a href="#Use-Standards-When-Adding-Settings" class="headerlink" title="Use Standards When Adding Settings"></a>Use Standards When Adding Settings</h3><p>Using the Settings API takes a little bit of up-front work, but does let you add and edit settings more easily later on. Also, since you are doing things the WordPress way, other developers will understand how your code works and will be able to hook into it. If a developer wants to make an add-on for your plugin, she will be able to hook into your existing menus and settings sections to add additional settings for her plugins.</p>
<p>Using the Settings API will also ensure that your settings look similar to the other settings through a user’s WordPress dashboard. You don’t want developers to have to learn a new UI just to use your plugin.</p>
<h3 id="Ignore-Standards-When-Adding-Settings"><a href="#Ignore-Standards-When-Adding-Settings" class="headerlink" title="Ignore Standards When Adding Settings"></a>Ignore Standards When Adding Settings</h3><p>While you typically want to use the Settings API and the WordPress standards when adding settings for your plugin, sometimes it make sense to ignore those standards.</p>
<p>The main case here is if you have a large number of settings that deserve a very custom UI. If you only have one or two settings, users won’t be spending a lot of time inside the settings screens. They will just want to change those two settings as fast as possible.</p>
<p>However, if your plugin requires dozens of settings, possibly across multiple tabs or screens, possibly related to one another, it makes sense to treat the settings for your app as an app itself. You should devote some attention to make sure that the UI and UX for your settings screen is as optimized as possible.</p>
<p>The WordPress Settings API is pretty flexible in terms of how things are displayed. You can control how each section is rendered and how each individual setting field is rendered. But in the end, it really is focused on one or more tabs with sections with fields on them. For applications with a large number of settings that interact with one another, you may want to use a different organization for your settings.</p>
<p>Don’t be scared to ignore the standards here. Add a menu to the dashboard, have the callback function for it include a set of organized <em>.php</em> files to generate the settings form and process it, and follow these tips if possible:</p>
<ul>
<li>Add your menu sections and items per the standards, even if your settings pages themselves use a custom layout.</li>
<li>Remember to sanitize your inputs and use nonces when appropriate.</li>
<li>Use hooks and filters to whenever possible, if you’d like to allow others to extend your settings.</li>
<li>Use the same HTML elements and CSS classes whenever possible so the general style stays consistent with the rest of WordPress now and through future updates.</li>
</ul>
<p>Due to the complexity of ecommerce software, it makes sense that ecommerce plugins often have complicated settings screens. Here are two examples of plugins doing custom settings pages well:</p>
<ul>
<li><a href="http://bit.ly/paid-pro" target="_blank" rel="external">Paid Memberships Pro</a> (whose code is <a href="http://bit.ly/pmp-github" target="_blank" rel="external">posted on GitHub</a>)</li>
<li><a href="http://bit.ly/wcomm-plugin" target="_blank" rel="external">WooCommerce</a> (whose code is <a href="http://bit.ly/wc-github" target="_blank" rel="external">posted on GitHub</a>)</li>
</ul>
<h2 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h2><p>Apache comes with a handy module called <code>mod_rewrite</code> that allows you to route incoming URLs to different URLs or file locations using rules that are typically added to an <em>.htaccess</em> file in your site root folder. Other Web servers have similar URL rewriting systems; here are the standard rules for WordPress:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># BEGIN WordPress</div><div class="line">&lt;IfModule mod_rewrite.c&gt;</div><div class="line">RewriteEngine On</div><div class="line">RewriteBase /</div><div class="line">RewriteRule ^index\.php$ - [L]</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</div><div class="line">RewriteRule . /index.php [L]</div><div class="line">&lt;/IfModule&gt;</div><div class="line"># END WordPress</div></pre></td></tr></table></figure>
<p>David Walsh does an excellent <a href="http://bit.ly/dw-htaccess" target="_blank" rel="external">line-by-line explanation of the WordPress .htaccess file on his blog</a> if you’d like to understand more about Apache’s <code>mod_rewrite</code> module and how the WordPress rules work. Generally, these rules reroute all incoming traffic to <em>any</em> nondirectory or nonfile URL to the <em>index.php</em> file of your WordPress install.</p>
<p>WordPress then parses the actual URL to figure out which post, page, or other content to show. For example, under most permalink settings, the URL <em>/about/</em> will route to the page or post with the slug “about.”</p>
<p>For the most part, you can let WordPress do its thing and handle permalink redirects on its own. However, if you need to add your own rules to handle certain URLs in particular ways, that can be done through the Rewrite API.</p>
<h3 id="Adding-Rewrite-Rules"><a href="#Adding-Rewrite-Rules" class="headerlink" title="Adding Rewrite Rules"></a>Adding Rewrite Rules</h3><p>The basic function to add a rewrite rule is <code>add_rewrite_rule($rule, $rewrite, $position)</code>:</p>
<ul>
<li>$rule—A regular expression to match against the URL, just like you would use in an Apache rewrite rule.</li>
<li>$rewrite—The URL to rewrite to if the rule is matched. Matched groups from the rule regular expressions are contained in an array called <code>$matches</code>.</li>
<li>$position—Specifies whether to place the rules above the default WordPress rules (top) or below them (bottom).</li>
</ul>
<p>Say we want to pass a subject line to our contact form through the URL. We could have URLs like <em>/contact/special-offer/</em>, which would load the contact page and prepopulate the subject to “special-offer.” We could add a rewrite rule like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">add_rewrite_rule(</div><div class="line">          &apos;/contact/([^/]+)/?&apos;,</div><div class="line">          &apos;index.php?name=contact&amp;subject=&apos; . $matches[1],</div><div class="line">          &apos;top&apos;</div><div class="line">        );</div><div class="line">add_rewrite_rule(</div><div class="line">flush_rewrite_rules();</div></pre></td></tr></table></figure>
<p>With this rule added to the rewrite rules, a visit to <em>/contact/special-offer/</em> would redirect to the <em>/contact/</em> page and populate the global <code>$wp_query-&gt;query_vars[‘subject’]</code> with the value “special-offer,” or whatever text was added after <em>/contact/</em>. Your contact form could use this value to prepopulate the subject value of the email sent.</p>
<h3 id="Flushing-Rewrite-Rules"><a href="#Flushing-Rewrite-Rules" class="headerlink" title="Flushing Rewrite Rules"></a>Flushing Rewrite Rules</h3><p>WordPress caches the rewrite rules. So when you add a rule like this, you need to flush the rewrite rules so they take effect. Flushing the rewrite rules can take some time, so it’s important that you don’t do it on every page load. To keep the rewrite rules in order, every plugin that affects the rewrite rules should do these three things:</p>
<ol>
<li>Add the rule during plugin activation and immediately flush the rewrite rules using the <code>flush_rewrite_rules()</code> function.</li>
<li>Add the rule during the <code>init</code> hook in case the rules are flushed manually through the Permalinks Settings page of the dashboard or by another plugin.</li>
<li>Add a call to <code>flush_rewrite_rules()</code> during deactivation so the rule is removed on deactivation.</li>
</ol>
<p>The following code shows how our contact subject rule should be added according to the three previous steps:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">//Add rule and flush on activation.</div><div class="line">function sp_activation()</div><div class="line">&#123;</div><div class="line">        add_rewrite_rule(</div><div class="line">          &apos;/contact/([^/]+)/?&apos;,</div><div class="line">          &apos;index.php?name=contact&amp;subject=&apos; . $matches[1],</div><div class="line">          &apos;top&apos;</div><div class="line">        );</div><div class="line">        flush_rewrite_rules();</div><div class="line">&#125;</div><div class="line">register_activation_hook(__FILE__, &apos;sp_activation&apos;);</div><div class="line"></div><div class="line">/*</div><div class="line">  Add rule on init in case another plugin flushes,</div><div class="line">  but don&apos;t flush cause it&apos;s expensive</div><div class="line">*/</div><div class="line">function sp_init()</div><div class="line">&#123;</div><div class="line">        add_rewrite_rule(</div><div class="line">          &apos;/contact/([^/]+)/?&apos;,</div><div class="line">          &apos;index.php?name=contact&amp;subject=&apos; . $matches[1],</div><div class="line">          &apos;top&apos;</div><div class="line">        );</div><div class="line">&#125;</div><div class="line">add_action(&apos;init&apos;, &apos;sp_init&apos;);</div><div class="line"></div><div class="line">//Flush rewrite rules on deactivation to remove our rule.</div><div class="line">function sp_deactivation()</div><div class="line">&#123;</div><div class="line">        flush_rewrite_rules();</div><div class="line">&#125;</div><div class="line">register_deactivation_hook(__FILE__, &apos;sp_deactivation&apos;);</div></pre></td></tr></table></figure>
<h3 id="Other-Rewrite-Functions"><a href="#Other-Rewrite-Functions" class="headerlink" title="Other Rewrite Functions"></a>Other Rewrite Functions</h3><p>WordPress offers some other functions to insert special kinds of rewrite rules. These include:</p>
<dl><br>    <dt><br>        <a href="http://bit.ly/rewrite-api" target="_blank" rel="external"><code>add_rewrite_tag()</code></a><br>    </dt><br>    <dd><br>        Another way to add custom querystring variables.<br>    </dd><br>    <dt><br>        <a href="http://bit.ly/rewrite-add" target="_blank" rel="external"><code>add_feed()</code></a><br>    </dt><br>    <dd><br>        Add a new kind of feed to function like the RSS and ATOM feeds.<br>    </dd><br>    <dt><br>        <a href="http://bit.ly/rewrite-end" target="_blank" rel="external"><code>add_rewrite_endpoint</code></a><br>    </dt><br>    <dd><br>        Add querystring variables to the end of a URL.<br>    </dd><br></dl>

<p>The Codex pages for each function explains things well. Some functions will make more sense for certain uses versus others. The next example shows how to use the <code>add_rewrite_endpoint()</code> function to detect when <em>/doc/</em> is added to the end of a URL and to force the download of a <em>.doc</em> file. This code makes use of the fact that any HTML document with a <em>.doc</em> extension will be read by Microsoft Word as a <em>.doc</em> file.</p>
<p>The <code>add_rewrite_endpoint()</code> function takes two parameters:</p>
<ul>
<li><code>$name</code> —Name of the endpoint, for example, <code>&#39;doc&#39;</code>.</li>
<li><code>$places</code> —Specifies which pages to add the endpoint rule to. Uses the <code>EP_*</code> constants defined in <em>wp-includes/rewrite.php</em>.</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/*</span></div><div class="line">Plugin Name: WP DOC</div><div class="line">Plugin URI: http://bwawwp.com/wp-docx/</div><div class="line">Description: Add /doc/ to the end of a page or post to download a .docx version.</div><div class="line">Version: .1</div><div class="line">Author: Stranger Studios</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">        Register Rewrite Endpoint</div><div class="line">*/</div><div class="line"><span class="comment">//Add /doc/ endpoint on activation.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wpdoc_activation</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">        add_rewrite_endpoint(<span class="string">'doc'</span>, EP_PERMALINK | EP_PAGES);</div><div class="line">        flush_rewrite_rules();</div><div class="line">&#125;</div><div class="line">register_activation_hook(<span class="keyword">__FILE__</span>, <span class="string">'wpdoc_activation'</span>);</div><div class="line"></div><div class="line"><span class="comment">//and init in case another plugin flushes, but don't flush cause it's expensive</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wpdoc_init</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">        add_rewrite_endpoint(<span class="string">'doc'</span>, EP_PERMALINK | EP_PAGES);</div><div class="line">&#125;</div><div class="line">add_action(<span class="string">'init'</span>, <span class="string">'wpdoc_init'</span>);</div><div class="line"></div><div class="line"><span class="comment">//flush rewrite rules on deactivation to remove our endpoint</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wpdoc_deactivation</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">        flush_rewrite_rules();</div><div class="line">&#125;</div><div class="line">register_deactivation_hook(<span class="keyword">__FILE__</span>, <span class="string">'wpdoc_deactivation'</span>);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">        Detect /doc/ use and return a .doc file.</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wpdoc_template_redirect</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">        <span class="keyword">global</span> $wp_query;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($wp_query-&gt;query_vars[<span class="string">'doc'</span>]))</div><div class="line">        &#123;</div><div class="line">                <span class="keyword">global</span> $post;</div><div class="line"></div><div class="line">                <span class="comment">//double check this is a post</span></div><div class="line">                <span class="keyword">if</span>(<span class="keyword">empty</span>($post-&gt;ID))</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">                <span class="comment">//headers for MS Word</span></div><div class="line">                header(<span class="string">"Content-type: application/vnd.ms-word"</span>);</div><div class="line">                header(<span class="string">'Content-Disposition: attachment;Filename='</span>.</div><div class="line">            $post-&gt;post_name.<span class="string">'.doc'</span>);</div><div class="line"></div><div class="line">                <span class="comment">//html</span></div><div class="line">                <span class="meta">?&gt;</span></div><div class="line">                &lt;html&gt;</div><div class="line">                &lt;body&gt;</div><div class="line">                &lt;h1&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $post-&gt;post_title; <span class="meta">?&gt;</span>&lt;/h1&gt;</div><div class="line">                <span class="meta">&lt;?php</span></div><div class="line">                        <span class="keyword">echo</span> apply_filters(<span class="string">'the_content'</span>, $post-&gt;post_content);</div><div class="line">                <span class="meta">?&gt;</span></div><div class="line">                &lt;/body&gt;</div><div class="line">                &lt;/html&gt;</div><div class="line">                <span class="meta">&lt;?php</span></div><div class="line"></div><div class="line">                <span class="keyword">exit</span>;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(<span class="string">'template_redirect'</span>, <span class="string">'wpdoc_template_redirect'</span>);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Note in the preceding example that we follow the three steps we used in the <code>add_rewrite_rule()</code> example to define our rule on activation and init and flush all rules on activation and deactivation.</p>
<p>We used <code>EP_PERMALINK | EP_PAGES</code> when defining our endpoint, which will add the endpoint to single post pages and page pages. The full list of endpoint mask constants is shown below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">EP_NONE</div><div class="line">EP_PERMALINK</div><div class="line">EP_ATTACHMENT</div><div class="line">EP_DATE</div><div class="line">EP_YEAR</div><div class="line">EP_MONTH</div><div class="line">EP_DAY</div><div class="line">EP_ROOT</div><div class="line">EP_COMMENTS</div><div class="line">EP_SEARCH</div><div class="line">EP_CATEGORIES</div><div class="line">EP_TAGS</div><div class="line">EP_AUTHORS</div><div class="line">EP_PAGES</div><div class="line">EP_ALL</div></pre></td></tr></table></figure>
<p>For more information on the Rewrite API, both the <a href="http://bit.ly/rewrite-codex" target="_blank" rel="external">Codex page on the Rewrite API</a> and the Codex page on the <a href="http://bit.ly/class-ref-wp" target="_blank" rel="external">WP_Rewrite class</a> are good sources of information. There is a lot more that can be done with the WP_Rewrite class that we didn’t get into here.</p>
<h2 id="WP-Cron"><a href="#WP-Cron" class="headerlink" title="WP-Cron"></a>WP-Cron</h2><p>A cron job is a script that is run on a server at set intervals. The WP-Cron functions in WordPress extend that functionality to your WordPress site. Cron jobs, sometimes called events, can be set up to run every few minutes, every few hours, every day, or on specific days of the week or month. Some typical uses of cron jobs include queueing up digest emails, syncing data with third-party APIs, and preprocessing CPU-intensive computations used in reports and comparative analysis.</p>
<p>There are three basic parts to adding a cron job to your app:</p>
<ol>
<li>Schedule the cron event. This will fire a specific hook/action at the defined interval.</li>
<li>Hook a function to that action.</li>
<li>Place the code you actually want to run within the callback function.</li>
</ol>
<p>This code can be added to a custom plugin file to schedule some cron jobs:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//schedule crons on plugin activation</div><div class="line">function sp_activation()</div><div class="line">&#123;</div><div class="line">        //do_action(&apos;sp_daily_cron&apos;); will fire daily</div><div class="line">        wp_schedule_event(time(), &apos;daily&apos;, &apos;sp_daily_cron&apos;);</div><div class="line">&#125;</div><div class="line">register_activation_hook(__FILE__, &apos;sp_activation&apos;);</div><div class="line"></div><div class="line">//clear our crons on plugin deactivation</div><div class="line">function sp_deactivation()</div><div class="line">&#123;</div><div class="line">        wp_clear_scheduled_hook(&apos;sp_daily_cron&apos;);</div><div class="line">&#125;</div><div class="line">register_deactivation_hook(__FILE__, &apos;sp_deactivation&apos;);</div><div class="line"></div><div class="line">//function to run daily</div><div class="line">function sp_daily_cron()</div><div class="line">&#123;</div><div class="line">        //do this daily</div><div class="line">&#125;</div><div class="line">add_action(&quot;sp_daily_cron&quot;, &quot;sp_daily_cron&quot;);</div></pre></td></tr></table></figure>
<p>The function <code>wp_schedule_event($timestamp, $recurrence, $hook, $args)</code> has the following attributes:</p>
<ul>
<li>$timestamp—Timestamp for first time to run the hook. You can typically set it to <code>time()</code>.</li>
<li>$recurrence—How often the event should run. You can pass <code>hourly</code>, <code>daily</code>, or <code>twicedaily</code>, or use the <code>cron_schedules</code> hook to add other intervals.</li>
<li>$hook—The name of the action to fire on each recurrence.</li>
<li>$args—Any arguments you’d like to pass along to the hook fired can be added to the end of the <code>wp_schedule_event()</code> call.</li>
</ul>
<p>We like to give our cron events generic names based on the interval. This way, if we wanted to run another function daily, we could just add <code>add_action(‘sp_daily_cron’, ‘new_function_name’);</code> to our codebase.</p>
<h3 id="Adding-Custom-Intervals"><a href="#Adding-Custom-Intervals" class="headerlink" title="Adding Custom Intervals"></a>Adding Custom Intervals</h3><p>By default, the wp_schedule_event() function will only accept intervals of hourly, daily, or twicedaily. To add other intervals, you need to use the cron_schedules hook:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//add a monthly interval to use in cron jobs</div><div class="line">function sp_cron_schedules($schedules)</div><div class="line">&#123;</div><div class="line">        $schedules[&apos;monthly&apos;] = array(</div><div class="line">                &apos;interval&apos; =&gt; 60*60*24*30, //really 30 days</div><div class="line">                &apos;display&apos; =&gt; &apos;Once a Month&apos;</div><div class="line">        );</div><div class="line">&#125;</div><div class="line">add_filter( &apos;cron_schedules&apos;, &apos;sp_cron_schedules&apos; );</div></pre></td></tr></table></figure>
<p>Unlike Unix-based cron jobs, WP-Cron doesn’t support intervals based on day of the week. To do this, you can use a daily cron job and have the function called check the day of the week:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//run on Mondays</div><div class="line">function sp_monday_cron()</div><div class="line">&#123;</div><div class="line">        //get day of the week, 0-6, starting with Sunday</div><div class="line">        $weekday = date(&quot;w&quot;);</div><div class="line"></div><div class="line">        //is it Monday?</div><div class="line">        if($weekday == &quot;1&quot;)</div><div class="line">        &#123;</div><div class="line">                //execute this code on Mondays</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(&quot;sp_daily_cron&quot;, &quot;sp_monday_cron&quot;);</div></pre></td></tr></table></figure>
<p>Unlike Unix-based cron jobs, WP-Cron doesn’t support intervals based on day of the week. To do this, you can use a daily cron job and have the function called check the day of the week:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//run on Mondays</div><div class="line">function sp_monday_cron()</div><div class="line">&#123;</div><div class="line">        //get day of the week, 0-6, starting with Sunday</div><div class="line">        $weekday = date(&quot;w&quot;);</div><div class="line"></div><div class="line">        //is it Monday?</div><div class="line">        if($weekday == &quot;1&quot;)</div><div class="line">        &#123;</div><div class="line">                //execute this code on Mondays</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(&quot;sp_daily_cron&quot;, &quot;sp_monday_cron&quot;);</div></pre></td></tr></table></figure>
<p>You could write similar code to check for a specific day of the month (<code>date(&quot;j&quot;)</code>) or even specific months (<code>date(&quot;m&quot;)</code>)</p>
<h3 id="Scheduling-Single-Events"><a href="#Scheduling-Single-Events" class="headerlink" title="Scheduling Single Events"></a>Scheduling Single Events</h3><p>The preceding examples show how to execute code at some interval. You may also have times when you want to fire an event once at some point in the future. For example, you may want to schedule email delivery of new blog posts one hour after they are posted. This will give authors one hour to fix any issues with the blog posts before it gets pushed around the world. The <code>wp_schedule_single_event()</code> function can be used in these cases where we want schedule an event to fire just once.</p>
<h3 id="Kicking-Off-Cron-Jobs-from-the-Server"><a href="#Kicking-Off-Cron-Jobs-from-the-Server" class="headerlink" title="Kicking Off Cron Jobs from the Server"></a>Kicking Off Cron Jobs from the Server</h3><p>In all of the previous examples, we assumed that events scheduled with <code>wp_schedule_event()</code> would actually run when they are scheduled. That’s almost true.</p>
<p>On Unix systems, the cron service runs every minute (generally) to check if there is a script to run. In WordPress, that check is done on every page load. So if no one loads your website in a given day, or only pages from a static cache are loaded, your cron jobs may not fire off that day. They will fire off with the next page load.</p>
<p>This setup is fine for casual WordPress sites, but our apps need reliability. Luckily, it is easy to disable the internal cron timer and set one up on your web server to fire when you need it to.</p>
<p>To disable the WordPress cron timer, simply add the following to your <em>wp-config.php</em> file:</p>
<pre><code>define(&apos;DISABLE_WP_CRON&apos;, true);
</code></pre><p>This constant just enables or disables the <em>check</em> for events that are ready to fire. You still add and manage events as we did up above. We just need to manually hit the <em>wp-cron.php</em> file in our WordPress install often enough to fire our scripts when needed.</p>
<p>If all you have are daily scripts, you can add a cron job like this via the <code>crontab -e</code> command:</p>
<pre><code>0 0 * * * wget -O - -q -t 1 http://yoursite.com/wp-cron.php?doing_wp_cron=1
</code></pre><p>Information on how to use cron can be found at <a href="http://bit.ly/cronwiki" target="_blank" rel="external">its Wikipedia entry</a>. Information on how to use <code>wget</code> can be found at <a href="http://bit.ly/gnu-manual" target="_blank" rel="external">the <code>wget</code> manual</a>.</p>
<p>The <code>0 0 * * *</code> part of the preceding entry tells cron to execute this script at 0 minutes on the 0th hour (midnight) every day of the week.</p>
<p>The <code>wget -O - -q -t 1 http://yoursite.com/wp-cron.php?doing_wp_cron=1</code> part uses the <code>wget</code> command to load up the <em>wp-cron.php</em> page in your WordPress install. The <code>-O -</code> tells <code>wget</code> to send output to devnull, and the <code>-q</code> enables quiet mode. This will keep cron from adding files to your server or emailing you the outputs of each cron run. The <code>-t 1</code> tells cron to try once. This will keep <code>wget</code> from hitting your server multiple times if the first try fails. If the call to <em>wp-cron.php</em> is failing, the rest of your website is probably failing too; hopefully you’ve already been notified.</p>
<p>Be sure to change <code>yoursite.com</code> to your actual site URL. And finally, the <code>?doing_wp_cron=1</code> on the end of the URL is needed since <em>wp-cron.php</em> will check for that <code>$_GET</code> parameter before running.</p>
<p>Make sure that the URL to <em>wp-cron.php</em> is excluded from any caching mechanisms you may have installed on your site.</p>
<p>This one cron job will fire every day, and any daily cron jobs you scheduled inside of WordPress will fire daily. If you need your crons to run more often, you can change the cron entry to run every hour or every few minutes. Note that a call to <em>wp-cron.php</em> is basically a hit to your website. A check every minute is effectively the same as an additional 1,440 users hitting your site. So schedule your cron jobs conservatively.</p>
<h3 id="Using-Server-Crons-Only"><a href="#Using-Server-Crons-Only" class="headerlink" title="Using Server Crons Only"></a>Using Server Crons Only</h3><p>If you aren’t distributing your code or don’t mind telling your users that they have to set up server-side cron jobs, you don’t need to schedule your cron events in WordPress at all. You can just schedule a server-side cron job that calls a special URL to kick off your callback function. This is especially useful if you need to have more control over what times of day your crons run or otherwise just feel more comfortable managing your cron jobs in Unix instead of WordPress.</p>
<p>The information on scheduling server-side cron jobs in this section can be used to replace WP-Cron for recurring events. Single events set using <code>wp_schedule_single_event()</code> will need to be handled using WP-Cron still or some other mechanism.</p>
<p>If we were running our Monday cron job from earlier, we would update the code in WordPress:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//run on Mondays</div><div class="line">function sp_monday_cron()</div><div class="line">&#123;</div><div class="line">        //check that cron param was passed in</div><div class="line">        if(empty($_REQUEST[&apos;sp_cron_monday&apos;]))</div><div class="line">                return false;</div><div class="line"></div><div class="line">        //execute this code on Mondays</div><div class="line">&#125;</div><div class="line">add_action(&quot;init&quot;, &quot;sp_monday_cron&quot;);</div></pre></td></tr></table></figure>
<p>And your cron job entry would look like this:</p>
<pre><code>0 0 * * 1 wget -O - -q -t 1 http://yoursite.com/?sp_cron_monday=1
</code></pre><p>Again, make sure that the URL to <code>?sp_cron_monday=1</code> is excluded from any caching mechanisms you may have installed on your site.</p>
<h2 id="WP-Mail"><a href="#WP-Mail" class="headerlink" title="WP Mail"></a>WP Mail</h2><p>The <code>wp_mail()</code> function is a replacement for PHP’s built-in <code>mail()</code> function. It looks like this:</p>
<pre><code>wp_mail($to, $subject, $message, $headers, $attachments)
</code></pre><p>and its attributes are:</p>
<ul>
<li>$to—A single email address, comma-separated list of email addresses, or array of email addresses the email will be sent to (using the “To:” field).</li>
<li>$subject—The subject of the email.</li>
<li>$message—The body of the email. By default, the email is sent as a plain-text message and should not include HTML. However, if you change the content type (see the following example), you should include HTML in your message.</li>
<li>$headers—Optional array of mail headers to send with the message. This can be used to add CCs, BCCs, and other advanced mail headers.</li>
<li>$attachments—A single filename or array of filenames to be attached to the outgoing email.</li>
</ul>
<p>There are two major improvements <code>wp_mail()</code> makes over <code>mail()</code>.</p>
<ol>
<li>The <code>wp_mail()</code> function is hookable. The <code>wp_mail</code> filter will pass an array of all of the parameters passed into the <code>wp_mail()</code> function for you to filter. You can also filter the sending address using the <code>wp_mail_from</code> and <code>wp_mail_from_name</code> filters.</li>
<li>The <code>wp_mail()</code> function can be passed a single filename or array of filenames in the <code>$attachments</code> parameters, which will be attached to the outgoing email. Attaching files to emails is very complicated, but <code>wp_mail()</code> makes it easy by wrapping around the PHPMailer class, which itself wraps around the default PHP <code>mail()</code> function.</li>
</ol>
<h3 id="Sending-Nicer-Emails-with-WordPress"><a href="#Sending-Nicer-Emails-with-WordPress" class="headerlink" title="Sending Nicer Emails with WordPress"></a>Sending Nicer Emails with WordPress</h3><p>By default, emails sent through the <code>wp_mail()</code> function are sent from the admin email address set on the General Settings page of the admin dashboard, with “WordPress” used as the name. This is not ideal. You can change these values using the <code>wp_mail_from</code> and <code>wp_mail_from_name</code> filters.</p>
<p>Also by default, emails are sent using plain text. You can use the <code>wp_mail_content_type</code> filter to send your emails using HTML.</p>
<p>Finally, it is nice to add a styled header and footer to all of your outgoing emails. This can be done by filtering the email message using the <code>wp_email</code> filter.</p>
<p>The following code combines these techniques to pretty up the emails being sent by your WordPress app:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">//Update from email and name</div><div class="line">function sp_wp_mail_from($from_email)</div><div class="line">&#123;</div><div class="line">  return &apos;info@schoolpress.me&apos;;</div><div class="line">&#125;</div><div class="line">function sp_wp_mail_from_name($from_name)</div><div class="line">&#123;</div><div class="line">  return &apos;SchoolPress&apos;;</div><div class="line">&#125;</div><div class="line">add_filter(&apos;wp_mail_from&apos;, &apos;sp_wp_mail_from&apos;);</div><div class="line">add_filter(&apos;wp_mail_from_name&apos;, &apos;sp_wp_mail_from_name&apos;);</div><div class="line"></div><div class="line">//send HTML emails instead of plain text</div><div class="line">function sp_wp_mail_content_type( $content_type )</div><div class="line">&#123;</div><div class="line">  if( $content_type == &apos;text/plain&apos;)</div><div class="line">  &#123;</div><div class="line">    $content_type = &apos;text/html&apos;;</div><div class="line">  &#125;</div><div class="line">  return $content_type;</div><div class="line">&#125;</div><div class="line">add_filter(&apos;wp_mail_content_type&apos;, &apos;sp_wp_mail_content_type&apos;);</div><div class="line"></div><div class="line">//add a header and footer from files in the active theme</div><div class="line">function sp_wp_mail_header_footer($email)</div><div class="line">&#123;</div><div class="line">  //get header</div><div class="line">  $headerfile = get_stylesheet_directory() . &quot;email_header.html&quot;;</div><div class="line">  if(file_exists($headerfile))</div><div class="line">    $header = file_get_contents($headerfile);</div><div class="line">  else</div><div class="line">    $header = &quot;&quot;;</div><div class="line"></div><div class="line">  //get footer</div><div class="line">  $footerfile = get_stylesheet_directory() . &quot;email_footer.html&quot;;</div><div class="line">  if(file_exists($footerfile))</div><div class="line">    $footer = file_get_contents($footerfile);</div><div class="line">  else</div><div class="line">    $footer = &quot;&quot;;</div><div class="line"></div><div class="line">  //update message</div><div class="line">  $email[&apos;message&apos;] = $header . $email[&apos;message&apos;] . $footer;</div><div class="line"></div><div class="line">  return $email;</div><div class="line">&#125;</div><div class="line">add_filter(&apos;wp_mail&apos;, &apos;sp_wp_mail_header_footer&apos;);</div></pre></td></tr></table></figure>
<p>Sending emails from your server can present interesting network problems. Running a local SMTP server for sending emails can be time-consuming on top of the work of running a web server. Deliverability of your emails can be affected by spam filters that haven’t whitelisted your apps IP range. The <a href="http://bit.ly/config-smtp" target="_blank" rel="external">Configure SMTP</a> plugin can be used to send your outgoing email through an external SMTP server like a Google Apps account. Services like Mandril and Sendgrid, each with their own WordPress plugin, also offer ways to send email from their trusted servers with additional tracking of open and bounce rates.</p>
<h2 id="File-Header-API"><a href="#File-Header-API" class="headerlink" title="File Header API"></a>File Header API</h2><p>The comment block at the top of the main theme and plugin files are often referred to as headers. The File Header API consists of three functions, <code>get_plugin_data()</code>, <code>wp_get_theme()</code>, and <code>get_file_data()</code>, which allow you to parse these comment blocks.</p>
<p>As a reminder, here is what a plugin’s file header may look like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">Plugin Name: Paid Memberships Pro</div><div class="line">Plugin URI: http://www.paidmembershipspro.com</div><div class="line">Description: Plugin to Handle Memberships</div><div class="line">Version: 1.7.3.2</div><div class="line">Author: Stranger Studios</div><div class="line">Author URI: http://www.strangerstudios.com</div><div class="line">*/</div></pre></td></tr></table></figure>
<p>You can pull this data into an array by calling the <code>get_plugin_data()</code> function:</p>
<pre><code>get_plugin_data($plugin_file, $markup = true, $translate = true)
</code></pre><p>Its attributes are:</p>
<ul>
<li>$plugin_file—The absolute path to the main plugin file where the header will be parsed.</li>
<li>$markup—A flag, which if set to <code>true</code>, will apply HTML markup to some of the header values. For example, the plugin URI will be turned into a link.</li>
<li>$translate—A flag, which if set to <code>true</code>, will translate the header values using the current locale and text domain.</li>
</ul>
<p>The following code loops through the plugins directory and will show data for <em>most</em> of the plugins there. It actually takes quite a bit of logic to find all plugins in all formats. For that you can use the <code>get_plugins()</code> function, which will return an array of all plugins or take a look at the code for that function found in <em>wp-admin/includes/plugin.php</em>. More information on <code>get_plugins()</code> can be found in the <a href="http://bit.ly/funct-ref" target="_blank" rel="external">WordPress Codex</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">//must include this file</div><div class="line">require_once(ABSPATH . &quot;wp-admin/includes/plugin.php&quot;);</div><div class="line"></div><div class="line">//remember current directory</div><div class="line">$cwd = getcwd();</div><div class="line"></div><div class="line">//switch to themes directory</div><div class="line">$plugins_dir = ABSPATH . &quot;wp-content/plugins&quot;;</div><div class="line">chdir($plugins_dir);</div><div class="line"></div><div class="line">echo &quot;&lt;pre&gt;&quot;;</div><div class="line"></div><div class="line">//loop through theme directories and print theme info</div><div class="line">foreach(glob(&quot;*&quot;, GLOB_ONLYDIR) as $dir)</div><div class="line">&#123;</div><div class="line">        $plugin = get_plugin_data($plugins_dir .</div><div class="line">        &quot;/&quot; . $dir . &quot;/&quot; . $dir . &quot;.php&quot;, false, false);</div><div class="line">        print_r($plugin);</div><div class="line">&#125;</div><div class="line"></div><div class="line">echo &quot;&lt;/pre&gt;&quot;;</div><div class="line"></div><div class="line">//switch back to current directory just in case</div><div class="line">chdir($cwd);</div></pre></td></tr></table></figure>
<p>Similarly, you can use <code>wp_get_theme()</code> to get information out of a theme’s file header:</p>
<p>wp_get_theme($stylesheet, $theme_root)</p>
<p>Its attributes are:</p>
<ul>
<li>$stylesheet—The name of the directory for the theme. If not set, this parameter will be the current theme’s directory.</li>
<li>$theme_root—The absolute path to the theme’s root folder. If not set, the value returned by <code>get_raw_theme_root()</code> is used.</li>
</ul>
<p>The following code loops through the themes directory and will show data for <em>most</em> of the themes there. It actually takes quite a bit of logic to find all themes. For that you can use the <code>wp_get_themes()</code> function, which will return an array of all <code>WP_Theme</code> objects or take a look at the code for that function found in <em>wp-includes/theme.php</em>. More information on <code>wp_get_themes()</code> can be found in the <a href="http://bit.ly/wp-get-theme" target="_blank" rel="external">WordPress Codex</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//remember current directory</div><div class="line">$cwd = getcwd();</div><div class="line"></div><div class="line">//switch to themes directory</div><div class="line">$themes_dir = dirname(get_template_directory());</div><div class="line">chdir($themes_dir);</div><div class="line"></div><div class="line">echo &quot;&lt;pre&gt;&quot;;</div><div class="line"></div><div class="line">//loop through theme directories and print theme info</div><div class="line">foreach(glob(&quot;*&quot;, GLOB_ONLYDIR) as $dir)</div><div class="line">&#123;</div><div class="line">        $theme = wp_get_theme($dir);</div><div class="line">        print_r($theme);</div><div class="line">&#125;</div><div class="line"></div><div class="line">echo &quot;&lt;/pre&gt;&quot;;</div><div class="line"></div><div class="line">//switch back to current directory just in case</div><div class="line">chdir($cwd);</div></pre></td></tr></table></figure>
<h3 id="Adding-File-Headers-to-Your-Own-Files"><a href="#Adding-File-Headers-to-Your-Own-Files" class="headerlink" title="Adding File Headers to Your Own Files"></a>Adding File Headers to Your Own Files</h3><p>Both the <code>get_plugin_info()</code> and <code>wp_get_theme()</code> functions make use of the <code>get_file_data()</code> function. You can access the <code>get_file_data()</code> function directly to pull file headers out any file. This can help you to create your own drop-ins or sub-plugins (often referred to as modules or add-ons) for your plugins.</p>
<p><code>get_file_data($file, $default_headers, $context = &quot;&quot;)</code> has the following attributes:</p>
<ul>
<li>$file—The full path and filename of the file to pull data from.</li>
<li>$default_headers—An array of the header fields to look for. The keys of the array should be the header names, and the values of the array should be regex expressions for parsing the label that comes before the “:” in the comment. You can usually just enter the header name as the regex as well.</li>
<li>$context—A label to differentiate between different kinds of headers. This parameter determines which <code>extra_{context}_headers</code> filter is applied to the default headers passed in:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">//set headers for our files</div><div class="line">$default_headers = array(</div><div class="line">        &quot;Title&quot; =&gt; &quot;Title&quot;,</div><div class="line">        &quot;Slug&quot; =&gt; &quot;Slug&quot;,</div><div class="line">        &quot;Version&quot; =&gt; &quot;Version&quot;</div><div class="line">);</div><div class="line"></div><div class="line">//remember current directory</div><div class="line">$cwd = getcwd();</div><div class="line"></div><div class="line">//change to reports directory</div><div class="line">$reports_dir = dirname(__FILE__) . &quot;/reports&quot;;</div><div class="line">chdir($reports_dir);</div><div class="line"></div><div class="line">echo &quot;&lt;pre&gt;&quot;;</div><div class="line"></div><div class="line">//loop through .php files in reports directory</div><div class="line">foreach (glob(&quot;*.php&quot;) as $filename)</div><div class="line">&#123;</div><div class="line">        $data = get_file_data($filename, $default_headers, &quot;report&quot;);</div><div class="line">        print_r($data);</div><div class="line">&#125;</div><div class="line"></div><div class="line">echo &quot;&lt;/pre&gt;&quot;;</div><div class="line"></div><div class="line">//change back to the current directory in case someone expects the default</div><div class="line">chdir($cwd);</div></pre></td></tr></table></figure>
<h3 id="Adding-New-Headers-to-Plugins-and-Themes"><a href="#Adding-New-Headers-to-Plugins-and-Themes" class="headerlink" title="Adding New Headers to Plugins and Themes"></a>Adding New Headers to Plugins and Themes</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/*</span></div><div class="line">Plugin Name: Stop Plugin Updates</div><div class="line">Plugin URI: http://bwawwp.com/plugins/stop-plugin-updates/</div><div class="line">Description: "Allow Updates: No" i a plugin's header keeps it from updating.</div><div class="line">Version: .1</div><div class="line">Author: Stranger Studios</div><div class="line">Author URI: http://www.strangerstudios.com</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="comment">//add AllowUpdates header to plugin</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">spu_extra_plugin_headers</span><span class="params">( $headers )</span> </span>&#123;</div><div class="line">    $headers[<span class="string">'AllowUpdates'</span>] = <span class="string">"Allow Updates"</span>;</div><div class="line">        <span class="keyword">return</span> $headers;</div><div class="line">&#125;</div><div class="line">add_filter( <span class="string">"extra_plugin_headers"</span>, <span class="string">"spu_extra_plugin_headers"</span> );</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">        loop through plugins</div><div class="line">        check if updates are disallowed and if so remove it from list</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">spu_pre_set_site_transient_update_plugins</span><span class="params">( $update_plugins )</span> </span>&#123;</div><div class="line">  <span class="comment">//see if there are any plugins needing updates</span></div><div class="line">  <span class="keyword">if</span> ( !<span class="keyword">empty</span>( $update_plugins ) &amp;&amp; !<span class="keyword">empty</span>( $update_plugins-&gt;response ) ) &#123;</div><div class="line">    <span class="comment">//loop through plugins</span></div><div class="line">    $new_plugins = <span class="keyword">array</span>();</div><div class="line">    <span class="keyword">foreach</span> ( $update_plugins-&gt;response <span class="keyword">as</span> $pluginpath =&gt; $plugin ) &#123;</div><div class="line">        <span class="comment">//check if the plugin is allowed or not</span></div><div class="line">        $plugin_data = ABSPATH . <span class="string">'/wp-content/plugins/'</span> . $pluginpath;</div><div class="line">        $plugin_data = get_plugin_data( $plugin_data );</div><div class="line">        <span class="keyword">if</span> ( strtolower( $plugin_data[<span class="string">'Allow Updates'</span>] ) == <span class="string">"no"</span> ||</div><div class="line">          strtolower( $plugin_data[<span class="string">'Allow Updates'</span>] ) == <span class="string">"false"</span> ) &#123;</div><div class="line">          <span class="comment">//change checked version and don't add to the new response</span></div><div class="line">          $update_plugins-&gt;checked[$pluginpath] = $plugin_data[<span class="string">'Version'</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">//not blocked. add plugin to new response</span></div><div class="line">                $new_plugins[$pluginpath] = $plugin;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    $update_plugins-&gt;response = $new_plugins;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="keyword">return</span> $update_plugins;</div><div class="line">&#125;</div><div class="line">add_action(</div><div class="line">        <span class="string">'pre_set_site_transient_update_plugins'</span>,</div><div class="line">        <span class="string">'spu_pre_set_site_transient_update_plugins'</span></div><div class="line">);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>It adds an <code>Allow Updates</code> header to plugins. If this header is found and the value is <code>no</code> or <code>false</code>, then that plugin will not be flagged to update.</p>
<h2 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h2><ul>
<li><a href="http://codex.wordpress.org/zh-cn:Main_Page" target="_blank" rel="external">zh-cn:WordPress 官方中文文档 « WordPress Codex</a></li>
<li><a href="http://www.smashingmagazine.com/" target="_blank" rel="external">Smashing Magazine – For Professional Web Designers and Developers</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/WordPress/2015-06-01-wordpress-tutorial.html" target="_blank" rel="external">http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wordpress/">wordpress</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&title=《WordPress Tutorial》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&title=《WordPress Tutorial》 — Balance&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《WordPress Tutorial》 — Balance&url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/WordPress/2015-06-02-wordpress-database.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">WordPress Database</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/PHP/2015-05-31-php-test.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">PHP Test</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&title=《WordPress Tutorial》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&title=《WordPress Tutorial》 — Balance&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《WordPress Tutorial》 — Balance&url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/WordPress/2015-06-01-wordpress-tutorial.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACoElEQVR42u3aQZIjIQwEQP//07PXvbi3SiCvIyY5dYS7geQgsMTrFbefv9rzr+07z8/vfr3c8PDw8A6m/jyJdlptD+23z1/h4eHhbfPeRdQc8K63ZBL5O/mc8fDw8L6Hlxy1Z4fvfBQ8PDy838BrD8T5IR4PDw/vf/GSwZJh8rRsniaeLRAeHh7eHi+vIn3P80p9Dw8PD++4qt5eCEiO6bPrArOGh4eHt8HLA25evsrjcxvu23ni4eHhbfPaqScTzS9atcnfYlvCw8PDu8rLP2iPvG34vjWH6at4eHh41Zyj0N9eDsjLWslY1+p7eHh4eGu19dmFp8+8ebkwhoeHhzfiPSdYk45mJbS8t1l5DA8PD2+DdzetMEvjzrai6PiOh4eHt8A7Ce4nadYk9J9cR8DDw8Pb5rWYPDVwsijtRau37+Ph4eGt8ZKAmwT3Noi3FwjyDQYPDw9vj9cW72ek8wU6SZrg4eHhbfNOhp8dspMtIU+a4OHh4X2GN0s6tIWoJDHRLl9dBsPDw8M74OXH4lkJP0/gnmwhb5/x8PDwFnjtwO1mMNtIZsWwtxsSHh4e3gIvHz6/TNAehWepDTw8PLzP825dtGoXqE3a5suBh4eHt81LQv95ojZP3SYFrbp4hoeHh7fGy4dvp55vKq+4XbsugIeHh3fMa5O5eeCebSTn88HDw8Pb450nBdqwfk6N5oaHh4d3lfdTtnxR2i1k1uc/wHh4eHgLvJM//7PLUsm3dy8r4OHh4W3w2q5nmdIW2aY2hgdrPDw8vANeWxh7/mq2TCvJDjw8PLyv590CJ0fz5+0HDw8P73t4SdezdHBeEsvLY3h4eHh7vFmKNin55z3P0g31pSs8PDy8Y177935W4sqLWO3ol7MXeHh4eE/tD6N4XpNo22D7AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
