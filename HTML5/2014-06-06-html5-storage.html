<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>Html5 Storage | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="html5,storage">
    <meta name="description" content="Client StorageTraditional mobile web development centered around the limitations of client handsets, which had very little storage for applications. As handsets become more powerful, however, this ass">
<meta property="og:type" content="article">
<meta property="og:title" content="Html5 Storage">
<meta property="og:url" content="http://blog.inching.org/HTML5/2014-06-06-html5-storage.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="Client StorageTraditional mobile web development centered around the limitations of client handsets, which had very little storage for applications. As handsets become more powerful, however, this ass">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Html5 Storage">
<meta name="twitter:description" content="Client StorageTraditional mobile web development centered around the limitations of client handsets, which had very little storage for applications. As handsets become more powerful, however, this ass">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Html5 Storage</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Html5 Storage</h1>
        <h5 class="subtitle">
            
                <time datetime="2014-06-05T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2014-06-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTML5/">HTML5</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Client-Storage"><span class="post-toc-text">Client Storage</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Storage-on-the-Client-Device"><span class="post-toc-text">Storage on the Client Device</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sandboxed"><span class="post-toc-text">Sandboxed</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Quotas"><span class="post-toc-text">Quotas</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Transactions"><span class="post-toc-text">Transactions</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Synchronous-and-Asynchronous-Modes"><span class="post-toc-text">Synchronous and Asynchronous Modes</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Library"><span class="post-toc-text">Library</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Web-Storage-Simple-Data-Storage"><span class="post-toc-text">Web Storage(Simple Data Storage)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#API"><span class="post-toc-text">API</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Storing-Non-String-Data"><span class="post-toc-text">Storing Non-String Data</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Storage-Events"><span class="post-toc-text">Storage Events</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Library-1"><span class="post-toc-text">Library</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#FileSystem"><span class="post-toc-text">FileSystem</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Offline"><span class="post-toc-text">Offline</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Library-2"><span class="post-toc-text">Library</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Demo"><span class="post-toc-text">Demo</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Ref"><span class="post-toc-text">Ref</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Browser-Support："><span class="post-toc-text">Browser Support：</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tutorial"><span class="post-toc-text">Tutorial</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-html5-storage"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Html5 Storage</h1>
        <div class="post-meta">
            <time class="post-time" title="2014-06-06 00:00:00" datetime="2014-06-05T16:00:00.000Z"  itemprop="datePublished">2014-06-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTML5/">HTML5</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Client-Storage"><a href="#Client-Storage" class="headerlink" title="Client Storage"></a>Client Storage</h2><p>Traditional mobile web development centered around the limitations of client handsets, which had very little storage for applications. As handsets become more powerful, however, this assumption is no longer valid. HTML5’s newly introduced <a href="http://dev.w3.org/html5/webstorage/" target="_blank" rel="external">Web Storage</a> features expand application storage on the client.</p>
<p>HTML 5 standardizes access to an application’s local data via LocalStorage and SessionStorage APIs. These APIs boost the amount of client storage available to web applications. They also can effectively replace cookies as a means to maintain application state and track user preferences.</p>
<p>Local storage persists indefinitely, while session storage lasts only for the duration of a window session. Local storage is available from any page or window from the same site, while session storage is local to each window. Both local and session storage rely on simple key/value pairs, with keys and values both stored as strings.</p>
<p>Local and session storage are not the only client storage available. HTML 5 WebSQL serves as a more full-featured, client-side database. WebSQL brings SQLite-based structured database functionality, typically deployed on servers, to client browser applications. WebSQL is appropriate for data-intensive applications requiring complex queries rather than simple key/value access. WebSQL database transaction calls help avoid interfaces from locking up, facilitate rollback and error handling, and protect against SQL injection. Database versioning allows you to manage schema changes incrementally.</p>
<a id="more"></a>
<h3 id="Storage-on-the-Client-Device"><a href="#Storage-on-the-Client-Device" class="headerlink" title="Storage on the Client Device"></a>Storage on the Client Device</h3><p>In practice, “client-side storage” means data is passed to the browser’s storage API, which saves it on the local device in the same area as it stores other user-specific information, e.g. preferences and cache. Beyond saving data, the APIs let you retrieve data, and in some cases, perform searches and batch manipulations.</p>
<h3 id="Sandboxed"><a href="#Sandboxed" class="headerlink" title="Sandboxed"></a>Sandboxed</h3><p>All four storage APIs tie data to a single “origin”. e.g. if <a href="http://abc.example.com" target="_blank" rel="external">http://abc.example.com</a> saves some data, then the browser will only permit <a href="http://abc.example.com" target="_blank" rel="external">http://abc.example.com</a> to access that data in the future. When it comes to “origins”, the domain must be exactly the same, so <a href="http://example.com" target="_blank" rel="external">http://example.com</a> and <a href="http://def.example.com" target="_blank" rel="external">http://def.example.com</a> are both disqualified. The port must match too, so <a href="http://abc.example.com:123" target="_blank" rel="external">http://abc.example.com:123</a> also cannot see <a href="http://abc.example.com" target="_blank" rel="external">http://abc.example.com</a> (which defaults to port 80), and so must the protocol (http versus https, etc.).</p>
<h3 id="Quotas"><a href="#Quotas" class="headerlink" title="Quotas"></a>Quotas</h3><p>You can imagine the chaos if any website was allowed to populate unsuspecting hard drives with gigabytes of data! Thus, browsers impose limits on storage capacity. When your app attempts to exceed that limit, the browser will typically show a dialog to let the user confirm the increase. You might expect the browser to enforce a single limit for all storage an origin can use, but most enforce limits separately for each storage mechanism. This will change as the <a href="http://www.w3.org/TR/quota-api/" target="_blank" rel="external">Quota API</a> is adopted, but for now, you should think of the browser as maintaining a 2-D matrix, with “origin” in one dimension and “storage” in the other. For example, “<a href="http://abc.example.com" target="_blank" rel="external">http://abc.example.com</a>“ may be allowed to store up to 5MB of Web Storage, 25MB of Web SQL Database Storage, and forbidden to use Indexed Database due to the user denying access. The Quota API brings this into a central location and lets you query how much space is available and in use.</p>
<p>There are also environments where the user can see upfront how much storage will be used, e.g. in the case of the Chrome Web Store, when a user installs an app, they will be prompted upfront to accept its permissions, which include storage limits. One possible value in the manifest is “unlimited_storage”.</p>
<h3 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h3><p>The two “database” storage formats support transactions. The aim is the same reason regular relational databases use transactions: To ensure the integrity of the database. Transactions prevent “race conditions”, a phenomenon where two sequences of operations are applied to the database at the same time, leading to results that are both unpredictable and a database whose state is of dubious accuracy.</p>
<h3 id="Synchronous-and-Asynchronous-Modes"><a href="#Synchronous-and-Asynchronous-Modes" class="headerlink" title="Synchronous and Asynchronous Modes"></a>Synchronous and Asynchronous Modes</h3><p>Most of the storage formats all support synchronous and asynchronous modes.  Synchronous mode is blocking, meaning that the storage operation will be executed to completion before the next line of JavaScript is executed. Asynchronous mode will cause the next lines of JavaScript to be executed before the storage operation completes. The storage operation will be performed in the background and the application will be notified when the operation is finished by way of a callback function being called, a function which must be specified when the call is made.</p>
<p>Synchronous mode should be avoided at all costs, it may seem like a simpler API, but it blocks rendering on the page while the operation completes, and in some cases freezes the whole browser. You’ve probably noticed when sites and even apps do this, you click on a button and everything freezes, you wonder whether it’s crashed, then it springs back to life.</p>
<p>Some APIs don’t have an async mode, such as <code>localStorage</code>, you should carefully performance monitor your use of these APIs, and be prepared to switch to one of the async APIs if it becomes an issue.</p>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h3><ul>
<li><a href="http://pieroxy.net/blog/pages/lz-string/index.html" target="_blank" rel="external">lz-string: JavaScript compression, fast! - pieroxy.net</a> <span class="code">lz-string</span> was designed to fulfill the need of storing large amounts of data in <span class="code">localStorage</span>, specifically on mobile devices. <span class="code">localStorage</span> being usually limited to 5MB, all you can compress is that much more data you can store.</li>
</ul>
<h2 id="Web-Storage-Simple-Data-Storage"><a href="#Web-Storage-Simple-Data-Storage" class="headerlink" title="Web Storage(Simple Data Storage)"></a>Web Storage(Simple Data Storage)</h2><p>参考：<a href="http://dev.w3.org/html5/webstorage/" target="_blank" rel="external">http://dev.w3.org/html5/webstorage/</a></p>
<p>Web存储（web storage），特别是本地存储（local storage）部分，是一个简单的键值存储系统（key/value persistence system）。包括 sessionStorage 和 localStorage。</p>
<p>The <code>localStorage</code> and <code>sessionStorage</code> APIs offer applications up to 5MB of data storage. They both share the same simple key/value interface, but have different namespaces and also differ in the extent to which data is available. Local storage persists indefinitely, while session storage only lasts for the duration of a window session. Local storage is available from any page or window from the same site, while session storage is local to each window.</p>
<p>优点：</p>
<ol>
<li>Supported on all modern browsers, as well as on iOS and Android, for several years (IE since version 8).</li>
<li>Simple API signature.</li>
<li>Simple call flow, being a synchronous API.</li>
<li>Semantic events available to keep other tabs/windows in sync.</li>
</ol>
<p>缺点：</p>
<ol>
<li>Poor performance for large/complex data, when using the synchronous API (which is the most widely supported mode).</li>
<li>Poor performance when searching large/complex data, due to lack of indexing. (Search operations have to manually iterate through all items.)</li>
<li>Poor performance when storing and retrieving large/complex data structures, because it’s necessary to manually serialize and de-serialize to/from string values. The major browser implementations only support string values (even though the spec says otherwise).</li>
<li>Need to ensure data consistency and integrity, since data is effectively unstructured.</li>
</ol>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>The following performs an initial check for support of browser-based storage and assigns the database to a variable:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.localStorage) &#123;</div><div class="line">    <span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line">    <span class="comment">// storage functionality here</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// store data remotely?</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>getItem()</code> method retrieves the value of a database field named key:</p>
<pre><code>var value = db.getItem(&quot;key&quot;);
</code></pre><p>Note that both keys and values are represented as strings. If you specify any other type of data, it is converted silently to a string representation. If <code>getItem()</code> returns null rather than a string value, it means the specified key does not exist.</p>
<p>The <code>setItem()</code> method establishes a new value. When adding data, it is a good idea to check to make sure you haven’t exceeded the allotted storage space:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    db.setItem(<span class="string">"key"</span>, <span class="string">"string"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">catch</span>(err) &#123;</div><div class="line">    <span class="keyword">if</span> (err.QUOTA_EXCEEDED_ERR) &#123;</div><div class="line">        <span class="comment">// storage space is exceeded</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>removeItem()</code> method deletes database fields:</p>
<pre><code>db.removeItem(&quot;key&quot;);
</code></pre><p>The clear() method deletes all key/value pairs within the database, either for an entire site in the case of localStorage, or for an individual window session in the case of sessionStorage:</p>
<pre><code>db.clear();
</code></pre><p>Databases can be accessed as arrays using index notation, useful in cases where you may not know all the field names. The length property returns the number of fields in the database, and the key() method returns the name of the key corresponding to a given index. The following reflects the contents of a database in a JavaScript object:</p>
<pre><code>var obj = {};
for ( var i = 0, l = db.length ; i &lt; l ; i++ ) {
    obj[ db.key(i) ] = db.getItem(db.key(i) );
}
</code></pre><p>Since keys correspond to array indexes, you should not add or remove keys during any operation that iterates over the full set of key/value pairs. Newly introduced keys are introduced randomly into the array’s sequence.</p>
<p>The following displays simple storage functionality. The application prompts for a login and password if they are unavailable. This locally stored data is available the next time users open the browser. However, the contents of the credit card field is stored only for the duration of the browing session.</p>
<h3 id="Storing-Non-String-Data"><a href="#Storing-Non-String-Data" class="headerlink" title="Storing Non-String Data"></a>Storing Non-String Data</h3><p>Since local and session storage APIs only support string values, you need to be careful not to allow errors that result from passive conversions from other data types. The following sample shows how such an error might come about:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line"><span class="keyword">var</span> saveCardInfo;</div><div class="line">    <span class="comment">// user expresses preference NOT to save credit card info:</span></div><div class="line">saveCardInfo = <span class="literal">false</span>;</div><div class="line">    <span class="comment">// BUG happens here...</span></div><div class="line">db.setItem(<span class="string">"save_card_info"</span>, saveCardInfo);</div><div class="line">    <span class="comment">// variable is now a string, not a boolean:</span></div><div class="line">saveCardInfo = db.getItem(<span class="string">"save_card_info"</span>);</div><div class="line">    <span class="comment">// both "true" and "false" strings evaluate as true...</span></div><div class="line"><span class="keyword">if</span> (saveCardInfo) &#123;</div><div class="line">    <span class="comment">// ...so this code always executes...</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// ...and this code never executes.</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The user’s preference to retain credit card information is expressed within the application as a true or false boolean value. When each value is passed to storage, however, it is passively converted to a string. When reassigned to a JavaScript variable, it no longer serves as a valid boolean test. The application falsely assumes users want to save credit card information, regardless of their expressed preference.</p>
<p>The following sample fixes the problem. Instead of using true and false boolean values, it converts 1 and 0 strings to numbers:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line"><span class="keyword">var</span> saveCardInfo = <span class="number">0</span>;</div><div class="line">db.setItem(<span class="string">"save_card_info"</span>, saveCardInfo);</div><div class="line"><span class="comment">// multiplying forces numeric output:</span></div><div class="line">saveCardInfo = db.getItem(<span class="string">"save_card_info"</span>) * <span class="number">1</span>;</div></pre></td></tr></table></figure>
<p>For a more reliable alternative, store values as JSON strings and rely on automatic type conversion when subsequently parsing them. The following sample shows how parsing JSON preserves both boolean and numeric data:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> saveCardInfo = <span class="literal">true</span>;                    <span class="comment">// boolean</span></div><div class="line"><span class="keyword">var</span> shipMethod = <span class="number">2</span>;                        <span class="comment">// number</span></div><div class="line"><span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line">    </div><div class="line">db.setItem(<span class="string">"save_card_info"</span>, <span class="built_in">JSON</span>.stringify(saveCardInfo));</div><div class="line">db.setItem(<span class="string">"ship_method"</span>, <span class="built_in">JSON</span>.stringify(shipMethod));</div><div class="line">    </div><div class="line">saveCardInfo = <span class="built_in">JSON</span>.parse(db.getItem(<span class="string">"save_card_info"</span>));    <span class="comment">// boolean</span></div><div class="line">shipMethod = <span class="built_in">JSON</span>.parse(db.getItem(<span class="string">"ship_method"</span>));        <span class="comment">// number</span></div></pre></td></tr></table></figure>
<p>Note that this simple approach may cause problems of its own. For example, perhaps the words true and false really should be represented as strings. Encapsulating data within objects accounts for such variability:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">bool</span>    : <span class="literal">true</span>,</div><div class="line">    <span class="attr">str</span>        : <span class="string">"true"</span>,</div><div class="line">    <span class="attr">num</span>        : <span class="number">1</span></div><div class="line">&#125;;</div><div class="line">db.setItem(<span class="string">"appState"</span>, <span class="built_in">JSON</span>.stringify(obj));    <span class="comment">// to database...</span></div><div class="line"><span class="comment">// "appState" is "&#123;'bool':true,'num':1,'str':'true'&#125;"</span></div><div class="line">obj = <span class="built_in">JSON</span>.parse(db.getItem(<span class="string">"appState"</span>));    <span class="comment">// ...and back</span></div><div class="line"><span class="comment">// obj is same as initially defined.</span></div></pre></td></tr></table></figure>
<p>The ability to save objects as JSON strings means that you can save an application’s state within a single database field. For example, you might use the following approach to save the entire contents of a shopping cart in a single field for later use:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="built_in">window</span>.localStorage;</div><div class="line"><span class="keyword">var</span> cart = &#123; <span class="attr">items</span>: [] &#125;;</div><div class="line"></div><div class="line">cart.message = <span class="string">"From your loving uncle"</span>;</div><div class="line"></div><div class="line">cart.items.push(&#123;</div><div class="line">    <span class="attr">description</span>    : <span class="string">"Floor to Ceiling Shoe Rack"</span>,</div><div class="line">    <span class="attr">id</span>        : <span class="number">203174676</span>,</div><div class="line">    <span class="attr">price</span>    : <span class="number">99.95</span>,</div><div class="line">    <span class="attr">quantity</span>    : <span class="number">1</span>,</div><div class="line">    <span class="attr">weight</span>    : <span class="number">20</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">cart.items.push(&#123;</div><div class="line">    <span class="attr">description</span>    : <span class="string">"Automatic Laser Toy for Cats"</span>,</div><div class="line">    <span class="attr">id</span>        : <span class="number">203345371</span>,</div><div class="line">    <span class="attr">price</span>    : <span class="number">19.95</span>,</div><div class="line">    <span class="attr">quantity</span>    : <span class="number">2</span>,</div><div class="line">    <span class="attr">weight</span>    : <span class="number">0.5</span>,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// save all cumulative items:</span></div><div class="line">db.setItem(<span class="string">"cart"</span>, <span class="built_in">JSON</span>.stringify(cart));</div><div class="line"></div><div class="line"><span class="comment">// extract items from storage:</span></div><div class="line">cart = <span class="built_in">JSON</span>.parse(db.getItem(<span class="string">"cart"</span>));</div></pre></td></tr></table></figure>
<p>JSON allows you to store data types, but functions are ignored. That makes it more difficult to preserve objects representing fully functional applications.</p>
<h3 id="Storage-Events"><a href="#Storage-Events" class="headerlink" title="Storage Events"></a>Storage Events</h3><p>The storage event allows applications to respond indirectly to modified data resulting from calls to <code>setItem()</code>, <code>removeItem()</code>, or <code>clear()</code>. This may be useful in providing users with visual feedback notifying them of data that is modified locally, perhaps rather than being sent to a remote server:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"storage"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> icon = <span class="built_in">document</span>.querySelector(<span class="string">"#indicator"</span>);</div><div class="line">    <span class="keyword">if</span> (event.storageArea.length) &#123;</div><div class="line">        icon.className = <span class="string">"writing"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        icon.className = <span class="string">"empty"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>The storage event’s storageArea attribute returns the localStorage or sessionStorage object being modified. The key is the name of the field being modified, and oldValue and newValue are its values before and after the event. The url is the page that called the method triggering the change.</p>
<h3 id="Library-1"><a href="#Library-1" class="headerlink" title="Library"></a>Library</h3><ul>
<li><a href="https://github.com/grevory/angular-local-storage" target="_blank" rel="external">grevory/angular-local-storage</a></li>
<li><a href="https://hacks.mozilla.org/2014/02/localforage-offline-storage-improved/" target="_blank" rel="external">localForage: Offline Storage</a></li>
<li><a href="https://github.com/mozilla/around" target="_blank" rel="external">mozilla/around</a></li>
</ul>
<h2 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h2><p>The previous formats are all suitable for text and structured data, but when it comes to large files and binary content, we need something else. Fortunately, we now have a <a href="http://dev.w3.org/2009/dap/file-system/file-dir-sys.html" target="_blank" rel="external">FileSystem API standard</a>. It gives each domain a full hierarchical filesystem, and in Chrome at least, these are real files sitting on the user’s hard drive. For reading and writing of individual files, the API builds on the existing <a href="http://www.w3.org/TR/FileAPI/" target="_blank" rel="external">File API</a>.</p>
<p>优点：</p>
<ol>
<li>Can store large content and binary files, so it’s suitable for images, audio, video, PDFs, etc.</li>
<li>Good performance, being an asynchronous API.</li>
</ol>
<p>缺点：</p>
<ol>
<li>Very early standard. Only available in Chrome and Opera.</li>
<li>No transaction support.</li>
<li>No built-in search/indexing support.</li>
</ol>
<h2 id="Offline"><a href="#Offline" class="headerlink" title="Offline"></a>Offline</h2><ul>
<li><a href="http://www.html5rocks.com/en/features/offline" target="_blank" rel="external">Offline - HTML5 Rocks</a></li>
<li><a href="http://www.html5rocks.com/en/mobile/workingoffthegrid/" target="_blank" rel="external">Working Off the Grid with HTML5 Offline - HTML5 Rocks</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/offline/whats-offline/" target="_blank" rel="external">“Offline”: What does it mean and why should I care? - HTML5 Rocks</a></li>
</ul>
<h2 id="Library-2"><a href="#Library-2" class="headerlink" title="Library"></a>Library</h2><ul>
<li><a href="https://github.com/ask11/storage" target="_blank" rel="external">ask11/storage</a> Asynchronous browser storage with multiple back-ends (IndexedDB, WebSQL, localStorage).</li>
<li><a href="https://github.com/jas-/secStore.js" target="_blank" rel="external">jas-/secStore.js</a> Encryption enabled browser storage.</li>
<li><a href="https://github.com/arokor/barn" target="_blank" rel="external">arokor/barn</a> Fast, atomic persistent storage layer on top of localstorage.</li>
</ul>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><ul>
<li><a href="http://html5demos.com/storage" target="_blank" rel="external">HTML5 Demo: Storage</a></li>
<li><a href="http://www.ellipsetours.com/Demos/storage/" target="_blank" rel="external">Local Storage</a></li>
<li><a href="http://project.mahemoff.com/timer/timer.html" target="_blank" rel="external">Clock</a></li>
</ul>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="http://www.html5rocks.com/en/tutorials/offline/storage/" target="_blank" rel="external">Client-Side Storage - HTML5 Rocks</a></li>
<li><a href="http://qt-project.org/doc/qt-4.8/qtwebkit-guide-cache.html" target="_blank" rel="external">QtWebKit Guide - Client Storage</a></li>
</ul>
<h2 id="Browser-Support："><a href="#Browser-Support：" class="headerlink" title="Browser Support："></a>Browser Support：</h2><ul>
<li><a href="http://caniuse.com/#search=namevalue-storage" target="_blank" rel="external">Web Storage - name/value pairs</a></li>
<li><a href="http://caniuse.com/#search=indexeddb" target="_blank" rel="external">IndexedDB</a></li>
<li><a href="http://caniuse.com/#search=sql-storage" target="_blank" rel="external">Web SQL Database</a></li>
</ul>
<h2 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h2><ul>
<li><a href="http://www.html5rocks.com/en/features/storage" target="_blank" rel="external">Storage - HTML5 Rocks</a></li>
<li><a href="http://dev.w3.org/html5/webstorage/" target="_blank" rel="external">HTML5 Web Storage</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/HTML5/2014-06-06-html5-storage.html" target="_blank" rel="external">http://blog.inching.org/HTML5/2014-06-06-html5-storage.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/">html5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storage/">storage</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&title=《Html5 Storage》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&title=《Html5 Storage》 — Balance&source=Client StorageTraditional mobile web development centered around the limitati..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Html5 Storage》 — Balance&url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/Angular/2014-06-08-angular-tutorial.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Angular Tutorial</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Cordova/2014-06-04-cordova-android.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Cordova For Android</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&title=《Html5 Storage》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&title=《Html5 Storage》 — Balance&source=Client StorageTraditional mobile web development centered around the limitati..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Html5 Storage》 — Balance&url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/HTML5/2014-06-06-html5-storage.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACHUlEQVR42u3aQY7CMAwFUO5/aWaLNEP1v1NGInlZIVpKXheWY/vxiNfzciX3vN75+/5339y8MDAwvpaxssV3V6//JdlDvjcMDIxzGO8efdc9+dX2fzEwMDCu75ltKEkZMTAwMNYZSTrYbuX6RWBgYGAkx9Rkc9fpYBuCP3IWx8DA+EJGXnX//88f6W9gYGB8FeNZrnuPr7M9/LErDAyMrRl3ldLypDBvdrb7wcDA2JWRHFlnB8hZMW44KIaBgXEMI//ZLPi2bcv85WJgYJzAaFO9fENF0BwFdwwMjBMYs3bjLMnLE8fhVQwMjE0ZebjMRy5miWYS9KP3h4GBcRhjfRiibVUOj74YGBgHMPJjant8zctzeYmtbmFiYGBswVgPl3mxLNluS8XAwDiHsVIae5Rr1looMlAMDIyNGCuBctY2mDVKo0IeBgbGpoy2KL9UFCsDcXEwxsDA2JqxAmiHLfIAOhzUwMDAOIBx25RZmSwm6WM0wIGBgXEwYz2Ny1/WrGyHgYFxGiNP7/LEcaXQliSLGBgY5zBWwuLKWMZK+xMDA+MExrNc+a9WtlU3SjEwMLZm3BCty0Zj2/IsZkYwMDC2ZuRBNm8MzIYtVo7KGBgYJzDaYYukkZA/YTY6dsPMCAYGxqaMNo2bfVMPcGBgYGCMzsQrY6ztczAwME5gtE3HWajNwfU0BQYGxtaM/OiYlN7aRuknElYMDIyNGD//u0upcVBsTAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
