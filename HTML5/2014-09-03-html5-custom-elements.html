<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>Custom Elements | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="web,component">
    <meta name="description" content="origin: http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#disqus_thread

TODO: live example
引言现在的 web 严重缺乏表达能力。你只要瞧一眼“现代”的 web 应用，比如 GMail，就会明白我的意思：
[">
<meta property="og:type" content="article">
<meta property="og:title" content="Custom Elements">
<meta property="og:url" content="http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="origin: http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#disqus_thread

TODO: live example
引言现在的 web 严重缺乏表达能力。你只要瞧一眼“现代”的 web 应用，比如 GMail，就会明白我的意思：
[">
<meta property="og:image" content="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/gmail.png">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Custom Elements">
<meta name="twitter:description" content="origin: http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#disqus_thread

TODO: live example
引言现在的 web 严重缺乏表达能力。你只要瞧一眼“现代”的 web 应用，比如 GMail，就会明白我的意思：
[">
<meta name="twitter:image" content="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/gmail.png">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.17">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Custom Elements</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Custom Elements</h1>
        <h5 class="subtitle">
            
                <time datetime="2014-09-02T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2014-09-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTML5/">HTML5</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#引言"><span class="post-toc-text">引言</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#时髦的标记，行动起来！"><span class="post-toc-text">时髦的标记，行动起来！</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#赶紧开始吧"><span class="post-toc-text">赶紧开始吧</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注册新元素"><span class="post-toc-text">注册新元素</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#扩展原生元素"><span class="post-toc-text">扩展原生元素</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#元素如何提升"><span class="post-toc-text">元素如何提升</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Unresolved-元素"><span class="post-toc-text">Unresolved 元素</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实例化元素"><span class="post-toc-text">实例化元素</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实例化自定义标签"><span class="post-toc-text">实例化自定义标签</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实例化类型扩展元素"><span class="post-toc-text">实例化类型扩展元素</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加-JS-属性和方法"><span class="post-toc-text">添加 JS 属性和方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#生命周期回调方法"><span class="post-toc-text">生命周期回调方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加标记"><span class="post-toc-text">添加标记</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#用-Shadow-DOM-封装内部实现"><span class="post-toc-text">用 Shadow DOM 封装内部实现</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#从模板创建元素"><span class="post-toc-text">从模板创建元素</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#为自定义元素增加样式"><span class="post-toc-text">为自定义元素增加样式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为使用-Shadow-DOM-的元素增加样式"><span class="post-toc-text">为使用 Shadow DOM 的元素增加样式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用-unresolved-伪类避免无样式内容闪烁（FOUC）"><span class="post-toc-text">使用 :unresolved 伪类避免无样式内容闪烁（FOUC）</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#历史和浏览器支持"><span class="post-toc-text">历史和浏览器支持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#特性检测"><span class="post-toc-text">特性检测</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器支持"><span class="post-toc-text">浏览器支持</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HTMLElementElement-怎么了？"><span class="post-toc-text">HTMLElementElement 怎么了？</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结语"><span class="post-toc-text">结语</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-html5-custom-elements"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Custom Elements</h1>
        <div class="post-meta">
            <time class="post-time" title="2014-09-03 00:00:00" datetime="2014-09-02T16:00:00.000Z"  itemprop="datePublished">2014-09-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTML5/">HTML5</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>origin: <a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#disqus_thread" target="_blank" rel="external">http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#disqus_thread</a></p>
</blockquote>
<p>TODO: live example</p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>现在的 web 严重缺乏表达能力。你只要瞧一眼“现代”的 web 应用，比如 GMail，就会明白我的意思：</p>
<p>[<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/gmail.png" alt="](http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/gmail.png)" title="">
                </div>
                <div class="image-caption">](http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/gmail.png)</div>
            </figure></p>
<p><sub>现代 web 应用：使用 <code>&lt;div&gt;</code> 堆砌而成。</sub></p>
<p>堆砌 <code>&lt;div&gt;</code> 一点都不现代。然而可悲的是，这就是我们构建 web 应用的方式。在现有基础上我们不应该有更高的追求吗？</p>
<a id="more"></a>
<h3 id="时髦的标记，行动起来！"><a href="#时髦的标记，行动起来！" class="headerlink" title="时髦的标记，行动起来！"></a>时髦的标记，行动起来！</h3><p>HTML 为我们提供了一个完美的文档组织工具，然而 <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/" target="_blank" rel="external">HTML 规范</a>定义的元素却很有限。</p>
<p>假如 GMail 的标记不那么糟糕，而是像下面这样漂亮，那会怎样？</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hangout-module</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">hangout-chat</span> <span class="attr">from</span>=<span class="string">"Paul, Addy"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">hangout-discussion</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">hangout-message</span> <span class="attr">from</span>=<span class="string">"Paul"</span> <span class="attr">profile</span>=<span class="string">"profile.png"</span></span></div><div class="line">          <span class="attr">profile</span>=<span class="string">"118075919496626375791"</span> <span class="attr">datetime</span>=<span class="string">"2013-07-17T12:02"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Feelin' this Web Components thing.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Heard of it?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">hangout-message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">hangout-discussion</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">hangout-chat</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">hangout-chat</span>&gt;</span>...<span class="tag">&lt;/<span class="name">hangout-chat</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hangout-module</span>&gt;</span></div></pre></td></tr></table></figure>
<button><a href="https://html5-demos.appspot.com/hangouts" target="_blank" rel="external">查看演示！</a></button>

<p>真是令人耳目一新！这个应用太合理了，既<strong>有意义</strong>，又<strong>容易理解</strong>。最妙的是，它是<strong>可维护</strong>的，只要查看声明结构就可以清楚地知道它的作用。</p>
<blockquote>
<p>自定义元素，救救我们！就指望你了！</p>
</blockquote>
<h2 id="赶紧开始吧"><a href="#赶紧开始吧" class="headerlink" title="赶紧开始吧"></a>赶紧开始吧</h2><p><a href="http://w3c.github.io/webcomponents/spec/custom/" target="_blank" rel="external">自定义元素</a><br><strong>允许开发者定义新的 HTML 元素类型</strong>。该规范只是 <a href="http://w3c.github.io/webcomponents/explainer/" target="_blank" rel="external">Web 组件</a>模块提供的众多新 API 中的一个，但它也很可能是最重要的一个。没有自定义元素带来的以下特性，Web 组件都不会存在：</p>
<ol>
<li>定义新的 HTML/DOM 元素</li>
<li>基于其他元素创建扩展元素</li>
<li>给一个标签绑定一组自定义功能</li>
<li>扩展已有 DOM 元素的 API</li>
</ol>
<h3 id="注册新元素"><a href="#注册新元素" class="headerlink" title="注册新元素"></a>注册新元素</h3><p>使用 <code>document.registerElement()</code> 可以创建一个自定义元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var XFoo = document.registerElement(&apos;x-foo&apos;);</div><div class="line">document.body.appendChild(new XFoo());</div></pre></td></tr></table></figure>
<p><code>document.registerElement()</code> 的第一个参数是元素的标签名。这个标签名<strong>必须包括一个连字符（-）</strong>。因此，诸如 <code>&lt;x-tags&gt;</code>、<code>&lt;my-element&gt;</code> 和 <code>&lt;my-awesome-app&gt;</code> 都是合法的标签名，而 <code>&lt;tabs&gt;</code> 和 <code>&lt;foo_bar&gt;</code> 则不是。这个限定使解析器能很容易地区分自定义元素和 HTML 规范定义的元素，同时确保了 HTML 增加新标签时的向前兼容。</p>
<p>第二个参数是一个（可选的）对象，用于描述该元素的 <code>prototype</code>。在这里可以为元素添加自定义功能（例如：公开属性和方法）。稍后<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#publicapi" target="_blank" rel="external">详述</a>。</p>
<p>自定义元素默认继承自 <code>HTMLElement</code>，因此上一个示例等同于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var XFoo = document.registerElement(&apos;x-foo&apos;, &#123;</div><div class="line">  prototype: Object.create(HTMLElement.prototype)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>调用 <code>document.registerElement(&#39;x-foo&#39;)</code> 向浏览器注册了这个新元素，并返回一个可以用来创建 <code>&lt;x-foo&gt;</code> 元素实例的构造器。如果你不想使用构造器，也可以使用其他<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#instantiating" target="_blank" rel="external">实例化元素的技术</a>。</p>
<p>如果你不希望在 <code>window</code> 全局对象中创建元素构造器，还可以把它放进命名空间（<code>var myapp = {}; myapp.XFoo = document.registerElement(&#39;x-foo&#39;);</code>）。</p>
<h3 id="扩展原生元素"><a href="#扩展原生元素" class="headerlink" title="扩展原生元素"></a>扩展原生元素</h3><p>假设平淡无奇的原生 <code>&lt;button&gt;</code> 元素不能满足你的需求，你想将其增强为一个“超级按钮”，可以通过创建一个继承 <code>HTMLButtonElement.prototype</code> 的新元素，来扩展 <code>&lt;button&gt;</code> 元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var MegaButton = document.registerElement(&apos;mega-button&apos;, &#123;</div><div class="line">  prototype: Object.create(HTMLButtonElement.prototype)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>要创建扩展自<strong>元素 B</strong> 的<strong>元素 A</strong>，<strong>元素 A</strong> 必须继承<strong>元素 B</strong> 的 <code>prototype</code>。</p>
<p>这类自定义元素被称为<em>类型扩展自定义元素</em>。它们以继承某个特定 <code>HTMLElement</code> 的方式表达了“元素 X 是一个 Y”。</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;button is=&quot;mega-button&quot;&gt;</div></pre></td></tr></table></figure>
<h3 id="元素如何提升"><a href="#元素如何提升" class="headerlink" title="元素如何提升"></a>元素如何提升</h3><p>你有没有想过为什么 HTML 解析器对非标准标签不报错？比如，我们在页面中声明一个 <code>&lt;randomtag&gt;</code>，一切都很和谐。根据 <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlunknownelement" target="_blank" rel="external">HTML 规范</a>的表述：</p>
<blockquote>
<p>  非规范定义的元素必须使用 <code>HTMLUnknownElement</code> 接口。</p>
<p><cite>HTML 规范</cite></p>
</blockquote>
<p><code>&lt;randomtag&gt;</code> 是非标准的，它会继承 <code>HTMLUnknownElement</code>。</p>
<p>对自定义元素来说，情况就不一样了。<strong>拥有合法元素名的自定义元素将继承 <code>HTMLElement</code>。</strong>你可以按 <span class="kbd">Ctrl</span>+<span class="kbd">Shift</span>+<span class="kbd">J</span>（Mac 系统为 <span class="kbd">Cmd</span>+<span class="kbd">Opt</span>+<span class="kbd">J</span>）打开控制台，运行下面这段代码，得到的结果将是 <code>true</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// “tabs”不是一个合法的自定义元素名</div><div class="line">document.createElement(&apos;tabs&apos;).__proto__ === HTMLUnknownElement.prototype</div><div class="line"></div><div class="line">// “x-tabs”是一个合法的自定义元素名</div><div class="line">document.createElement(&apos;x-tabs&apos;).__proto__ == HTMLElement.prototype</div></pre></td></tr></table></figure>
<p>在不支持 <code>document.registerElement()</code> 的浏览器中，<code>&lt;x-tabs&gt;</code> 仍为 <code>HTMLUnknownElement</code>。</p>
<h4 id="Unresolved-元素"><a href="#Unresolved-元素" class="headerlink" title="Unresolved 元素"></a>Unresolved 元素</h4><p>由于自定义元素是通过脚本执行 <code>document.registerElement()</code> 注册的，因此 <strong>它们可能在元素定义被注册到浏览器<em>之前</em>就已经声明或创建过了</strong>。例如：你可以先在页面中声明 <code>&lt;x-tabs&gt;</code>，以后再调用 <code>document.registerElement(&#39;x-tabs&#39;)</code>。</p>
<p>在被提升到其定义之前，这些元素被称为 <strong>unresolved 元素</strong>。它们是拥有合法自定义元素名的 HTML 元素，只是还没有注册成为自定义元素。</p>
<p>下面这个表格看起来更直观一些：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>继承自</th>
<th>示例                                          </th>
</tr>
</thead>
<tbody>
<tr>
<td>unresolved 元素</td>
<td><code>HTMLElement</code></td>
<td><code>&lt;x-tabs&gt;</code>、<code>&lt;my-element&gt;</code>、<code>&lt;my-awesome-app&gt;</code></td>
</tr>
<tr>
<td>未知元素</td>
<td><code>HTMLUnknownElement</code></td>
<td><code>&lt;tabs&gt;</code>、<code>&lt;foo_bar&gt;</code>                        </td>
</tr>
</tbody>
</table>
<blockquote>
<p>把 unresolved 元素想象成尚处于中间状态，它们都是等待被浏览器提升的潜在候选者。浏览器说：“你具备一个新元素的全部特征，我保证会在赋予你定义的时候将你提升为一个元素”。</p>
</blockquote>
<h2 id="实例化元素"><a href="#实例化元素" class="headerlink" title="实例化元素"></a>实例化元素</h2><p>我们创建普通元素用到的一些技术也可以用于自定义元素。和所有标准定义的元素一样，自定义元素既可以在 HTML 中声明，也可以通过 JavaScript 在 DOM 中创建。</p>
<h3 id="实例化自定义标签"><a href="#实例化自定义标签" class="headerlink" title="实例化自定义标签"></a>实例化自定义标签</h3><p><strong>声明</strong>元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;x-foo&gt;&lt;/x-foo&gt;</div></pre></td></tr></table></figure>
<p>在 JS 中<strong>创建 DOM</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var xFoo = document.createElement(&apos;x-foo&apos;);</div><div class="line">xFoo.addEventListener(&apos;click&apos;, function(e) &#123;</div><div class="line">  alert(&apos;Thanks!&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>使用 <strong><code>new</code> 操作符</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var xFoo = new XFoo();</div><div class="line">document.body.appendChild(xFoo);</div></pre></td></tr></table></figure>
<h3 id="实例化类型扩展元素"><a href="#实例化类型扩展元素" class="headerlink" title="实例化类型扩展元素"></a>实例化类型扩展元素</h3><p>实例化类型扩展自定义元素的方法和自定义标签惊人地相似。</p>
<p><strong>声明</strong>元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!-- &lt;button&gt; “是一个”超级按钮 --&gt;</div><div class="line">&lt;button is=&quot;mega-button&quot;&gt;</div></pre></td></tr></table></figure>
<p>在 JS 中<strong>创建 DOM</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var megaButton = document.createElement(&apos;button&apos;, &apos;mega-button&apos;);</div><div class="line">// megaButton instanceof MegaButton === true</div></pre></td></tr></table></figure>
<p>看，这是接收第二个参数为 <code>is=&quot;&quot;</code> 属性的 <code>document.createElement()</code> 重载版本。</p>
<p>使用 <strong><code>new</code> 操作符</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var megaButton = new MegaButton();</div><div class="line">document.body.appendChild(megaButton);</div></pre></td></tr></table></figure>
<p>现在，我们已经学习了如何使用 <code>document.registerElement()</code> 来向浏览器注册一个新标签。但这还不够，接下来我们要向新标签添加属性和方法。</p>
<h2 id="添加-JS-属性和方法"><a href="#添加-JS-属性和方法" class="headerlink" title="添加 JS 属性和方法"></a>添加 JS 属性和方法</h2><p>自定义元素最强大的地方在于，你可以在元素定义中加入属性和方法，给元素绑定特定的功能。你可以把它想象成一种给你的元素创建公开 API 的方法。</p>
<p>这里有一个完整的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var XFooProto = Object.create(HTMLElement.prototype);</div><div class="line"></div><div class="line">// 1. 为 x-foo 创建 foo() 方法</div><div class="line">XFooProto.foo = function() &#123;</div><div class="line">  alert(&apos;foo() called&apos;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 2. 定义一个只读的“bar”属性</div><div class="line">Object.defineProperty(XFooProto, &quot;bar&quot;, &#123;value: 5&#125;);</div><div class="line"></div><div class="line">// 3. 注册 x-foo 的定义</div><div class="line">var XFoo = document.registerElement(&apos;x-foo&apos;, &#123;prototype: XFooProto&#125;);</div><div class="line"></div><div class="line">// 4. 创建一个 x-foo 实例</div><div class="line">var xfoo = document.createElement(&apos;x-foo&apos;);</div><div class="line"></div><div class="line">// 5. 插入页面</div><div class="line">document.body.appendChild(xfoo);</div></pre></td></tr></table></figure>
<p>构造 <code>prototype</code> 的方法多种多样，如果你不喜欢上面这种方式，再看一个更简洁的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var XFoo = document.registerElement(&apos;x-foo&apos;, &#123;</div><div class="line">  prototype: Object.create(HTMLElement.prototype, &#123;</div><div class="line">    bar: &#123;</div><div class="line">      get: function() &#123; return 5; &#125;</div><div class="line">    &#125;,</div><div class="line">    foo: &#123;</div><div class="line">      value: function() &#123;</div><div class="line">        alert(&apos;foo() called&apos;);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>以上两种方式，第一种使用了 ES5 的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external"><code>Object.defineProperty</code></a>，第二种则使用了 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/get" target="_blank" rel="external">get/set</a>。</p>
<h3 id="生命周期回调方法"><a href="#生命周期回调方法" class="headerlink" title="生命周期回调方法"></a>生命周期回调方法</h3><p>元素可以定义特殊的方法，来注入其生存期内关键的时间点。这些方法各自有特定的名称和用途，它们被恰如其分地命名为<strong>生命周期回调</strong>：</p>
<table>
<thead>
<tr>
<th>回调名称</th>
<th>调用时间点        </th>
</tr>
</thead>
<tbody>
<tr>
<td>createdCallback</td>
<td>创建元素实例       </td>
</tr>
<tr>
<td>attachedCallback</td>
<td>向文档插入实例      </td>
</tr>
<tr>
<td>detachedCallback</td>
<td>从文档中移除实例     </td>
</tr>
<tr>
<td>attributeChangedCallback(attrName, oldVal, newVal)</td>
<td>添加，移除，或修改一个属性</td>
</tr>
</tbody>
</table>
<p><strong>示例：</strong>为 <code>&lt;x-foo&gt;</code> 定义 <code>createdCallback()</code> 和 <code>attachedCallback()</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var proto = Object.create(HTMLElement.prototype);</div><div class="line"></div><div class="line">proto.createdCallback = function() &#123;...&#125;;</div><div class="line">proto.attachedCallback = function() &#123;...&#125;;</div><div class="line"></div><div class="line">var XFoo = document.registerElement(&apos;x-foo&apos;, &#123;prototype: proto&#125;);</div></pre></td></tr></table></figure>
<p><strong>所有生命周期回调都是可选的</strong>，你可以只在需要关注的时间点定义它们。例如：假设你有一个很复杂的元素，它会在 <code>createdCallback()</code> 打开一个 IndexedDB 连接。在将其从 DOM 移除时，<code>detachedCallback()</code> 会做一些必要的清理工作。<strong>注意：</strong>不要过于依赖这些生命周期方法（比如用户直接关闭浏览器标签），仅将其作为可能的优化点。</p>
<p>另一个生命周期回调的例子是为元素设置默认的事件监听器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proto.createdCallback = function() &#123;</div><div class="line">  this.addEventListener(&apos;click&apos;, function(e) &#123;</div><div class="line">    alert(&apos;Thanks!&apos;);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<blockquote>
<p>如果你的元素太笨重，是不会有人用它的。生命周期回调可以帮你大忙！</p>
</blockquote>
<h2 id="添加标记"><a href="#添加标记" class="headerlink" title="添加标记"></a>添加标记</h2><p>我们已经创建好 <code>&lt;x-foo&gt;</code> 并添加了 JavaScript API，但它还没有任何内容。不如我们给点 HTML 让它渲染？</p>
<p><a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#lifecycle" target="_blank" rel="external">生命周期回调</a>在这个时候就派上用场了。我们甚至可以用 <code>createdCallback()</code> 给一个元素赋予一些默认的 HTML：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var XFooProto = Object.create(HTMLElement.prototype);</div><div class="line"></div><div class="line">XFooProto.createdCallback = function() &#123;</div><div class="line">  this.innerHTML = &quot;&lt;b&gt;I&apos;m an x-foo-with-markup!&lt;/b&gt;&quot;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var XFoo = document.registerElement(&apos;x-foo-with-markup&apos;, &#123;prototype: XFooProto&#125;);</div></pre></td></tr></table></figure>
<div class="demoarea"><br>    <x-foo-with-markup><b>I’m an x-foo-with-markup!</b></x-foo-with-markup><br></div>

<p>实例化这个标签并在 DevTools 中观察（右击，选择“审查元素”），可以看到如下结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">▾&lt;x-foo-with-markup&gt;</div><div class="line">   &lt;b&gt;I&apos;m an x-foo-with-markup!&lt;/b&gt;</div><div class="line"> &lt;/x-foo-with-markup&gt;</div></pre></td></tr></table></figure>
<h3 id="用-Shadow-DOM-封装内部实现"><a href="#用-Shadow-DOM-封装内部实现" class="headerlink" title="用 Shadow DOM 封装内部实现"></a>用 Shadow DOM 封装内部实现</h3><p><a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom/" target="_blank" rel="external">Shadow DOM</a> 本身是一个封装内容的强大工具，配合使用自定义元素就更神奇了！</p>
<p>Shadow DOM 为自定义元素提供了：</p>
<ol>
<li>一种隐藏内部实现的方法，从而将用户与血淋淋的实现细节隔离开。</li>
<li>简单有效的<a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom-201/" target="_blank" rel="external">样式隔离</a>。</li>
</ol>
<p>从 Shadow DOM 创建元素，跟创建一个渲染基础标记的元素非常类似，区别在于 <code>createdCallback()</code> 回调：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var XFooProto = Object.create(HTMLElement.prototype);</div><div class="line"></div><div class="line">XFooProto.createdCallback = function() &#123;</div><div class="line">  // 1. 为元素附加一个 shadow root。</div><div class="line">  var shadow = this.createShadowRoot();</div><div class="line"></div><div class="line">  // 2. 填入标记。</div><div class="line">  shadow.innerHTML = &quot;&lt;b&gt;I&apos;m in the element&apos;s Shadow DOM!&lt;/b&gt;&quot;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var XFoo = document.registerElement(&apos;x-foo-shadowdom&apos;, &#123;prototype: XFooProto&#125;);</div></pre></td></tr></table></figure>
<div class="demoarea"><br>    <x-foo-shadowdom></x-foo-shadowdom><br></div>

<p>我们并没有直接设置 <code>&lt;x-foo-shadowdom&gt;</code> 的 <code>innerHTML</code>，而是为其创建了一个用于填充标记的 Shadow Root。在 DevTools 设置中勾选“Show Shadow DOM”，你就会看到一个可以展开的 <code>#shadow-root</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">▾&lt;x-foo-shadowdom&gt;</div><div class="line">   ▾#shadow-root</div><div class="line">     &lt;b&gt;I&apos;m in the element&apos;s Shadow DOM!&lt;/b&gt;</div><div class="line"> &lt;/x-foo-shadowdom&gt;</div></pre></td></tr></table></figure>
<p>这就是 Shadow Root！</p>
<h3 id="从模板创建元素"><a href="#从模板创建元素" class="headerlink" title="从模板创建元素"></a>从模板创建元素</h3><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html#the-template-element" target="_blank" rel="external">HTML 模板</a>是另一组跟自定义元素完美融合的新 API。</p>
<p><a href="http://www.html5rocks.com/tutorials/webcomponents/template/" target="_blank" rel="external"><code>&lt;template&gt;</code> 元素</a>可用于声明 DOM 片段。它们可以被解析并在页面加载后插入，以及延迟到运行时才进行实例化。模板是声明自定义元素结构的理想方案。</p>
<p><strong>示例：</strong>注册一个由 <code>&lt;template&gt;</code> 和 Shadow DOM 创建的元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;template id=&quot;sdtemplate&quot;&gt;</div><div class="line">  &lt;style&gt;</div><div class="line">    p &#123; color: orange; &#125;</div><div class="line">  &lt;/style&gt;</div><div class="line">  &lt;p&gt;I&apos;m in Shadow DOM. My markup was stamped from a &amp;lt;template&amp;gt;.&lt;/p&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;script&gt;</div><div class="line">var proto = Object.create(HTMLElement.prototype, &#123;</div><div class="line">  createdCallback: &#123;</div><div class="line">    value: function() &#123;</div><div class="line">      var t = document.querySelector(&apos;#sdtemplate&apos;);</div><div class="line">      var clone = document.importNode(t.content, true);</div><div class="line">      this.createShadowRoot().appendChild(clone);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">document.registerElement(&apos;x-foo-from-template&apos;, &#123;prototype: proto&#125;);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<template id="sdtemplate"><br><style>x-foo-from-template p { color: orange; }</style><br><p>I’m in Shadow DOM. My markup was stamped from a &lt;template&gt;.</p><br></template>

<div class="demoarea"><br>    <x-foo-from-template></x-foo-from-template><br></div>

<p>短短几行做了很多事情，我们挨个来看都发生了些什么：</p>
<ol>
<li>我们在 HTML 中注册了一个新元素：<code>&lt;x-foo-from-template&gt;</code></li>
<li>这个元素的 DOM 是从一个 <code>&lt;template&gt;</code> 创建的</li>
<li>Shadow DOM 隐藏了该元素可怕的细节</li>
<li>Shadow DOM 也对元素的样式进行了隔离（比如 <code>p {color: orange;}</code> 不会把整个页面都搞成<span style="color: orange;">橙色</span>）</li>
</ol>
<p>真不错！</p>
<h2 id="为自定义元素增加样式"><a href="#为自定义元素增加样式" class="headerlink" title="为自定义元素增加样式"></a>为自定义元素增加样式</h2><p>和其他 HTML 标签一样，自定义元素也可以用选择器定义样式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;style&gt;</div><div class="line">  app-panel &#123;</div><div class="line">    display: flex;</div><div class="line">  &#125;</div><div class="line">  [is=&quot;x-item&quot;] &#123;</div><div class="line">    transition: opacity 400ms ease-in-out;</div><div class="line">    opacity: 0.3;</div><div class="line">    flex: 1;</div><div class="line">    text-align: center;</div><div class="line">    border-radius: 50%;</div><div class="line">  &#125;</div><div class="line">  [is=&quot;x-item&quot;]:hover &#123;</div><div class="line">    opacity: 1.0;</div><div class="line">    background: rgb(255, 0, 255);</div><div class="line">    color: white;</div><div class="line">  &#125;</div><div class="line">  app-panel &gt; [is=&quot;x-item&quot;] &#123;</div><div class="line">    padding: 5px;</div><div class="line">    list-style: none;</div><div class="line">    margin: 0 7px;</div><div class="line">  &#125;</div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;app-panel&gt;</div><div class="line">  &lt;li is=&quot;x-item&quot;&gt;Do&lt;/li&gt;</div><div class="line">  &lt;li is=&quot;x-item&quot;&gt;Re&lt;/li&gt;</div><div class="line">  &lt;li is=&quot;x-item&quot;&gt;Mi&lt;/li&gt;</div><div class="line">&lt;/app-panel&gt;</div></pre></td></tr></table></figure>
<div class="demoarea" style="width:300px;"><br>    <app-panel><br>      <li is="x-item">Do</li><br>      <li is="x-item">Re</li><br>      <li is="x-item">Mi</li><br>    </app-panel><br></div>

<h3 id="为使用-Shadow-DOM-的元素增加样式"><a href="#为使用-Shadow-DOM-的元素增加样式" class="headerlink" title="为使用 Shadow DOM 的元素增加样式"></a>为使用 Shadow DOM 的元素增加样式</h3><p>有了 Shadow DOM 场面就热闹得多了，它可以<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#shadowdom" target="_blank" rel="external">极大增强自定义元素的能力</a>。</p>
<p>Shadow DOM 为元素增加了样式封装的特性。Shadow Root 中定义的样式不会暴露到宿主外部或对页面产生影响。<strong>对自定义元素来说，元素本身就是宿主。</strong>样式封装的属性也使得自定义元素能够为自己定义默认样式。</p>
<p>Shadow DOM 的样式是一个很大的话题！如果你想更多地了解它，推荐你阅读我写的其他文章：</p>
<ul>
<li><a href="http://www.polymer-project.org/" target="_blank" rel="external">Polymer</a> 文档：<a href="http://www.polymer-project.org/articles/styling-elements.html" target="_blank" rel="external">《元素样式指南》</a>。</li>
<li>发表于 html5rocks.com 的<a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom-201/" target="_blank" rel="external">《Shadow DOM 201：CSS 和样式》</a>。</li>
</ul>
<h3 id="使用-unresolved-伪类避免无样式内容闪烁（FOUC）"><a href="#使用-unresolved-伪类避免无样式内容闪烁（FOUC）" class="headerlink" title="使用 :unresolved 伪类避免无样式内容闪烁（FOUC）"></a>使用 :unresolved 伪类避免无样式内容闪烁（FOUC）</h3><p>为了缓解<a href="http://en.wikipedia.org/wiki/Flash_of_unstyled_content" target="_blank" rel="external">无样式内容闪烁</a>的影响，自定义元素规范提出了一个新的 CSS 伪类 <code>:unresolved</code>。在浏览器调用你的 <code>createdCallback()</code>（见<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#lifecycle" target="_blank" rel="external">生命周期回调方法</a>一节）之前，这个伪类都可以匹配到 <a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#unresolvedels" target="_blank" rel="external">unresolved 元素</a>。一旦产生调用，就意味着元素已经完成提升，成为它被定义的形态，该元素就不再是一个 unresolved 元素了。</p>
<p>Chrome 29 已经原生支持 CSS <code>:unresolved</code> 伪类。</p>
<p><strong>示例：</strong>注册后渐显的 <code>&lt;x-foo&gt;</code> 标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;style&gt;</div><div class="line">  x-foo &#123;</div><div class="line">    opacity: 1;</div><div class="line">    transition: opacity 300ms;</div><div class="line">  &#125;</div><div class="line">  x-foo:unresolved &#123;</div><div class="line">    opacity: 0;</div><div class="line">  &#125;</div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
<p>请记住 <code>:unresolved</code> 伪类只能用于 <a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#unresolvedels" target="_blank" rel="external">unresolved 元素</a>，而不能用于继承自 <code>HTMLUnkownElement</code> 的元素（见<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#upgrades" target="_blank" rel="external">元素如何提升</a>一节）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;style&gt;</div><div class="line">  /* 给所有 unresolved 元素添加边框 */</div><div class="line">  :unresolved &#123;</div><div class="line">    border: 1px dashed red;</div><div class="line">    display: inline-block;</div><div class="line">  &#125;</div><div class="line">  /* unresolved 元素 x-panel 的文本内容为红色 */</div><div class="line">  x-panel:unresolved &#123;</div><div class="line">    color: red;</div><div class="line">  &#125;</div><div class="line">  /* 定义注册后的 x-panel 文本内容为绿色 */</div><div class="line">  x-panel &#123;</div><div class="line">    color: green;</div><div class="line">    display: block;</div><div class="line">    padding: 5px;</div><div class="line">    display: block;</div><div class="line">  &#125;</div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;panel&gt;</div><div class="line">  I&apos;m black because :unresolved doesn&apos;t apply to &quot;panel&quot;.</div><div class="line">  It&apos;s not a valid custom element name.</div><div class="line">&lt;/panel&gt;</div><div class="line"></div><div class="line">&lt;x-panel&gt;I&apos;m red because I match x-panel:unresolved.&lt;/x-panel&gt;</div></pre></td></tr></table></figure>
<div class="demoarea"><br>    <panel>I’m black because :unresolved doesn’t apply to “panel”. It’s not a valid custom element name.</panel><br><br>    <x-panel>x-panel is registered!</x-panel><br><br>    <button id="register-x-panel">Register &lt;x-panel&gt;</button><br></div>

<p>了解更多 <code>:unresolved</code> 伪类的知识，请看 Polymer 文档<a href="http://www.polymer-project.org/articles/styling-elements.html#preventing-fouc" target="_blank" rel="external">《元素样式指南》</a>。</p>
<h2 id="历史和浏览器支持"><a href="#历史和浏览器支持" class="headerlink" title="历史和浏览器支持"></a>历史和浏览器支持</h2><h3 id="特性检测"><a href="#特性检测" class="headerlink" title="特性检测"></a>特性检测</h3><p>特性检测就是检查 <code>document.registerElement()</code> 是否存在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function supportsCustomElements() &#123;</div><div class="line">  return &apos;registerElement&apos; in document;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (supportsCustomElements()) &#123;</div><div class="line">  // Good to go!</div><div class="line">&#125; else &#123;</div><div class="line">  // Use other libraries to create components.</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="浏览器支持"><a href="#浏览器支持" class="headerlink" title="浏览器支持"></a>浏览器支持</h3><p>Chrome 27 和 Firefox 23 都提供了对 <code>document.registerElement()</code> 的支持，不过之后规范又有一些演化。Chrome 31 将是第一个真正支持新规范的版本。</p>
<p>在 Chrome 31 中使用自定义元素，需要开启 <code>about:flags</code> 中的“实验性 web 平台特性（Experimental Web Platform features）”选项。</p>
<p>在浏览器支持稳定之前，也有一些很好的兼容方案：</p>
<ul>
<li>Google 的 <a href="http://polymer-project.org/" target="_blank" rel="external">Polymer</a> 集成了一个<a href="http://www.polymer-project.org/platform/custom-elements.html" target="_blank" rel="external">兼容方案</a></li>
<li>Mozilla 的 <a href="http://www.x-tags.org/" target="_blank" rel="external">x-tags</a></li>
</ul>
<h3 id="HTMLElementElement-怎么了？"><a href="#HTMLElementElement-怎么了？" class="headerlink" title="HTMLElementElement 怎么了？"></a>HTMLElementElement 怎么了？</h3><p>一直关注标准的人都知道曾经有一个 <code>&lt;element&gt;</code> 标签。它非常好用，你只要像下面这样就可以声明式地注册一个新元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;element name=&quot;my-element&quot;&gt;</div><div class="line">  ...</div><div class="line">&lt;/element&gt;</div></pre></td></tr></table></figure>
<p>然而很不幸，在它的<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#upgrades" target="_blank" rel="external">提升过程</a>、边界案例，以及末日般的复杂场景中，需要处理大量的时序问题。<code>&lt;element&gt;</code> 因此被迫搁置。2013 年 8 月，Dimitri Glazkov 在 <a href="http://lists.w3.org/Archives/Public/public-webapps/2013JulSep/0287.html" target="_blank" rel="external">public-webapps</a> 邮件组中宣告移除 <code>&lt;element&gt;</code>。</p>
<p>值得注意的是，Polymer 实现了以 <code>&lt;polymer-element&gt;</code> 的形式声明式地注册元素。这是怎么做到的？它用的正是 <code>document.registerElement(&#39;polymer-element&#39;)</code> 以及我在<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/#fromtemplate" target="_blank" rel="external">从模板创建元素</a>一节介绍的技术。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>自定义元素为我们提供了一个工具，通过它我们可以扩展 HTML 的词汇，赋予它新的特性，并把不同的 web 平台连接在一起。结合其他新的基本平台，如 Shadow DOM 和 <code>&lt;template&gt;</code>，我们领略了 web 组件的宏伟蓝图。标记语言将再次变得很时髦！</p>
<p>如果你对使用 web 组件感兴趣，建议你看看 <a href="http://polymer-project.org/" target="_blank" rel="external">Polymer</a>，就它已经够你玩的了。</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/HTML5/2014-09-03-html5-custom-elements.html" target="_blank" rel="external">http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/component/">component</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&title=《Custom Elements》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&title=《Custom Elements》 — Balance&source=
origin: http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Custom Elements》 — Balance&url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/HTML5/2014-09-04-html5-seo.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">HTML SEO</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/JavaScript/2014-09-02-bootstrap-tutorial.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Bootstrap Tutorial</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&title=《Custom Elements》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&title=《Custom Elements》 — Balance&source=
origin: http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Custom Elements》 — Balance&url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/HTML5/2014-09-03-html5-custom-elements.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtElEQVR42u3a0W7bMAwF0P7/T3fAnjasUS9J0UuB46fAsR0dBRBpUh8f8fH5+/j3zKsjedqrK/88X31y88DDw8NrDf080PNQznfl3ybU8uTi4eHhrfGqj66GjXyazph8zHh4eHjvwKsOOs9y8yQeDw8P72fxckxSPjiHk94Y8PDw8J7kbZQV8uT7zMvHg4eHh/cMr9oAe4fPi/09PDw8vEFXPVl250t2DiuPEw8PD2+BlxcOeqWEZEHvXV8IGHh4eHiP8HrLel4+qMImAQYPDw9vg5eEh975pCBbHUOe3OPh4eE9yZu0oJLmVq+0MXoZwMPDw7vEy1tNeaGhmjrnpCR9/+JdAQ8PD2+Z1ytJVPv4vbJvHlT+6u/h4eHhXeUlSXO+6CcBoFr8zcsfzXcFPDw8vBav2ri6tejfugsPDw/veV715X/y7SSBbpZ98fDw8K7yJkvwOV2eb9K60MnCw8PDW+Dl0aMaBpK7eiHkHDC+GAkeHh7eVV616VU909vCNZkOPDw8vG1eteaZDzRvX1WbatUyNB4eHt5dXi91TgqvyfneEwojxMPDw1vg5VuaknZUNTDMp6m8pQAPDw/vEi8v4PYCQ2/bQZ6sF/4xPDw8vKu8PG2tlgl62w7yqfzmejw8PLwFXrU1lSTN+XT0NlSVgxMeHh7eAi9/7d+ejsvbBfDw8PAWeMk2qUkhI3ly766oGI2Hh4e3xpsktVVGuZQwOfDw8PCu8j6LR9J86iXEye+WJxcPDw9vgbcXPKrlhnzjQv4reHh4eHu8fFHOtw6c22BJk2yS0OPh4eE9w8uDQVLAbW6NGkSwl8/Hw8PDewNec4FuNbd6hYlRYMDDw8O7yqsm1r0r82CTBDA8PDy8PV7efMrDxt022Ki5hYeHh/dfN2b1Cq95Q2u+eQsPDw9vjfcLkXMNAduOTSoAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
