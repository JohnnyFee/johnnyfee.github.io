<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>Android Data Binding | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="android">
    <meta name="description" content="Tutorial
Data Binding（数据绑定）用户指南
Data Binding Guide (Android)
LyndonChin/MasteringAndroidDataBinding: A comprehensive tutorial for Android Data Binding
Applying Data Binding for Views
Two-way Android d">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Data Binding">
<meta property="og:url" content="http://blog.inching.org/Android/2016-09-07-android-data-binding.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="Tutorial
Data Binding（数据绑定）用户指南
Data Binding Guide (Android)
LyndonChin/MasteringAndroidDataBinding: A comprehensive tutorial for Android Data Binding
Applying Data Binding for Views
Two-way Android d">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Data Binding">
<meta name="twitter:description" content="Tutorial
Data Binding（数据绑定）用户指南
Data Binding Guide (Android)
LyndonChin/MasteringAndroidDataBinding: A comprehensive tutorial for Android Data Binding
Applying Data Binding for Views
Two-way Android d">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android Data Binding</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Android Data Binding</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-09-06T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2016-09-07
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tutorial"><span class="post-toc-text">Tutorial</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#介绍"><span class="post-toc-text">介绍</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#构建环境"><span class="post-toc-text">构建环境</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Data-Binding-Layout文件"><span class="post-toc-text">Data Binding Layout文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Data-Binding表达式"><span class="post-toc-text">Data Binding表达式</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Data对象"><span class="post-toc-text">Data对象</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Binding数据"><span class="post-toc-text">Binding数据</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#事件处理"><span class="post-toc-text">事件处理</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#深入Layout文件"><span class="post-toc-text">深入Layout文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Import"><span class="post-toc-text">Import</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Variables"><span class="post-toc-text">Variables</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#自定义Binding类名称"><span class="post-toc-text">自定义Binding类名称</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Data-对象"><span class="post-toc-text">Data 对象</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Observable-对象"><span class="post-toc-text">Observable 对象</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Observable-字段"><span class="post-toc-text">Observable 字段</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Observable-集合"><span class="post-toc-text">Observable 集合</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Binding生成"><span class="post-toc-text">Binding生成</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#创建"><span class="post-toc-text">创建</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#带ID的Views"><span class="post-toc-text">带ID的Views</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Variables-1"><span class="post-toc-text">Variables</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#ViewStubs"><span class="post-toc-text">ViewStubs</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Binding进阶"><span class="post-toc-text">Binding进阶</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#属性Setters"><span class="post-toc-text">属性Setters</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#自动Setters"><span class="post-toc-text">自动Setters</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#重命名的Setters"><span class="post-toc-text">重命名的Setters</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#自定义Setters"><span class="post-toc-text">自定义Setters</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#转换"><span class="post-toc-text">转换</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#对象转换"><span class="post-toc-text">对象转换</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#自定义转换"><span class="post-toc-text">自定义转换</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Android-Studio支持"><span class="post-toc-text">Android Studio支持</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#More"><span class="post-toc-text">More</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Other-MVVM-Architecture"><span class="post-toc-text">Other MVVM Architecture</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Best-Practice"><span class="post-toc-text">Best Practice</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#FAQ"><span class="post-toc-text">FAQ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Library"><span class="post-toc-text">Library</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-android-data-binding"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Android Data Binding</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-09-07 00:00:00" datetime="2016-09-06T16:00:00.000Z"  itemprop="datePublished">2016-09-07</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h2><ul>
<li><a href="http://www.jianshu.com/p/b1df61a4df77" target="_blank" rel="external">Data Binding（数据绑定）用户指南</a></li>
<li><a href="https://developer.android.com/tools/data-binding/guide.html" target="_blank" rel="external">Data Binding Guide (Android)</a></li>
<li><a href="https://github.com/LyndonChin/MasteringAndroidDataBinding" target="_blank" rel="external">LyndonChin/MasteringAndroidDataBinding: A comprehensive tutorial for Android Data Binding</a></li>
<li><a href="https://guides.codepath.com/android/Applying-Data-Binding-for-Views" target="_blank" rel="external">Applying Data Binding for Views</a></li>
<li><a href="https://medium.com/@fabioCollini/android-data-binding-f9f9d3afc761#.z2gx4qqdv" target="_blank" rel="external">Two-way Android data binding – Medium</a></li>
</ul>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>这篇文章介绍了如何使用Data Binding库来写声明的layouts文件，并且用最少的代码来绑定你的app逻辑和layouts文件。</p>
<p>Data Binding库不仅灵活而且广泛兼容- 它是一个support库，因此你可以在所有的Android平台最低能到Android 2.1（API等级7+）上使用它。</p>
<p><strong>需求：</strong>Android Plugin for Gradle <strong>1.5.0-alpha1</strong> 或 <strong>更高版本</strong>。</p>
<h2 id="构建环境"><a href="#构建环境" class="headerlink" title="构建环境"></a>构建环境</h2><p>要开始使用Data Binding，首先需要在Android SDK Manager的支持库里下载该库。</p>
<p>你的app要使用Data Binding，需要添加Data Binding到gradle构建文件里，如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    ....</div><div class="line">    dataBinding &#123;</div><div class="line">        enabled = <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Data Binding插件将会在你的项目内添加必需提供的以及编译配置依赖。</p>
<p>请确保您使用的是Android Studio的兼容版本。Android Studio的Data Binding插件需要Android Studio <strong>1.3.0</strong> 或 <strong>更高版本</strong>。</p>
<h2 id="Data-Binding-Layout文件"><a href="#Data-Binding-Layout文件" class="headerlink" title="Data Binding Layout文件"></a>Data Binding Layout文件</h2><h5 id="Data-Binding表达式"><a href="#Data-Binding表达式" class="headerlink" title="Data Binding表达式"></a>Data Binding表达式</h5><p>Data Binding layout文件有点不同的是：起始根标签是<strong>layout</strong>，接下来一个<strong>data</strong>元素以及一个<strong>view</strong>的根元素。这个<strong>view</strong>元素就是你没有使用Data Binding的layout文件的根元素。举例说明如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName&#125;"</span>/&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.lastName&#125;"</span>/&gt;</div><div class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在<strong>data</strong>内描述了一个名为user的变量属性，使其可以在这个layout中使用：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;variable name=<span class="string">"user"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.User"</span>/&gt;</div></pre></td></tr></table></figure>
<p>在layout的属性表达式写作<code>@{}</code>，下面是一个TextView的text设置为user的firstName属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName&#125;"</span>/&gt;</div></pre></td></tr></table></figure>
<h5 id="Data对象"><a href="#Data对象" class="headerlink" title="Data对象"></a>Data对象</h5><p>假设你有一个<strong>user</strong>的plain-old Java Object（POJO）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String firstName;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String lastName;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.firstName = firstName;</div><div class="line">       <span class="keyword">this</span>.lastName = lastName;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个类型的对象拥有从不改变的数据。在app中它是常见的，可以读取一次并且之后从不改变。当然也可以使用JavaBeans对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String firstName;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String lastName;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.firstName = firstName;</div><div class="line">       <span class="keyword">this</span>.lastName = lastName;</div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.firstName;</div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.lastName;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从Data Binding的角度来看，这两个类是等价的。用于TextView中的<code>android:text</code>属性的表达式<code>@{user.firstName}</code>将访问前者POJO对象中的<code>firstName</code>和后者JavaBeans对象中的<code>getFirstName()</code>方法。Alternatively, it will also be resolved to <code>firstName()</code> if that method exists.</p>
<h5 id="Binding数据"><a href="#Binding数据" class="headerlink" title="Binding数据"></a>Binding数据</h5><p>默认情况下，一个Binding类会基于layout文件的名称而产生，将其转换为Pascal case（译注：首字母大写的命名规范）并且添加“Binding”后缀。上述的layout文件是<code>activity_main.xml</code>，因此生成的类名是<code>ActivityMainBinding</code>。此类包含从layout属性到layout的Views中所有的bindings（例如<code>user</code>变量），并且它还知道如何给Binding表达式分配数值。创建bindings的最简单的方式是在inflating（译注：layout文件与Activity/Fragment的“链接”）期间如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">   <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">   ActivityMainBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.main_activity);</div><div class="line">   User user = <span class="keyword">new</span> User(<span class="string">"Test"</span>, <span class="string">"User"</span>);</div><div class="line">   binding.setUser(user);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就是这样，运行app后，你将会看到Test User。或者你可以通过如下获取View：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MainActivityBinding binding = MainActivityBinding.inflate(getLayoutInflater());</div></pre></td></tr></table></figure>
<p>如果你在<strong>ListView</strong>或者<strong>RecyclerView</strong> adapter使用Data Binding时，你可能会使用：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ListItemBinding binding = ListItemBinding.inflate(layoutInflater, viewGroup,</div><div class="line"><span class="literal">false</span>);</div><div class="line"><span class="comment">//or</span></div><div class="line">ListItemBinding binding = DataBindingUtil.inflate(layoutInflater, R.layout.list_item, viewGroup, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<h5 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h5><p>数据绑定允许你编写表达式来处理view分派的事件。事件属性名字取决于监听器方法名字。例如<a href="https://developer.android.com/reference/android/view/View.OnLongClickListener.html" target="_blank" rel="external">View.OnLongClickListener</a>有<a href="https://developer.android.com/reference/android/view/View.OnLongClickListener.html#onLongClick(android.view.View" target="_blank" rel="external">onLongClick()</a>)的方法，因此这个事件的属性是<code>android:onLongClick</code>。处理事件有两种方法：</p>
<ul>
<li><a href="https://developer.android.com/topic/libraries/data-binding/index.html#method_references" target="_blank" rel="external">Method References</a></li>
<li><a href="https://developer.android.com/topic/libraries/data-binding/index.html#listener_bindings" target="_blank" rel="external">Listener Bindings</a></li>
</ul>
<h2 id="深入Layout文件"><a href="#深入Layout文件" class="headerlink" title="深入Layout文件"></a>深入Layout文件</h2><h5 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h5><p>零个或多个<code>import</code>元素可能在<code>data</code>元素中使用。这些只用在你的layout文件中添加引用，就像在Java中：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"android.view.View"</span>/&gt;</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>现在，View可以使用你的Binding表达式：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;TextView</div><div class="line">   android:text=<span class="string">"<span class="subst">@&#123;user.lastName&#125;</span>"</span></div><div class="line">   android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">   android:layout_height=<span class="string">"wrap_content"</span></div><div class="line">   android:visibility=<span class="string">"<span class="subst">@&#123;user.isAdult ? View.VISIBLE : View.GONE&#125;</span>"</span>/&gt;</div></pre></td></tr></table></figure>
<p>当类名有冲突时，其中一个类名可以重命名为<code>alias:</code>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"android.view.View"</span>/&gt;</div><div class="line">&lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.real.estate.View"</span></div><div class="line">        alias=<span class="string">"Vista"</span>/&gt;</div></pre></td></tr></table></figure>
<p>这样，在该layout文件中<code>Vista</code>对应<code>com.example.real.estate.View</code>，而<code>View</code>对应<code>android.view.View</code>。导入的类型可以在Variable和表达式中使用作为引用来使用：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.User"</span>/&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"java.util.List"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"user"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"User"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"userList"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"List&lt;User&gt;"</span>/&gt;</div><div class="line"> &lt;/data&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：Android Studio还没有处理<strong>imports</strong>，所以自动导入Variable在你的IDE不能使用。您的app仍会正常编译，你可以在您的Variable定义中使用完全符合规定的名称来解决该IDE问题。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">"@&#123;((User)(user.connection)).lastName&#125;"</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<p>导入的类型还可以在表达式中使用static属性和方法：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.MyStringUtils"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"user"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.User"</span>/&gt;</div><div class="line">&lt;/data&gt;</div><div class="line">…</div><div class="line">&lt;<span class="type">TextView</span></div><div class="line">   android:text=<span class="string">"@&#123;MyStringUtils.capitalize(user.lastName)&#125;"</span></div><div class="line">   android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">   android:layout_height=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<p>就像在Java中，<code>java.lang。*</code>是自动导入的。</p>
<h5 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h5><p>在<code>data</code>中可以使用任意数量的<code>variable</code>元素。每一个<code>variable</code>元素描述了一个用于layout文件中Binding表达式的属性。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"android.graphics.drawable.Drawable"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"user"</span>  <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.User"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"image"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"Drawable"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"note"</span>  <span class="class"><span class="keyword">type</span></span>=<span class="string">"String"</span>/&gt;</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>该<code>Variable</code>类型在编译时检查，因此如果一个Variable实现了<a href="https://developer.android.com/tools/data-binding/guide.html#observable_objects" target="_blank" rel="external">Observable</a>或<a href="https://developer.android.com/tools/data-binding/guide.html#observable_collections" target="_blank" rel="external">observable collection</a>，这应该反映在类型中。（译注：需要查找资料来理解）如果variable是一个没有实现Observable接口的基本类或者接口，Variables不会被observed！</p>
<p>当对于多种配置有不同的layout文件时（如，横向或纵向），Variables会被合并。这些layout文件之间必须不能有冲突的Variable定义。</p>
<p>产生的Binding类对于每一个描述的Variables都会有setter和getter。这些Variables会使用默认的Java值 - null（引用类型）、0（int）、false（boolean）等等，直到调用setter时。</p>
<h5 id="自定义Binding类名称"><a href="#自定义Binding类名称" class="headerlink" title="自定义Binding类名称"></a>自定义Binding类名称</h5><p>默认情况下，Binding类的命名是基于所述layout文件的名称，用大写开头，除去下划线（<em>）以及（</em>）后的第一个字母大写，然后添加“Binding”后缀。这个类将被放置在一个模块封装包里的<code>databinding</code>封装包下。例如，所述layout文件<code>contact_item.xml</code>将生成<code>ContactItemBinding</code>。如果模块包是<code>com.example.my.app</code>，那么它将被放置在<code>com.example.my.app.databinding</code>。</p>
<p>Binding类可通过调整<code>data</code>元素中的<code>class</code>属性来重命名或放置在不同的包中。例如：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">"ContactItem"</span>&gt;</div><div class="line">    ...</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>在模块封装包的databinding包中会生成名为<code>ContactItem</code>的Binding类。如果要想让该类生成在不同的包种，你需要添加前缀<code>.</code>，如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">".ContactItem"</span>&gt;</div><div class="line">    ...</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>在这个情况下，<code>ContactItem</code>类直接在模块包种生成。或者你可以提供整个包名：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;data <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.example.ContactItem"</span>&gt;</div><div class="line">    ...</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>#####Includes</p>
<p>通过使用<strong>application namespace</strong>以及在属性中的<strong>Variable</strong>名字从容器layout中传递Variables到一个被包含的layout：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">        <span class="attr">xmlns:bind</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</div><div class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/name"</span></span></div><div class="line">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/contact"</span></span></div><div class="line">           <span class="attr">bind:user</span>=<span class="string">"@&#123;user&#125;"</span>/&gt;</div><div class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>注意：在<code>name.xml</code>以及<code>contact.xml</code>两个layout文件中必需要有<code>user</code> variable</p>
<p>#####表达式</p>
<ul>
<li><p>常用表达式跟Java表达式很像，以下这些是一样的：</p>
<ul>
<li>数学 <code>+</code> <code>-</code> <code>/</code> <code>*</code> <code>%</code></li>
<li>字符串连接 <code>+</code></li>
<li>逻辑 <code>&amp;&amp;</code> <code>||</code></li>
<li>二进制 <code>&amp;</code> <code>|</code> <code>^</code></li>
<li>一元运算 <code>+</code> <code>-</code> <code>!</code> <code>~</code></li>
<li>移位 <code>&gt;&gt;</code> <code>&gt;&gt;&gt;</code> <code>&lt;&lt;</code></li>
<li>比较 <code>==</code> <code>&gt;</code> <code>&lt;</code> <code>&gt;=</code> <code>&lt;=</code></li>
<li><code>instanceof</code></li>
<li>分组 <code>()</code></li>
<li><code>null</code></li>
<li><code>Cast</code></li>
<li>方法调用</li>
<li>数据访问 <code>[]</code></li>
<li><p>三元运算 <code>?:</code></p>
</li>
<li><p>示例：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;String.valueOf(<span class="keyword">index</span> + <span class="number">1</span>)&#125;</span>"</span></div><div class="line">android:visibility=<span class="string">"<span class="subst">@&#123;age &lt; <span class="number">13</span> ? View.GONE : View.VISIBLE&#125;</span>"</span></div><div class="line">android:transitionName=<span class="string">'@&#123;"image_" + id&#125;'</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>缺少的操作：</p>
<ul>
<li><code>this</code></li>
<li><code>super</code></li>
<li><code>new</code></li>
<li>显式泛型调用</li>
</ul>
</li>
<li><p>Null合并操作</p>
<ul>
<li><p><code>??</code> - 左边的对象如果它不是null，选择左边的对象；或者如果它是null，选择右边的对象：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;user.displayName ?? user.lastName&#125;</span>"</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>函数上的写法如下：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;user.displayName != null ? user.displayName : user.lastName&#125;</span>"</span></div></pre></td></tr></table></figure>
</li>
<li><p>属性引用<br>  第一个已经在前边提到了<code>a）Data Binding表达式</code>：JavaBean引用的简短格式。<br>  当一个表达式引用一个类的属性，它仍使用同样的格式对于字段、getters以及ObservableFields。</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;user.lastName&#125;</span>"</span></div></pre></td></tr></table></figure>
</li>
<li><p>避免 NullPointerException<br>  Data Binding代码生成时自动检查是否为nulls来避免出现null pointer exceptions错误。例如，在表达式<code>@{user.name}</code>中，如果<code>user</code>是null，<code>user.name</code>会赋予它的默认值（<strong>null</strong>）。如果你引用<code>user.age</code>，age是<code>int</code>类型，那么它的默认值是<strong>0</strong>。</p>
</li>
<li><p>集合<br>  常用的集合：arrays、lists、sparse lists以及maps，为了简便都可以使用<code>[]</code>来访问。</p>
  <figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">  &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"android.util.SparseArray"</span>/&gt;</div><div class="line">  &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"java.util.Map"</span>/&gt;</div><div class="line">  &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"java.util.List"</span>/&gt;</div><div class="line">  &lt;variable name=<span class="string">"list"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"List&lt;String&gt;"</span>/&gt;</div><div class="line">  &lt;variable name=<span class="string">"sparse"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"SparseArray&lt;String&gt;"</span>/&gt;</div><div class="line">  &lt;variable name=<span class="string">"map"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"Map&lt;String, String&gt;"</span>/&gt;</div><div class="line">  &lt;variable name=<span class="string">"index"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"int"</span>/&gt;</div><div class="line">  &lt;variable name=<span class="string">"key"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"String"</span>/&gt;</div><div class="line">&lt;/data&gt;</div><div class="line">…</div><div class="line">android:text=<span class="string">"@&#123;list[index]&#125;"</span></div><div class="line">…</div><div class="line">android:text=<span class="string">"@&#123;sparse[index]&#125;"</span></div><div class="line">…</div><div class="line">android:text=<span class="string">"@&#123;map[key]&#125;"</span></div></pre></td></tr></table></figure>
</li>
<li><p>字符串<br>  当使用单引号包含属性值时，在表达式中使用双引号很容易：</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:text='@&#123;<span class="built_in">map</span>[<span class="string">"firstName"</span>]&#125;'</div></pre></td></tr></table></figure>
<p>  使用双引号来包含属性值也是可以的。字符串前后需要使用”`”：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;<span class="keyword">map</span>[<span class="string">`firstName`</span>]&#125;</span>"</span></div><div class="line">android:text=<span class="string">"<span class="subst">@&#123;<span class="keyword">map</span>[<span class="string">"firstName"</span>]&#125;</span>"</span></div></pre></td></tr></table></figure>
</li>
<li><p>Resources<br>  使用正常的表达式来访问resources也是可行的：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:padding=<span class="string">"<span class="subst">@&#123;large? @dimen/largePadding : @dimen/smallPadding&#125;</span>"</span></div></pre></td></tr></table></figure>
<p>  格式化字符串和复数可以通过提供参数来判断</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">android:text=<span class="string">"<span class="subst">@&#123;@string/nameFormat(firstName, lastName)&#125;</span>"</span></div><div class="line">android:text=<span class="string">"<span class="subst">@&#123;@plurals/banana(bananaCount)&#125;</span>"</span></div></pre></td></tr></table></figure>
<p>  当复数需要多个参数时，所有的参数都会通过：</p>
  <figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Have an orange</div><div class="line">Have %d oranges</div><div class="line">android:text=<span class="string">"<span class="subst">@&#123;@plurals/orange(orangeCount, orangeCount)&#125;</span>"</span></div></pre></td></tr></table></figure>
<p>  一些资源需要显式类型判断：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>正常引用</th>
<th>表达式引用</th>
</tr>
</thead>
<tbody>
<tr>
<td>String[]</td>
<td>@array</td>
<td>@stringArray</td>
</tr>
<tr>
<td>int[]</td>
<td>@array</td>
<td>@intArray</td>
</tr>
<tr>
<td>TypedArray</td>
<td>@array</td>
<td>@typedArray</td>
</tr>
<tr>
<td>Animator</td>
<td>@animator</td>
<td>@animator</td>
</tr>
<tr>
<td>StateListAnimator</td>
<td>@animator</td>
<td>@stateListAnimator</td>
</tr>
<tr>
<td>color int</td>
<td>@color</td>
<td>@color</td>
</tr>
<tr>
<td>ColorStateList</td>
<td>@color</td>
<td>@colorStateList</td>
</tr>
</tbody>
</table>
<h2 id="Data-对象"><a href="#Data-对象" class="headerlink" title="Data 对象"></a>Data 对象</h2><p>任何Plain old Java object（PO​​JO）可用于Data Binding，但修改POJO不会导致UI更新。Data Binding的真正能力是当数据变化时，可以通知给你的Data对象。有三种不同的数据变化通知机制：<code>Observable</code>对象、<code>ObservableFields</code>以及<code>observable  collections</code>。</p>
<p>当这些可观察Data对象​​绑定到UI，Data对象属性的更改后，UI也将自动更新。</p>
<h5 id="Observable-对象"><a href="#Observable-对象" class="headerlink" title="Observable 对象"></a>Observable 对象</h5><p>实现<code>android.databinding.Observable</code>接口的类可以允许附加一个监听器到Bound对象以便监听对象上的所有属性的变化。</p>
<p><code>Observable</code>接口有一个机制来添加和删除监听器，但通知与否由开发人员管理。为了使开发更容易，一个<code>BaseObservable</code>的基类为实现监听器注册机制而创建。Data实现类依然负责通知当属性改变时。这是通过指定一个<code>Bindable</code>注解给getter以及setter内通知来完成的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseObservable</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> String firstName;</div><div class="line">   <span class="keyword">private</span> String lastName;</div><div class="line">   <span class="meta">@Bindable</span></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.firstName;</div><div class="line">   &#125;</div><div class="line">   <span class="meta">@Bindable</span></div><div class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.lastName;</div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.firstName = firstName;</div><div class="line">       notifyPropertyChanged(BR.firstName);</div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.lastName = lastName;</div><div class="line">       notifyPropertyChanged(BR.lastName);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在编译期间，<code>Bindable</code>注解在BR类文件中生成一个Entry。BR类文件会在模块包内生成。如果用于Data类的基类不能改变，<code>Observable</code>接口通过方便的<code>PropertyChangeRegistry</code>来实现用于储存和有效地通知监听器。</p>
<h5 id="Observable-字段"><a href="#Observable-字段" class="headerlink" title="Observable 字段"></a>Observable 字段</h5><p>一些小工作会涉及到创建Observable类，因此那些想要节省时间或者几乎没有几个属性的开发者可以使用<code>ObservableFields</code>。<code>ObservableFields</code>是自包含具有单个字段的observable对象。它有所有基本类型和一个是引用类型。要使用它需要在data对象中创建public final字段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; firstName =</div><div class="line">       <span class="keyword">new</span> ObservableField&lt;&gt;();</div><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> ObservableField&lt;String&gt; lastName =</div><div class="line">       <span class="keyword">new</span> ObservableField&lt;&gt;();</div><div class="line">   <span class="keyword">public</span> <span class="keyword">final</span> ObservableInt age = <span class="keyword">new</span> ObservableInt();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>就是这样，要访问该值，使用set和get方法：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user.firstName.<span class="keyword">set</span>(<span class="string">"Google"</span>);</div><div class="line"><span class="keyword">int</span> age = user.age.<span class="keyword">get</span>();</div></pre></td></tr></table></figure>
<h5 id="Observable-集合"><a href="#Observable-集合" class="headerlink" title="Observable 集合"></a>Observable 集合</h5><p>一些app使用更多的动态结构来保存数据。Observable集合允许键控访问这些data对象。<code>ObservableArrayMap</code>用于键是引用类型,如<code>String</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObservableArrayMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; user = <span class="keyword">new</span> ObservableArrayMap&lt;&gt;();</div><div class="line">user.put(<span class="string">"firstName"</span>, <span class="string">"Google"</span>);</div><div class="line">user.put(<span class="string">"lastName"</span>, <span class="string">"Inc."</span>);</div><div class="line">user.put(<span class="string">"age"</span>, <span class="number">17</span>);</div></pre></td></tr></table></figure>
<p>在layout文件中，通过String键可以访问map：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.databinding.ObservableMap"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"ObservableMap&lt;String, Object&gt;"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line">…</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">'@&#123;user["lastName"]&#125;'</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">'@&#123;String.valueOf(1 + (Integer)user["age"])&#125;'</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<p><code>ObservableArrayList</code>用于键是整数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObservableArrayList&lt;Object&gt; user = <span class="keyword">new</span> ObservableArrayList&lt;&gt;();</div><div class="line">user.add(<span class="string">"Google"</span>);</div><div class="line">user.add(<span class="string">"Inc."</span>);</div><div class="line">user.add(<span class="number">17</span>);</div></pre></td></tr></table></figure>
<p>在layout文件中，通过索引可以访问list：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"android.databinding.ObservableList"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.example.my.app.Fields"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"ObservableList&lt;Object&gt;"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line">…</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">'@&#123;user[Fields.LAST_NAME]&#125;'</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">'@&#123;String.valueOf(1 + (Integer)user[Fields.AGE])&#125;'</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<h2 id="Binding生成"><a href="#Binding生成" class="headerlink" title="Binding生成"></a>Binding生成</h2><p>Binding类的生成链接了layout中variables与Views。如前面所讨论的，Binding的名称和包名可以定制。所生成的Binding类都扩展了<code>android.databinding.ViewDataBinding</code>。</p>
<h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><p>Binding应在inflation之后就立马创建，以确保View层次结构不在之前打扰layout中的binding到views上的表达式。有几个方法可以绑定到一个layout。最常见的是在Binding类上使用静态方法.<code>inflate</code>方法载入View的层次结构并且绑定到它只需这一步。还有一个更简单的版本，只需要<code>LayoutInflater</code>还有一个是采用<code>ViewGroup</code>：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MyLayoutBinding binding = MyLayoutBinding.inflate(layoutInflater);</div><div class="line">MyLayoutBinding binding = MyLayoutBinding.inflate(LayoutInflater, viewGroup, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>如果使用不同的机制载入layout，他可一分开绑定：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MyLayoutBinding binding = MyLayoutBinding.bind(viewRoot);</div></pre></td></tr></table></figure>
<p>有时Binding不能提前知道，对于这种情况，可以使用<code>DataBindingUtil</code>类来创建Binding：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ViewDataBinding binding = DataBindingUtil.inflate(LayoutInflater, layoutId,</div><div class="line">    <span class="keyword">parent</span>, attachToParent);</div><div class="line">ViewDataBinding binding = DataBindingUtil.bindTo(viewRoot, layoutId);</div></pre></td></tr></table></figure>
<h5 id="带ID的Views"><a href="#带ID的Views" class="headerlink" title="带ID的Views"></a>带ID的Views</h5><p>在layout中对于每个带ID的View会生成一个public final字段。Binding在View层次结构上做单一的传递，提取带ID的Views。这种机制比起某些Views使用<code>findViewById</code>还要快。例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"com.example.User"</span>/&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">       <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName&#125;"</span></div><div class="line">   <span class="attr">android:id</span>=<span class="string">"@+id/firstName"</span>/&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line">           <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">           <span class="attr">android:text</span>=<span class="string">"@&#123;user.lastName&#125;"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/lastName"</span>/&gt;</div><div class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>它会生成如下的Binding类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> TextView firstName;</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> TextView lastName;</div></pre></td></tr></table></figure>
<p>IDs不像没有Data Bindings那样几乎没有必要，但是仍然会有一些实例需要从代码中访问Views。</p>
<h5 id="Variables-1"><a href="#Variables-1" class="headerlink" title="Variables"></a>Variables</h5><p>每个Variable会有访问方法。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;data&gt;</div><div class="line">    &lt;<span class="keyword">import</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"android.graphics.drawable.Drawable"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"user"</span>  <span class="class"><span class="keyword">type</span></span>=<span class="string">"com.example.User"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"image"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"Drawable"</span>/&gt;</div><div class="line">    &lt;variable name=<span class="string">"note"</span>  <span class="class"><span class="keyword">type</span></span>=<span class="string">"String"</span>/&gt;</div><div class="line">&lt;/data&gt;</div></pre></td></tr></table></figure>
<p>它会在Binding中生成setters和getters：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> com.example.<span class="function">User <span class="title">getUser</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setUser</span>(<span class="params">com.example.User user</span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Drawable <span class="title">getImage</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setImage</span>(<span class="params">Drawable image</span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getNote</span>(<span class="params"></span>)</span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setNote</span>(<span class="params">String note</span>)</span>;</div></pre></td></tr></table></figure>
<h5 id="ViewStubs"><a href="#ViewStubs" class="headerlink" title="ViewStubs"></a>ViewStubs</h5><p>ViewStubs跟正常的Views略有不同。他们开始时是不可见的，当他们要么设置为可见或被明确告知要载入时，它们通过载入另外一个layout取代了自己。</p>
<p>由于ViewStub基本上从View的层次结构上消失，在Binding对象的View也必须消失来允许被收集。因为Views是最后的，一个<code>ViewStubProxy</code>对象取带ViewStub，给开发者获得了ViewStub，当它存在以及还可以访问载入的View层次结构时当ViewStub已被载入时。</p>
<p>当载入另一个layout，为新的布局必需创建一个Binding。因此，<code>ViewStubProxy</code>必需监听<code>ViewStub</code>的<code>OnInflateListener</code>监听器并在那个时候建立Binding。因为只有一个可以存在，<code>ViewStubProxy</code>允许开发者在其上设置一个<code>OnInflateListener</code>它会在建立Binding后调用。</p>
<h5 id="Binding进阶"><a href="#Binding进阶" class="headerlink" title="Binding进阶"></a>Binding进阶</h5><ul>
<li>动态Variables</li>
</ul>
<p>有时，不知道具体的Binding类，例如，一个<code>RecyclerView</code>适配器对layouts任意操作并不知道具体的Binding类。它仍然必需在<code>onBindViewHolder</code>期间赋值给Binding。</p>
<p>在这个例子中，该<code>RecyclerView</code>绑定的所有layouts有一个“item”的Variable。该<code>BindingHolder</code>有一个<code>getBinding</code>方法返回<code>ViewDataBinding</code>。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span>(<span class="params">BindingHolder holder, <span class="keyword">int</span> position</span>) </span>&#123;</div><div class="line">   final T item = mItems.<span class="keyword">get</span>(position);</div><div class="line">   holder.getBinding().setVariable(BR.item, item);</div><div class="line">   holder.getBinding().executePendingBindings();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>直接Binding</li>
</ul>
<p>当一个variable或observable变化时，binding会在下一帧之前被计划要改变。有很多次，但是在Binding时必须立即执行。要强制执行，使用<code>executePendingBindings()</code>方法。</p>
<ul>
<li>后台线程</li>
</ul>
<p>只要它不是一个集合，你可以在后台线程中改变你的数据模型。在判断是否要避免任何并发问题时，Data Binding会对每个Varialbe/field本地化。</p>
<h2 id="属性Setters"><a href="#属性Setters" class="headerlink" title="属性Setters"></a>属性Setters</h2><p>每当绑定值的变化，生成的Binding类必须调用setter方法​​。Data Binding框架有可以自定义赋值的方法。</p>
<h5 id="自动Setters"><a href="#自动Setters" class="headerlink" title="自动Setters"></a>自动Setters</h5><p>对于一个属性，Data Binding试图找到<code>setAttribute</code>方法。与该属性的namespace并不什么关系，仅仅与属性本身名称有关。</p>
<p>例如，有关TextView的<code>android:text</code>属性的表达式会寻找一个<code>setText(String)</code>的方法。如果表达式返回一个<code>int</code>，Data Binding会搜索的<code>setText(int)</code>方法。注意：要表达式返回正确的类型，如果需要的话使用<code>casting</code>。Data Binding仍会工作即使没有给定名称的属性存在。然后，您可以通过Data Binding轻松地为任何setter“创造”属性。例如，<code>DrawerLayout</code>没有任何属性，但大量的setters。您可以使用自动setters来使用其中的一个。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;android.support.v4.widget.DrawerLayout</div><div class="line">    android:layout_width="wrap_content"</div><div class="line">    android:layout_height="wrap_content"</div><div class="line">    app:scrimColor="@&#123;@color/scrim&#125;"</div><div class="line">    app:drawerListener="@&#123;fragment.drawerListener&#125;"/&gt;</div></pre></td></tr></table></figure>
<h5 id="重命名的Setters"><a href="#重命名的Setters" class="headerlink" title="重命名的Setters"></a>重命名的Setters</h5><p>一些有setters的属性按名称并不匹配。对于这些方法，属性可以通过<code>BindingMethods</code>注解相关联。这必须与一个包含<code>BindingMethod</code>注解的类相关联，每一个用于一个重命名的方法。例如，<code>android:tint</code>属性与<code>setImageTintList</code>相关联，而不与<code>setTint</code>相关。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingMethods</span>(&#123;</div><div class="line">       <span class="meta">@BindingMethod</span>(<span class="class"><span class="keyword">type</span> </span>= <span class="string">"android.widget.ImageView"</span>,</div><div class="line">                      attribute = <span class="string">"android:tint"</span>,</div><div class="line">                      method = <span class="string">"setImageTintList"</span>),</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>以上例子，开发者需要重命名setters是不太可能了，android架构属性已经实现了。</p>
<h5 id="自定义Setters"><a href="#自定义Setters" class="headerlink" title="自定义Setters"></a>自定义Setters</h5><p>有些属性需要自定义绑定逻辑。例如，对于<code>android:paddingLeft</code>属性并没有相关setter。相反，<code>setPadding(left, top, right, bottom)</code>是存在在。一个带有<code>BindingAdapter</code>注解的静态绑定适配器方法允许开发者自定义setter如何对于一个属性的调用。</p>
<p>Android的属性已经创造了<code>BindingAdapters</code>。举例来说，对于<code>paddingLeft</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"android:paddingLeft"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setPaddingLeft</span><span class="params">(View view, <span class="keyword">int</span> padding)</span> </span>&#123;</div><div class="line">   view.setPadding(padding,</div><div class="line">                   view.getPaddingTop(),</div><div class="line">                   view.getPaddingRight(),</div><div class="line">                   view.getPaddingBottom());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Binding适配器对其他定制类型非常有用。例如，自定义loader可以用来异步载入图像。</p>
<p>当有冲突时，开发人员创建的Binding适配器将覆盖Data Binding默认适配器。</p>
<p>您也可以创建可以接收多个参数的适配器。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@BindingAdapter(&#123;"bind:imageUrl", "bind:error"&#125;)</div><div class="line">public static void loadImage(ImageView view, String url, Drawable error) &#123;</div><div class="line">   Picasso.with(view.getContext()).load(url).error(error).into(view);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">app:imageUrl</span>=<span class="string">“@&#123;venue.imageUrl&#125;”</span></span></div><div class="line"><span class="attr">app:error</span>=<span class="string">“@&#123;@drawable/venueError&#125;”/</span>&gt;</div></pre></td></tr></table></figure>
<p>如果对于一个<code>ImageView</code><strong>imageUrl</strong>和<strong>error</strong>都被使用并且<code>imageUrl</code>是一个string类型以及<strong>error</strong>是一个drawable时，该适配器会被调用。</p>
<ul>
<li>匹配的过程中自定义namespaces将被忽略。</li>
<li>你也可以为Android namespaces写适配器。</li>
</ul>
<h2 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h2><h5 id="对象转换"><a href="#对象转换" class="headerlink" title="对象转换"></a>对象转换</h5><p>当从Binding表达式返回一个对象，一个setter会从自动、重命名以及自定义的setters中选择。该对象将被转换为所选择的setter的参数类型。</p>
<p>这是为了方便那些使用<code>ObservableMaps</code>来保存数据。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">   <span class="attr">android:text</span>=<span class="string">'@&#123;userMap["lastName"]&#125;'</span></div><div class="line">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<p>在<code>userMap</code>返回一个对象并且该对象将自动转换为<code>setText(CharSequence)</code>的参数类型。当有关参数类型可能混乱时，开发人员需要在表达式中转换。</p>
<h5 id="自定义转换"><a href="#自定义转换" class="headerlink" title="自定义转换"></a>自定义转换</h5><p>有时候转换应该是自动的在特定类型之间。例如，设置背景的时候：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;View</div><div class="line">   android:background=<span class="string">"<span class="subst">@&#123;isError ? @color/red : @color/white&#125;</span>"</span></div><div class="line">   android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">   android:layout_height=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<p>这里，背景需要<code>Drawable</code>对象，但颜色是一个整数。不管何时有<code>Drawable</code>并且返回值是一个整数，那么整数类型会被转换为<code>ColorDrawable</code>。这个转换是通过使用带有<code>BindingConversion</code>注解的静态方法完成的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingConversion</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ColorDrawable <span class="title">convertColorToDrawable</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> ColorDrawable(color);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注意：</strong>转换仅仅发生在setter级别，因此它是不允许以下混合类型：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;View</div><div class="line">   android:background=<span class="string">"<span class="subst">@&#123;isError ? @drawable/error : @color/white&#125;</span>"</span></div><div class="line">   android:layout_width=<span class="string">"wrap_content"</span></div><div class="line">   android:layout_height=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<h3 id="Android-Studio支持"><a href="#Android-Studio支持" class="headerlink" title="Android Studio支持"></a>Android Studio支持</h3><p>Android Studio为数据绑定支持许多的代码编辑。例如，它支持以下功能：</p>
<ul>
<li>语法高亮</li>
<li>标记表达式的语法错误</li>
<li>XML代码补全</li>
<li>引用，包括<a href="https://www.jetbrains.com/help/idea/2016.1/navigation-in-source-code.html?origin=old_help" target="_blank" rel="external">navigation</a>(如导航到声明处)以及<a href="https://www.jetbrains.com/help/idea/2016.1/viewing-inline-documentation.html?origin=old_help" target="_blank" rel="external">快速文档查询</a></li>
</ul>
<blockquote>
<p><strong>注意</strong>： 数组以及<a href="https://docs.oracle.com/javase/tutorial/java/generics/types.html" target="_blank" rel="external">通用类型</a>，比如说<a href="https://developer.android.com/reference/android/databinding/Observable.html" target="_blank" rel="external">Observable</a>类，可能会显示错误事实上并没有错误。</p>
</blockquote>
<p>预览面板会显示数据绑定的默认值。在以下例子中，面板会在<code>TextView</code>中显示<code>PLACEHOLDER</code>默认值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>   <span class="attr">android:text</span>=<span class="string">"@&#123;user.firstName, default=PLACEHOLDER&#125;"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>如果你需要在设计阶段就显示默认值，你可以使用工具属性来代替默认表达数值，参考：<a href="http://tools.android.com/tips/layout-designtime-attributes" target="_blank" rel="external">Designtime Layout Attributes</a></p>
<h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><ul>
<li><a href="http://blog.csdn.net/qibin0506/article/details/47393725" target="_blank" rel="external">Android官方数据绑定框架DataBinding(一)</a></li>
<li><a href="http://blog.csdn.net/qibin0506/article/details/47720125" target="_blank" rel="external">Android官方数据绑定框架DataBinding(二)</a></li>
<li><a href="https://github.com/konmik/nucleus" target="_blank" rel="external">konmik/nucleus: Nucleus is a simple Android library, which utilizes the Model-View-Presenter pattern to properly connect background tasks with visual parts of an application.</a></li>
</ul>
<h2 id="Other-MVVM-Architecture"><a href="#Other-MVVM-Architecture" class="headerlink" title="Other MVVM Architecture"></a>Other MVVM Architecture</h2><ul>
<li><a href="https://github.com/konmik/nucleus" target="_blank" rel="external">konmik/nucleus: Nucleus is a simple Android library, which utilizes the Model-View-Presenter pattern to properly connect background tasks with visual parts of an application.</a></li>
<li><a href="https://github.com/square/mortar" target="_blank" rel="external">mortar</a></li>
</ul>
<h2 id="Best-Practice"><a href="#Best-Practice" class="headerlink" title="Best Practice"></a>Best Practice</h2><ul>
<li><a href="http://blog.zhaiyifan.cn/2016/07/06/android-new-project-from-0-p8/" target="_blank" rel="external">从零开始的Android新项目8 - Data Binding高级篇</a></li>
<li><a href="http://blog.zhaiyifan.cn/2016/07/21/data-binding-component/" target="_blank" rel="external">Data Binding Component详解 - 换肤什么的只是它的一个小应用！</a></li>
<li><a href="http://blog.zhaiyifan.cn/2016/06/16/android-new-project-from-0-p7/" target="_blank" rel="external">从零开始的Android新项目7 - Data Binding入门篇</a></li>
</ul>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ul>
<li><a href="https://medium.com/google-developers/android-data-binding-that-include-thing-1c8791dd6038#.965zwocww" target="_blank" rel="external">Android Data Binding: That <include> Thing – Google Developers – Medium</include></a></li>
</ul>
<h2 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h2><ul>
<li><a href="https://github.com/Ilhasoft/data-binding-validator" target="_blank" rel="external">Ilhasoft/data-binding-validator: Android fields validation library based on data binding adapters.</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/Android/2016-09-07-android-data-binding.html" target="_blank" rel="external">http://blog.inching.org/Android/2016-09-07-android-data-binding.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&title=《Android Data Binding》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&title=《Android Data Binding》 — Balance&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/Android/2016-09-07-android-data-binding.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android Data Binding》 — Balance&url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/Android/2016-09-08-android-architecture-the-clean-architecture.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">The Clean Architecture</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Android/2016-09-06-android-asyn-task.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Android AysncTask</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&title=《Android Data Binding》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&title=《Android Data Binding》 — Balance&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/Android/2016-09-07-android-data-binding.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android Data Binding》 — Balance&url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/Android/2016-09-07-android-data-binding.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACoUlEQVR42u3a207DQAwFwP7/T8MrUiE9vmxapNmnipJkJ0hrY/vxiNfXj/X88+Sq5/V8h+fPf327vPDw8PAGW7/eRHUryRaTp18/8foqPDw8vHO8v07U6895eEgCTO/lvtgJHh4e3sfw8uM+uWeeD+Ph4eH9X97phDgvW+Dh4eG9izcptlbDSR5Ibq214OHh4cW8vIv0OZ+P9Pfw8PDwxl313WS3FzwmCw8PD+8Er1dOrf5mnqyfeDoeHh7e7tPzRn417c5DSG+QK2qz4eHh4d3CS9pXCek0OwoqeHh4eMd4+U96hYnrAJMXPvI74OHh4Z3j5Qd38m21QZUf8aNn4eHh4a3ykqGlvCzba6HlpZDqTvDw8PDu5PVKD5MhgwRcDhV4eHh4h3nVtn0vhGwNGUR/Ejw8PLzDvOogVA/Qe4lJQPpl53h4eHgHePkFvQf3jvtJEeRFeo2Hh4e3xMsx1eZWcuetUFQICXh4eHhLvDx5TcoNveO++iJGJQk8PDy8AW/OqG5uq0iRBzY8PDy8LV616FAdKagm0PNBBDw8PLx7ePkAQdJwqoaEPLTkOyxHITw8PLyYlx+482CQl2t7RWQ8PDy8O3mjYzceDsgDw6QYEU1G4OHh4S3xemME1cf0XlO1tYaHh4d3mpePMW0d7oWW/ySNxsPDwzvMqwaGZIvV5tnu4BceHh7eu3jVplReAu5d+5hEDzw8PLwx76u4koO4Fzby0kYhfcfDw8M7wNs9Y6uhYrdkPAoneHh4eEXeVttpktP2RhCidBwPDw/vGC8vUuQp76S5tbbw8PDwPobXKxDk+ElqjoeHh/dpvOS430rNk4T7ReDBw8PDO8brlQmqh3U1hPRKzHh4eHineb3/6Oet/a2U/UjBAg8PD+/39Q2F/eQpe07GDwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
