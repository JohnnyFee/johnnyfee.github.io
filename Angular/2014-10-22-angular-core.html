<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>Angular Core | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,angular">
    <meta name="description" content="This post is meant for beginners, for those that just started to learn Angular and want to know how data-binding works. If you already know how to use Angular properly, I highly suggest you go to the">
<meta property="og:type" content="article">
<meta property="og:title" content="Angular Core">
<meta property="og:url" content="http://blog.inching.org/Angular/2014-10-22-angular-core.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="This post is meant for beginners, for those that just started to learn Angular and want to know how data-binding works. If you already know how to use Angular properly, I highly suggest you go to the">
<meta property="og:updated_time" content="2017-04-21T12:57:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Angular Core">
<meta name="twitter:description" content="This post is meant for beginners, for those that just started to learn Angular and want to know how data-binding works. If you already know how to use Angular properly, I highly suggest you go to the">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.17">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Angular Core</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Angular Core</h1>
        <h5 class="subtitle">
            
                <time datetime="2014-10-21T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2014-10-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Angular/">Angular</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#The-browser-events-loop-and-the-Angular-js-extension"><span class="post-toc-text">The browser events-loop and the Angular.js extension</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#The-watch-list"><span class="post-toc-text">The $watch list</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#digest-loop"><span class="post-toc-text">$digest loop</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#apply-and-digest"><span class="post-toc-text">$apply() and $digest()</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#apply-and-digest-Explored"><span class="post-toc-text">$apply and $digest Explored</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#什么时候手动调用-apply-？"><span class="post-toc-text">什么时候手动调用  $apply()？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#digest-循环运行多少次"><span class="post-toc-text">$digest 循环运行多少次</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Difference-between-the-observe-and-watch-methods"><span class="post-toc-text">Difference between the $observe and $watch methods</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Reference"><span class="post-toc-text">Reference</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tutorial"><span class="post-toc-text">Tutorial</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-angular-core"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Angular Core</h1>
        <div class="post-meta">
            <time class="post-time" title="2014-10-22 00:00:00" datetime="2014-10-21T16:00:00.000Z"  itemprop="datePublished">2014-10-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Angular/">Angular</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>This post is meant for beginners, for those that just started to learn Angular and want to know how data-binding works. If you already know how to use Angular properly, I highly suggest you go to the source code instead.</p>
<h2 id="The-browser-events-loop-and-the-Angular-js-extension"><a href="#The-browser-events-loop-and-the-Angular-js-extension" class="headerlink" title="The browser events-loop and the Angular.js extension"></a>The browser events-loop and the Angular.js extension</h2><p>Our browser is waiting for events, for example the user interactions. If you click on a button or write into an input, the event’s callback will run inside Javascript and there you can do any DOM manipulation, so when the callback is done, the browser will make the appropiate changes in the DOM.</p>
<p>Angular extends this events-loop creating something called <code>angular context</code> (remember this, it is an important concept). To explain what this context is and how it works we will need to explain more concepts.</p>
<a id="more"></a>
<h2 id="The-watch-list"><a href="#The-watch-list" class="headerlink" title="The $watch list"></a>The $watch list</h2><p>Every time you bind something in the UI you insert a <code>$watch</code> in a <code>$watch list</code>. Imagine the <code>$watch</code> as something that is able to detect changes in the model it is watching (bear with me, this will be clear soon). Imagine you have this:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">User: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"user"</span> /&gt;</span></div><div class="line">Password: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">ng-model</span>=<span class="string">"pass"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>Here we have <code>$scope.user</code>, which is bound to the first input, and we have <code>$scope.pass</code>, which is bound to the second one. Doing this we add two <code>$watch</code> to the <code>$watch list</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'MainCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</div><div class="line">  $scope.foo = <span class="string">"Foo"</span>;</div><div class="line">  $scope.world = <span class="string">"World"</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello, &#123;&#123; World &#125;&#125;</div></pre></td></tr></table></figure>
<p>Here, even though we have two things attached to the <code>$scope</code>, only one is bound. So in this case we only created one <code>$watch</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'MainCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</div><div class="line">  $scope.people = [...];</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"person in people"</span>&gt;</span></div><div class="line">      &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.age&#125;&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure>
<p>How many <code>$watch</code> are created here? Two for each person (for name and age) in people plus one for the <code>ng-repeat</code>. If we have 10 people in the list it will be <code>(2 * 10) + 1</code>, AKA <code>21</code> <code>$watch</code>.</p>
<p>So, everything that is bound in our UI using directives creates a <code>$watch</code>. Right, but when are those <code>$watch</code> created?</p>
<p>When our template is loaded, AKA in the <code>linking phase</code>, the compiler will look for every directive and creates all the <code>$watch</code> that are needed. This sounds good, but… now what?</p>
<h2 id="digest-loop"><a href="#digest-loop" class="headerlink" title="$digest loop"></a>$digest loop</h2><p>Remember the extended <code>event-loop</code> I talked about? When the browser receives an event that can be managed by the <code>angular context</code> the <code>$digest</code> loop will be fired. This loop is made from two smaller loops. One processes the <code>$evalAsync</code> queue and the other one processes the <code>$watch</code> list, which is the subject of this article.</p>
<p>What is that process about? The <code>$digest</code> will loop through the list of <code>$watch</code> that we have, asking this:</p>
<ol>
<li><p>Hey <code>$watch</code>, what is your value?</p>
<ul>
<li>It is <code>9</code></li>
</ul>
</li>
<li><p>Alright, has it changed?</p>
<ul>
<li>No, sir.</li>
</ul>
</li>
<li><p>(nothing happens with this one, so it moves to the next)</p>
</li>
<li><p>You, what is your value?</p>
<ul>
<li>It is <code>Foo</code>.</li>
</ul>
</li>
<li><p>Has it changed?</p>
<ul>
<li>Yes, it was <code>Bar</code>.</li>
</ul>
</li>
<li><p>(good, we have a DOM to be updated)</p>
</li>
<li>This continues until every <code>$watch</code> has been checked.</li>
</ol>
<p>This is the <code>dirty-checking</code>. Now that all the <code>$watch</code> have been checked there is something else to ask: Is there any <code>$watch</code> that has been updated? If there is at least one of them that has changed, the loop will fire again until all of the <code>$watch</code> report no changes. This is to ensure that every model is clean. Have in mind that if the loop runs more than 10 times, it will throw an exception to prevent infinite loops.</p>
<p>When the <code>$digest loop</code> finishes, the DOM makes the changes.</p>
<p>Example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'MainCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  $scope.name = <span class="string">"Foo"</span>;</div><div class="line"></div><div class="line">  $scope.changeFoo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      $scope.name = <span class="string">"Bar"</span>;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; name &#125;&#125;</div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"changeFoo()"</span>&gt;</span>Change the name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Here we have only one <code>$watch</code> because ng-click doesn’t create any watches (the function is not going to change :P).</p>
<ul>
<li>We press the button.</li>
<li>The browser receives an event which will enter the <code>angular context</code> (I will explain why, later in this article).</li>
<li>The <code>$digest loop</code> will run and will ask every <code>$watch</code> for changes.</li>
<li>Since the <code>$watch</code> which was watching for changes in <code>$scope.name</code> reports a change, if will force another $digest loop.</li>
<li>The new loop reports nothing.</li>
<li>The browser gets the control back and it will update the DOM reflecting the new value of <code>$scope.name</code></li>
</ul>
<p>The important thing here (which is seen as a pain-point by many people) is that EVERY event that enters the <code>angular context</code> will run a <code>$digest loop</code>. That means that every time we write a letter in an input, the loop will run checking every <code>$watch</code> in this page.</p>
<h2 id="apply-and-digest"><a href="#apply-and-digest" class="headerlink" title="$apply() and $digest()"></a>$apply() and $digest()</h2><p><code>$apply()</code> and <code>$digest()</code> 是 AngularJS 的两个核心但不大好理解的两个概念。为了理解 AngularJS 的原理，你必须完全理解 <code>$apply()</code> and <code>$digest()</code> 的工作原理。</p>
<h3 id="apply-and-digest-Explored"><a href="#apply-and-digest-Explored" class="headerlink" title="$apply and $digest Explored"></a><code>$apply</code> and <code>$digest</code> Explored</h3><p>AngularJS 提供了一个极好的双向绑定功能，这意味着，当视图发生改变，<code>scope</code> 模型中会自动更新。同样的，<code>scope</code> 模型一旦发生变化，视图也会使用新的值更新。Angular 是如何实现的呢？当你编写了表达式 (<code></code>)，Angular 悄悄地为 <code>scope</code> 建立了一个监视器，一旦模型发生变化，视图将轮流被更新。这个 <code>watcher</code> 和你在 AngularJS 中建立的 watcher 并无区别：</p>
<pre><code>$scope.$watch(&apos;aModel&apos;, function(newValue, oldValue) {
  //update the DOM with newValue
});
</code></pre><p>第二个参数一个监听函数，一旦 <code>aModel</code> 的值发生变化，这个函数便被调用，HTML 中的表达式也会被更新。但是，还有一个问题，Angular 如何断定合适调用这个监听函数呢？这涉及到 <code>$digest</code> 循环。</p>
<p><code>$digest</code> 循环是监视器被触发的地方。当一个监视器被触发，AngularJS 计算 <code>scope</code> 模型，如果模型被改变，那么相应的监听函数会被调用。所以，我们下一个问题是 <code>$digest</code> 循环是何时并且如何开始的。</p>
<p><code>$digest</code> 循环是调用 <code>$scope.$digest()</code> 的结果。假如你在 <code>ng-click</code> 指令的处理函数中改变了 <code>scope</code> 模型，AngularJS 会调用 <code>$digest()</code> 自动触发 <code>$digest</code> 循环。当 <code>$digest</code> 循环开始，它会触发每一个监视器。监视器比较 <code>scope</code> 模型的当前的值和上一次计算的值，如果不等，相应的监听函数被执行，视图中的表达式也会被更新。除了 <code>ng-click</code>，还有其他一些内置指令/服务(e.g. <code>ng-model</code>, <code>$timeout</code>, etc)，让你改变模型，并且触发 <code>$digest</code> 循环。</p>
<p>还有一点要明白，在上面的例子中，AngularJS 没有直接调用 <code>$digest()</code>， 而是调用 <code>$scope.$apply()</code>，<code>$scope.$apply()</code> 会调用 <code>$rootScope.$digest()</code>。这样，<code>$rootScope</code> 启动一个 digest 循环，随后，所有子作用域模型的修改都会触发相应的监听器。</p>
<p>现在，假设你将 <code>ng-click</code> 应用到一个按钮，让后传入一个函数。当按钮被点击，AngularJS 将函数封装到 <code>$scope.$apply()</code> 中调用。所以，你的函数照常执行，一旦改变模型，<code>$digest</code> 循环变回启动以保证你的修改被应用到视图。</p>
<p><strong>注意：</strong> <code>$scope.$apply()</code> 会自动调用 <code>$rootScope.$digest()</code>。<code>$apply()</code> 函数有两种风格。一种是携带一个函数作为参数，执行它，并且触发 <code>$digest</code> 循环。另一种不带任何参数，当调用的时候，只是启动一个 <code>$digest</code> 循环。我们等等会看到前者更好。</p>
<h3 id="什么时候手动调用-apply-？"><a href="#什么时候手动调用-apply-？" class="headerlink" title="什么时候手动调用  $apply()？"></a>什么时候手动调用  <code>$apply()</code>？</h3><p>Angular 只会负责在运行在 AngularJS 上下文的模型改变，比如 Angular 的内置指令已经具备了这些功能。如果你想在 Angular 上下文外改变模型，你需要告诉 Angular ，你要改变一些模型，需要触发监视器以便改变正确传播。</p>
<p>比如，如果你使用 JavaScript 的 <code>setTimeout()</code> 函数来更新 <code>scope</code> 模型，Angular 没有办法知道你要改变什么，在这种情况下，你有责任手动调用 <code>$apply()</code> 函数，这会触发一个 <code>$digest</code> 循环。同样，如果你在指令中设置了一个 DOM 事件监听器，并且在相应函数中改变了模型，那么你需要手动调用 <code>$apply()</code> 来该保证修改生效。 </p>
<p>看个例子，假如你有一个页面，页面载入后，延时两秒，显示一个消息。你可能会用如下代码来实现：</p>
<p data-height="268" data-theme-id="0" data-slug-hash="fukyn" data-default-tab="result" data-user="Sandeep92" class="codepen">See the Pen <a href="http://codepen.io/Sandeep92/pen/fukyn/" target="_blank" rel="external">fukyn</a> by Sandeep Panda (<a href="http://codepen.io/Sandeep92" target="_blank" rel="external">@Sandeep92</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p>

<p>你会发现，延时函数会在 2 秒后运行，并且更新 <code>scope</code> model <code>message</code>。但是，视图并没有更新。原因是你忘记手动调用 <code>$apply()</code>，修改如下：</p>
<p data-height="268" data-theme-id="0" data-slug-hash="bEmBn" data-default-tab="result" data-user="Sandeep92" class="codepen">See the Pen <a href="http://codepen.io/Sandeep92/pen/bEmBn/" target="_blank" rel="external">bEmBn</a> by Sandeep Panda (<a href="http://codepen.io/Sandeep92" target="_blank" rel="external">@Sandeep92</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p>

<p>If you run this updated example, you can see the view update after two seconds. The only change is that we wrapped our code inside <code>$scope.$apply()</code> which automatically triggers <code>$rootScope.$digest()</code>. As a result the watchers are fired as usual and the view updates.</p>
<p><strong>Note</strong>: 在你想使用 <code>setTimeout()</code> 的地方，你应该首先考虑 <code>$timeout</code> 服务，这样可以不需要调用 <code>$apply()</code>。</p>
<p>你也可以像下面这样，照常修改模型数据，最后调用使用无参的 <code>$apply()</code> 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$scope.getMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $scope.message = <span class="string">'Fetched after two seconds'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'message:'</span> + $scope.message);</div><div class="line">    $scope.$apply(); <span class="comment">//this triggers a $digest</span></div><div class="line">  &#125;, <span class="number">2000</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>上面的代码也可以运行。但是，你总是应该使用带参的版本，因为当你向 <code>$apply()</code> 传入的函数会被封装在 <code>try...catch</code> 块中调用，任何异常都会被传递到 <code>$exceptionHandler</code> 服务。</p>
<h3 id="digest-循环运行多少次"><a href="#digest-循环运行多少次" class="headerlink" title="$digest 循环运行多少次"></a><code>$digest</code> 循环运行多少次</h3><p>当一个 <code>$digest</code> 循环运行时，监听器被执行，查看 <code>scope</code> 模型是否改变，如果改变，对应的监听函数会被调用。这会引出一个很重要的问题。如果在监听函数中改变了 <code>scope</code> 模型呢？AngularJS 如何应对这个改变？</p>
<p>答案是 <code>$digest</code>  循环不仅运行一次。在当前循环的最后，它会重新启动一次来检查模型是否发生了变化。这是基本的脏检查，这用来处理监听函数中对模型可能的修改。所以，<code>$digest</code> 循环保持运行，直到不再有更多的模型修改，或者达到了最大的循环次数 10。 你应该尽可能减少在 listener 函数中对模型的修改。</p>
<p><strong>注意：</strong> 即使监听函数没有改变模型，<code>$digest</code> 至少也会运行两遍，再运行一次是为了确保模型是稳定的，没有其他修改。</p>
<p>最重要的是要记住 Angular 能否发现你的修改，你过不能，你应该手动调用 <code>$apply()</code>。</p>
<h2 id="Difference-between-the-observe-and-watch-methods"><a href="#Difference-between-the-observe-and-watch-methods" class="headerlink" title="Difference between the $observe and $watch methods"></a>Difference between the $observe and $watch methods</h2><p>See <a href="http://stackoverflow.com/questions/14876112/difference-between-the-observe-and-watch-methods" target="_blank" rel="external">javascript - Difference between the $observe and $watch methods - Stack Overflow</a></p>
<p><strong><a href="https://docs.angularjs.org/api/ng.$compile.directive.Attributes#$observe" target="_blank" rel="external">$observe()</a></strong> is a method on the <a href="http://docs.angularjs.org/api/ng.$compile.directive.Attributes" target="_blank" rel="external">Attributes</a> object, and as such, it can only be used to observe/watch the value change of a DOM attribute.  It is only used/called inside directives.  Use $observe when you need to observe/watch a DOM attribute that contains interpolation (i.e., {{}}‘s).<br>E.g., <code>attr1=&quot;Name: &quot;</code>, then in a directive: <code>attrs.$observe(&#39;attr1&#39;, ...)</code>.<br>(If you try <code>scope.$watch(attrs.attr1, ...)</code> it won’t work because of the {{}}s – you’ll get <code>undefined</code>.)  Use $watch for everything else.</p>
<p><strong><a href="http://docs.angularjs.org/api/ng.$rootScope.Scope#$watch" target="_blank" rel="external">$watch()</a></strong> is more complicated.  It can observe/watch an “expression”, where the expression can be either a function or a string.  If the expression is a string, it is <a href="http://docs.angularjs.org/api/ng.$parse" target="_blank" rel="external">$parse</a>‘d (i.e., evaluated as an <a href="http://docs.angularjs.org/guide/expression" target="_blank" rel="external">Angular expression</a>) into a function.  (It is this function that is called every digest cycle.)  The string expression can not contain {{}}‘s.  $watch is a method on the <a href="http://docs.angularjs.org/api/ng.$rootScope.Scope" target="_blank" rel="external">Scope</a> object, so it can be used/called wherever you have access to a scope object, hence in </p>
<ul>
<li>a controller – any controller – one created via ng-view, ng-controller, or a directive controller</li>
<li>a linking function in a directive, since this has access to a scope as well</li>
</ul>
<p>Because strings are evaluated as Angular expressions, $watch is often used when you want to observe/watch a model/scope property.  E.g., <code>attr1=&quot;myModel.some_prop&quot;</code>, then in a controller or link function: <code>scope.$watch(&#39;myModel.some_prop&#39;, ...)</code> or <code>scope.$watch(attrs.attr1, ...)</code> (or <code>scope.$watch(attrs[&#39;attr1&#39;], ...)</code>).<br>(If you try <code>attrs.$observe(&#39;attr1&#39;)</code> you’ll get the string <code>myModel.some_prop</code>, which is probably not what you want.)</p>
<p>As discussed in comments on @PrimosK’s answer, all $observes and $watches are checked every <a href="http://docs.angularjs.org/guide/concepts" target="_blank" rel="external">digest cycle</a>.</p>
<p>Directives with isolate scopes are more complicated.  If the ‘@’ syntax is used, you can $observe <em>or $watch</em> a DOM attribute that contains interpolation (i.e., {{}}‘s).  (The reason it works with $watch is because the ‘@’ syntax does the <a href="http://docs.angularjs.org/api/ng.$interpolate" target="_blank" rel="external">interpolation</a> for us, hence $watch sees a string without {{}}‘s.)  To make it easier to remember which to use when, I suggest using $observe for this case also.</p>
<p>To help test all of this, I wrote a <a href="http://plnkr.co/edit/HBha8sVdeCqhJtQghGxw?p=preview" target="_blank" rel="external">Plunker</a> that defines two directives.  One (<code>d1</code>) does not create a new scope, the other (<code>d2</code>) creates an isolate scope.  Each directive has the same six attributes.  Each attribute is both $observe’d and $watch’ed.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div d1 attr1=&quot;&#123;&#123;prop1&#125;&#125;-test&quot; attr2=&quot;prop2&quot; attr3=&quot;33&quot; attr4=&quot;&apos;a_string&apos;&quot;</div><div class="line">        attr5=&quot;a_string&quot; attr6=&quot;&#123;&#123;1+aNumber&#125;&#125;&quot;&gt;&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>Look at the console log to see the differences between $observe and $watch in the linking function.  Then click the link and see which $observes and $watches are triggered by the property changes made by the click handler.</p>
<p>Notice that when the link function runs, any attributes that contain {{}}‘s are not evaluated yet (so if you try to examine the attributes, you’ll get <code>undefined</code>).  The only way to see the interpolated values is to use $observe (or $watch if using an isolate scope with ‘@’).  Therefore, getting the values of these attributes is an <em>asynchronous</em> operation.  (And this is why we need the $observe and $watch functions.)</p>
<p>Sometimes you don’t need $observe or $watch.  E.g., if your attribute contains a number or a boolean (not a string), just evaluate it once: <code>attr1=&quot;22&quot;</code>, then in, say, your linking function: <code>var count = scope.$eval(attrs.attr1)</code>.  If it is just a constant string – <code>attr1=&quot;my string&quot;</code> – then just use <code>attrs.attr1</code> in your directive (no need for $eval()).</p>
<p>See also <a href="https://groups.google.com/d/msg/angular/TbRQhG-G14I/bYcipV1OYwcJ" target="_blank" rel="external">Vojta’s google group post</a> about $watch expressions.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://www.sitepoint.com/understanding-angulars-apply-digest/" target="_blank" rel="external">Understanding Angular’s $apply() and $digest()</a> </li>
<li><a href="http://angular-tips.com/blog/2013/08/watch-how-the-apply-runs-a-digest/" target="_blank" rel="external">$watch how the $apply runs a $digest - Angular Tips</a></li>
<li><a href="http://jimhoskins.com/2012/12/17/angularjs-and-apply.html" target="_blank" rel="external">AngularJS and scope.$apply — Jim Hoskins</a></li>
</ul>
<h2 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h2><p>-<a href="http://www.smashingmagazine.com/2015/01/22/angularjs-internals-in-depth" target="_blank" rel="external">AngularJS’ Internals In Depth - Smashing Magazine</a></p>
<script async src="//codepen.io/assets/embed/ei.js"></script>
        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-04-21T12:57:17.000Z" itemprop="dateUpdated">2017-04-21 20:57:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/Angular/2014-10-22-angular-core.html" target="_blank" rel="external">http://blog.inching.org/Angular/2014-10-22-angular-core.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angular/">angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&title=《Angular Core》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&title=《Angular Core》 — Balance&source=This post is meant for beginners, for those that just started to learn Angula..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/Angular/2014-10-22-angular-core.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Angular Core》 — Balance&url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/JavaScript/2014-10-23-jquery-defered.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">jQuery Defered</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Angular/2014-10-10-angular-ui-router.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Angular UI Router</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&title=《Angular Core》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&title=《Angular Core》 — Balance&source=This post is meant for beginners, for those that just started to learn Angula..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/Angular/2014-10-22-angular-core.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Angular Core》 — Balance&url=http://blog.inching.org/Angular/2014-10-22-angular-core.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/Angular/2014-10-22-angular-core.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKklEQVR42u3aS47jMAwFwNz/0pltAw2n3xOdASyVV4E/ssoLhhT1esXH+8fx+8zV+d8j5GO+vnFgYGA8lvH+eLSTu7p6NWb+Ua7uwcDAOIeRTOLzK/PAmoTdfG4YGBgYk9/51eS9GBgYGO1wbUK5VsRiYGBgtBOaBNm1dPMrtTgGBsYDGfmq+////ZX+BgYGxqMY7/JInk3SuCRMF7PCwMDYmpEHuDY5yye3FnAxMDDOYUyal0nxedeGjD9gGBgYWzPaZa88HLd3rn2ay/8NDAyM7Rjtdq61jV+TdbNiTAwMjO0Y7TaI9sWTbWH5Mh8GBsYJjHu7gZOWZP5Zi/8KDAyMhzMmw7VLY/NWZZKkYmBg7MdoB11bvs+L0jZVxcDAOIExKR3XCtT2nvpZDAyM7RiT5mUbjpNyNz9z2zYLDAyMhzDa5bO26dimhvUGNQwMjK0ZSdhNtjskr0+W9deewsDAOIExaW0m4ThPKNtMDwMDAyMpStsmQZ4sJo0BDAyMcxjzJbO27Jxs0bicAwYGxmGMdiGsbTomH6hulGJgYBzAWNsGsbZFYzFj/XwnBgbGpox3eayF17aUzQMuBgbGCYy2G9gGyjw052XwqMGJgYHxWMY8dZs/u1bEFgkiBgbGFox743d7pi1i/1huw8DAwCgD9F0Ng8XlRAwMjCMZeVHabtpIGgxRCxMDA2NTRhJA89fkI+efBgMD42RGm3etbdv6diqJgYGxKeMfhZPRPxsBAn0AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
