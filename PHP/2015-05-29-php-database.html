<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>PHP Database | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,php">
    <meta name="description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Many PHP applications persist information in a wide assortment of databases like MySQL, PostgreSQL, SQLite, MSSQL, and Oracle.">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP Database">
<meta property="og:url" content="http://blog.inching.org/PHP/2015-05-29-php-database.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Many PHP applications persist information in a wide assortment of databases like MySQL, PostgreSQL, SQLite, MSSQL, and Oracle.">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP Database">
<meta name="twitter:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Many PHP applications persist information in a wide assortment of databases like MySQL, PostgreSQL, SQLite, MSSQL, and Oracle.">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.17">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">PHP Database</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">PHP Database</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-05-28T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2015-05-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#The-PDO-Extension"><span class="post-toc-text">The PDO Extension</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Database-Connections-and-DSNs"><span class="post-toc-text">Database Connections and DSNs</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Prepared-Statements"><span class="post-toc-text">Prepared Statements</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Query-Results"><span class="post-toc-text">Query Results</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Transactions"><span class="post-toc-text">Transactions</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-php-database"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">PHP Database</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-05-29 00:00:00" datetime="2015-05-28T16:00:00.000Z"  itemprop="datePublished">2015-05-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>See <a href="http://www.salttiger.com/modern-php/" target="_blank" rel="external">《Modern PHP》</a> and <a href="http://www.salttiger.com/learning-php-mysql-javascript-4th-edition/" target="_blank" rel="external">《Learning PHP, MySQL &amp; JavaScript, 4th Edition》</a>.</p>
<p>Many PHP applications persist information in a wide assortment of databases like MySQL, PostgreSQL, SQLite, MSSQL, and Oracle. Each database provides its own PHP extension to establish communication between PHP and the database. MySQL, for example, uses the <code>mysqli</code> extension, which adds various <code>mysqli_*()</code> functions to the PHP language. SQLite3 uses the <code>SQLite3</code> extension, which adds the <code>SQLite3</code>, <code>SQLite3Stmt</code>, and <code>SQLite3Result</code> classes to the PHP language. If you work with different databases in one or more projects, you have to install and learn various PHP database extensions and interfaces. This increases your cognitive and technical overhead.</p>
<a id="more"></a>
<h3 id="The-PDO-Extension"><a href="#The-PDO-Extension" class="headerlink" title="The PDO Extension"></a>The PDO Extension</h3><p>This is exactly why PHP provides the native PDO extension. PDO (or <em>PHP data objects</em>) is a collection of PHP classes that communicate with many different SQL databases via a single user interface. Database implementations are abstracted away. Instead, we can write and execute database queries with a single interface regardless of the particular database system we happen to be using at the time.</p>
<p>Even though the PDO extension provides a single interface to different databases, we still must write our own SQL statements. This is the downside to PDO. Each database provides proprietary features, and these features often require unique SQL syntax. I recommend you write ANSI/ISO SQL when using PDO so that your SQL doesn’t break if/when you change database systems. If you absolutely must use a proprietary database feature, keep in mind you must update your SQL statements if you change database systems.</p>
<h3 id="Database-Connections-and-DSNs"><a href="#Database-Connections-and-DSNs" class="headerlink" title="Database Connections and DSNs"></a>Database Connections and DSNs</h3><p>First, select the database system most appropriate for your application. Install the database, create the schema, and optionally load an initial dataset. Next, instantiate the <code>PDO</code> class in PHP. The <code>PDO</code> instance establishes a connection between PHP and the database.</p>
<p>The <code>PDO</code> class constructor accepts a string argument called a DSN, or data source name, that provides database connection details. A DSN begins with the database driver name (e.g., <code>mysql</code> or <code>sqlite</code>), a <code>:</code>, and the remainder of the connection string. The DSN connection string is different for each database, but it typically includes:* Hostname or IP address</p>
<ul>
<li>Port number</li>
<li>Database name</li>
<li>Character set</li>
</ul>
<p>Learn more about your database’s DSN format at <a href="http://php.net/manual/pdo.drivers.php" target="_blank" rel="external">http://php.net/manual/pdo.drivers.php</a>.</p>
<p>The <code>PDO</code> class constructor’s second and third arguments are a username and password for your database. Provide these arguments if your database requires authentication.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">try &#123;</div><div class="line">    $pdo = new PDO(</div><div class="line">        &apos;mysql:host=127.0.0.1;dbname=books;port=3306;charset=utf8&apos;,</div><div class="line">        &apos;USERNAME&apos;,</div><div class="line">        &apos;PASSWORD&apos;</div><div class="line">    );</div><div class="line">&#125; catch (PDOException $e) &#123;</div><div class="line">    // Database connection failed</div><div class="line">    echo &quot;Database connection failed&quot;;</div><div class="line">    exit;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The database is available at IP address <code>127.0.0.1</code>, and it listens on the standard MySQL port <code>3306</code>. The database username is <code>josh</code>, and the database password is <code>sekrit</code>. The connection character set is <code>utf8</code>.</p>
<p>The <code>PDO</code> class constructor’s first argument is the DSN. The DSN begins with <code>mysql:</code>. This instructs PDO to use the PDO MySQL driver to connect to a MySQL database. After the <code>:</code> character, we specify a semicolon-delimited list of keys and values. Specifically, we specify the <code>host</code>, <code>dbname</code>, <code>port</code>, and <code>charset</code> settings.</p>
<p>The PDO constructor throws a <code>PDOException</code> instance if the database connection fails. It’s important that you anticipate and catch this exception when creating PDO connections.</p>
<p><em>Never hard-code database credentials into PHP files</em>, especially PHP files served to the public. If PHP exposes raw PHP code to HTTP clients due to a bug or server misconfiguration, your database credentials are naked for the world to see. Instead, move your database credentials into a configuration file <em>above</em> the document root and include them into your PHP files when necessary.</p>
<p>Do not version control your credentials, either. Protect your credentials with a <em>.gitignore</em> file. Otherwise, you will publish your secret credentials into your code repository for others to see. This is especially bad if you are using a public repository.</p>
<p>In this example, the <em>settings.php</em> file contains our database connection credentials. It lives beneath the project root directory but above the document root. The <em>index.php</em> file lives beneath the document root directory, and it is served to the public with a web server. The <em>index.php</em> file uses the credentials in the <em>settings.php</em> file:</p>
<p>This is the <em>settings.php</em> file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$settings = [</div><div class="line">    &apos;host&apos; =&gt; &apos;127.0.0.1&apos;,</div><div class="line">    &apos;port&apos; =&gt; &apos;3306&apos;,</div><div class="line">    &apos;name&apos; =&gt; &apos;acme&apos;,</div><div class="line">    &apos;username&apos; =&gt; &apos;USERNAME&apos;,</div><div class="line">    &apos;password&apos; =&gt; &apos;PASSWORD&apos;,</div><div class="line">    &apos;charset&apos; =&gt; &apos;utf8&apos;</div><div class="line">];</div></pre></td></tr></table></figure>
<p>PDO constructor with external settings, <em>index.php</em>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">include(&apos;../settings.php&apos;);</div><div class="line"></div><div class="line">$pdo = new PDO(</div><div class="line">    sprintf(</div><div class="line">        &apos;mysql:host=%s;dbname=%s;port=%s;charset=%s&apos;,</div><div class="line">        $settings[&apos;host&apos;],</div><div class="line">        $settings[&apos;name&apos;],</div><div class="line">        $settings[&apos;port&apos;],</div><div class="line">        $settings[&apos;charset&apos;]</div><div class="line">    ),</div><div class="line">    $settings[&apos;username&apos;],</div><div class="line">    $settings[&apos;password&apos;]</div><div class="line">);</div></pre></td></tr></table></figure>
<p>This is much safer. If the <em>index.php</em> code leaks to the public, our database credentials remain secret.</p>
<h3 id="Prepared-Statements"><a href="#Prepared-Statements" class="headerlink" title="Prepared Statements"></a>Prepared Statements</h3><p>A prepared statement is a <code>PDOStatement</code> instance. However, I rarely instantiate the <code>PDOStatement</code> class directly. Instead, I fetch a prepared statement object with the <code>PDO</code> instance’s <code>prepare()</code> method. This method accepts a SQL statement string as its first argument, and it returns a <code>PDOStatement</code> instance:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$sql = &apos;SELECT id FROM users WHERE email = :email&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div></pre></td></tr></table></figure>
<p>Pay close attention to the SQL statement. The <code>:email</code> is a <em>named placeholder</em> to which I can safely bind any value. I bind the HTTP request query string to the <code>:email</code> placeholder with the <code>$statement</code> instance’s <code>bindValue()</code> method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$sql = &apos;SELECT id FROM users WHERE email = :email&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line"></div><div class="line">$email = filter_input(INPUT_GET, &apos;email&apos;);</div><div class="line">$statement-&gt;bindValue(&apos;:email&apos;, $email);</div></pre></td></tr></table></figure>
<p>The prepared statement automatically sanitizes the <code>$email</code> value, and it protects our database from SQL injection attacks. You can include multiple named placeholders in a SQL statement string and invoke the prepared statement’s <code>bindValue()</code> method for each placeholder.</p>
<p>the <code>:email</code> named placeholder represents a string value. What if we change our SQL statement to find a user by a numeric ID? In this case, we must pass a third argument to the prepared statement’s <code>bindValue()</code> method to specify the type of data bound to the placeholder. Without the third argument, a prepared statement assumes bound data is a string.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$sql = &apos;SELECT email FROM users WHERE id = :id&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line"></div><div class="line">$userId = filter_input(INPUT_GET, &apos;id&apos;);</div><div class="line">$statement-&gt;bindValue(&apos;:id&apos;, $userId, PDO::PARAM_INT);</div></pre></td></tr></table></figure>
<p>We use the <code>PDO::PARAM_INT</code> constant as the third argument. This tells PDO that the bound data is an integer. There are several PDO constants you can use to specify various data types:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PDO::PARAM_BOOL</div><div class="line">PDO::PARAM_NULL</div><div class="line">PDO::PARAM_INT</div><div class="line">PDO::PARAM_STR (default)</div></pre></td></tr></table></figure>
<p>See more <a href="http://php.net/manual/pdo.constants.php" target="_blank" rel="external">http://php.net/manual/pdo.constants.php</a>.</p>
<h3 id="Query-Results"><a href="#Query-Results" class="headerlink" title="Query Results"></a>Query Results</h3><p>We now have a prepared statement, and we’re ready to execute SQL queries against the database. The prepared statement’s <code>execute()</code> method executes the statement’s SQL statement with any bound data. If you are executing <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code> statements, invoke the <code>execute()</code> method and you’re done. If you execute a <code>SELECT</code> statement, you probably expect the database to return matching records. You can fetch query results with the prepared statement’s <code>fetch()</code>, <code>fetchAll()</code>, <code>fetchColumn()</code>, and <code>fetchObject()</code> methods.</p>
<p>The <code>PDOStatement</code> instance’s <code>fetch()</code> method returns the next row from the result set. I use this method to iterate large result sets, especially if the entire result set cannot fit in available memory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">// Build and execute SQL query</div><div class="line">$sql = &apos;SELECT id, email FROM users WHERE email = :email&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line">$email = filter_input(INPUT_GET, &apos;email&apos;);</div><div class="line">$statement-&gt;bindValue(&apos;:email&apos;, $email, PDO::PARAM_INT);</div><div class="line">$statement-&gt;execute();</div><div class="line"></div><div class="line">// Iterate results</div><div class="line">while (($result = $statement-&gt;fetch(PDO::FETCH_ASSOC)) !== false) &#123;</div><div class="line">    echo $result[&apos;email&apos;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In this example, I use the <code>PDO::FETCH_ASSOC</code> constant as the first argument in the statement instance’s <code>fetch()</code> method. This argument determines how the <code>fetch()</code> and <code>fetchAll()</code> methods return query results. You can use any of these constants:</p>
<ul>
<li><p>PDO::FETCH_ASSOC</p>
<p>  Prompts the fetch() or fetchAll() method to return an associative array. The array keys are database column names.</p>
</li>
<li><p>PDO::FETCH_NUM</p>
<p>  Prompts the fetch() or fetchAll() method to return a numeric array. The array keys are the numeric index of database columns in your query result.</p>
</li>
<li><p>PDO::FETCH_BOTH</p>
<p>  Prompts the fetch() or fetchAll() method to return an array that contains both associative and numeric array keys. This is a combination of PDO::FETCH_ASSOC and PDO::FETCH_NUM.</p>
</li>
<li><p>PDO::FETCH_OBJ</p>
<p>  Prompts the fetch() or fetchAll() method to return an object whose properties are database column names.</p>
</li>
</ul>
<p>See more <a href="http://php.net/manual/pdostatement.fetch.php" target="_blank" rel="external">http://php.net/manual/pdostatement.fetch.php</a>.</p>
<p>If you are working with smaller result sets, you can fetch <em>all</em> query<br>results with the prepared statement’s <code>fetchAll()</code> method. I typically discourage this method unless you are absolutely sure the complete query result is small enough to fit in available memory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">// Build and execute SQL query</div><div class="line">$sql = &apos;SELECT id, email FROM users WHERE email = :email&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line">$email = filter_input(INPUT_GET, &apos;email&apos;);</div><div class="line">$statement-&gt;bindValue(&apos;:email&apos;, $email, PDO::PARAM_INT);</div><div class="line">$statement-&gt;execute();</div><div class="line"></div><div class="line">// Iterate results</div><div class="line">$results = $statement-&gt;fetchAll(PDO::FETCH_ASSOC);</div><div class="line">foreach ($results as $result) &#123;</div><div class="line">    echo $result[&apos;email&apos;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you are concerned only with a single column in your query result, you can use the prepared statement’s <code>fetchColumn()</code> method. This method, similar to the <code>fetch()</code> method, returns the value of a single column from the next row of the query result. The <code>fetchColumn()</code> method’s one and only argument is the index of the desired column.</p>
<p>The query result column order matches the column order specified in the SQL query.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">// Build and execute SQL query</span></div><div class="line">$sql = <span class="string">'SELECT id, email FROM users WHERE email = :email'</span>;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line">$email = filter_input(INPUT_GET, <span class="string">'email'</span>);</div><div class="line">$statement-&gt;bindValue(<span class="string">':email'</span>, $email, PDO::PARAM_INT);</div><div class="line">$statement-&gt;execute();</div><div class="line"></div><div class="line"><span class="comment">// Iterate results</span></div><div class="line"><span class="keyword">while</span> (($email = $statement-&gt;fetchColumn(<span class="number">1</span>)) !== <span class="keyword">false</span>) &#123;</div><div class="line">    <span class="keyword">echo</span> $email;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>The <code>email</code> column is listed second in the SQL query. It therefore becomes the second column in each query result row, and I pass the number <code>1</code> into the <code>fetchColumn()</code> method.</p>
<p>You can also use the prepared statement’s <code>fetchObject()</code> method to fetch the next query result row as an object whose property names are the SQL query result columns.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">// Build and execute SQL query</div><div class="line">$sql = &apos;SELECT id, email FROM users WHERE email = :email&apos;;</div><div class="line">$statement = $pdo-&gt;prepare($sql);</div><div class="line">$email = filter_input(INPUT_GET, &apos;email&apos;);</div><div class="line">$statement-&gt;bindValue(&apos;:email&apos;, $email, PDO::PARAM_INT);</div><div class="line">$statement-&gt;execute();</div><div class="line"></div><div class="line">// Iterate results</div><div class="line">while (($result = $statement-&gt;fetchObject()) !== false) &#123;</div><div class="line">    echo $result-&gt;name;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h3><p>Not all databases support transactions. Check your database’s documentation and its associated PHP PDO driver for more information.</p>
<p>Atomicity is important when data integrity is paramount. Let’s explore example code that handles bank account transactions. Our code can deposit funds into an account. It can also withdraw funds from an account assuming there are sufficient funds.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">require &apos;settings.php&apos;;</div><div class="line"></div><div class="line">// PDO connection</div><div class="line">try &#123;</div><div class="line">    $pdo = new PDO(</div><div class="line">        sprintf(</div><div class="line">            &apos;mysql:host=%s;dbname=%s;port=%s;charset=%s&apos;,</div><div class="line">            $settings[&apos;host&apos;],</div><div class="line">            $settings[&apos;name&apos;],</div><div class="line">            $settings[&apos;port&apos;],</div><div class="line">            $settings[&apos;charset&apos;]</div><div class="line">        ),</div><div class="line">        $settings[&apos;username&apos;],</div><div class="line">        $settings[&apos;password&apos;]</div><div class="line">    );</div><div class="line">&#125; catch (PDOException $e) &#123;</div><div class="line">    // Database connection failed</div><div class="line">    echo &quot;Database connection failed&quot;;</div><div class="line">    exit;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Statements</div><div class="line">$stmtSubtract = $pdo-&gt;prepare(&apos;</div><div class="line">    UPDATE accounts</div><div class="line">    SET amount = amount - :amount</div><div class="line">    WHERE name = :name</div><div class="line">&apos;);</div><div class="line">$stmtAdd = $pdo-&gt;prepare(&apos;</div><div class="line">    UPDATE accounts</div><div class="line">    SET amount = amount + :amount</div><div class="line">    WHERE name = :name</div><div class="line">&apos;);</div><div class="line"></div><div class="line">// Start transaction</div><div class="line">$pdo-&gt;beginTransaction();</div><div class="line"></div><div class="line">// Withdraw funds from account 1</div><div class="line">$fromAccount = &apos;Checking&apos;;</div><div class="line">$withdrawal = 50;</div><div class="line">$stmtSubtract-&gt;bindParam(&apos;:name&apos;, $fromAccount);</div><div class="line">$stmtSubtract-&gt;bindParam(&apos;:amount&apos;, $withDrawal, PDO::PARAM_INT);</div><div class="line">$stmtSubtract-&gt;execute();</div><div class="line"></div><div class="line">// Deposit funds into account 2</div><div class="line">$toAccount = &apos;Savings&apos;;</div><div class="line">$deposit = 50;</div><div class="line">$stmtAdd-&gt;bindParam(&apos;:name&apos;, $toAccount);</div><div class="line">$stmtAdd-&gt;bindParam(&apos;:amount&apos;, $deposit, PDO::PARAM_INT);</div><div class="line">$stmtAdd-&gt;execute();</div><div class="line"></div><div class="line">// Commit transaction</div><div class="line">$pdo-&gt;commit();</div></pre></td></tr></table></figure>
        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/PHP/2015-05-29-php-database.html" target="_blank" rel="external">http://blog.inching.org/PHP/2015-05-29-php-database.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-29-php-database.html&title=《PHP Database》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-29-php-database.html&title=《PHP Database》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Man..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-29-php-database.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP Database》 — Balance&url=http://blog.inching.org/PHP/2015-05-29-php-database.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-29-php-database.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/PHP/2015-05-30-php-exception.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">PHP Errors and Exceptions</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/PHP/2015-05-28-php-components.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">PHP Components</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-29-php-database.html&title=《PHP Database》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-29-php-database.html&title=《PHP Database》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Man..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-29-php-database.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP Database》 — Balance&url=http://blog.inching.org/PHP/2015-05-29-php-database.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-29-php-database.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3aQW7DMAwF0dz/0u42QBFnPqkWMDlaFW5S6XnBkiJfL7yut/Xpt/efJ9+93+XAkiFDxmMZ1+369Jn7w3FMuu9HqgwZMhYwSCjkB/2yJd6Lh3gZMmTISANlJwWUIUOGjD6DkO6fny19ZciQsYdBikmeDvI7MfLKDtfiMmTIeCCD37r//89/0t+QIUPGoxhXuHhA5C3Jq71kyJAxm8EDXFqIptdtacCVIUPGHkYn1PKDdhoGqGSVIUPGaEZ6KZ8OgfFmZ6058eXuUIYMGSMYncGvTsuz9b5/f1eGDBnLGGRgqxZYi0dMp0VkyJAxlMGPlYZgkmLWgr4MGTL2MHiBen8g8pwMkwUNS/I/RIYMGYMYtUSQHOVU0omSSxkyZCxjpMMQvPVYa22iNFGGDBlDGWmBWkvseDOg+ESGDBlrGDxcppf7tXZC0FqQIUPGAgYvKTstBH6dF6ePMmTIWMNADULc+EyPmLYcZMiQsYfBByD4Nrwtyl8Ef1kyZMiYyjgbBGuH5uG+eOkmQ4aMEQwS2jpBmX+39kSGDBkbGGnISxO7tIhNi2cZMmRMZVzh6iR5fMwrpsqQIWM0oxZe05GvdHSsk4zKkCFjKqOWup0dHevc8MuQIWMPgzc10+v+zt+PS1kZMmTIwOGyU76mO8qQIUMGbzqScreWSqLEVIYMGQsYvBnAhyHSsrZ2kSdDhowNDF46pkEzbQnUMDJkyBjN+AH+QGqYRGgvMAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
