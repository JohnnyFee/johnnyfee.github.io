<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>PHP MySQL | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,php">
    <meta name="description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Creating a Login FileI’ve called login.php:
123456&amp;lt;?php // login.php  $hn = &amp;apos;localhost&amp;apos;;  $db = &amp;apos;publication">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP MySQL">
<meta property="og:url" content="http://blog.inching.org/PHP/2015-05-27-php-mysql.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Creating a Login FileI’ve called login.php:
123456&amp;lt;?php // login.php  $hn = &amp;apos;localhost&amp;apos;;  $db = &amp;apos;publication">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/php-mysql-query.png">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP MySQL">
<meta name="twitter:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Creating a Login FileI’ve called login.php:
123456&amp;lt;?php // login.php  $hn = &amp;apos;localhost&amp;apos;;  $db = &amp;apos;publication">
<meta name="twitter:image" content="http://johnnyimages.qiniudn.com/php-mysql-query.png">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">PHP MySQL</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">PHP MySQL</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-05-26T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2015-05-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Creating-a-Login-File"><span class="post-toc-text">Creating a Login File</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Connecting-to-a-MySQL-Database"><span class="post-toc-text">Connecting to a MySQL Database</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Building-and-executing-a-query"><span class="post-toc-text">Building and executing a query</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Closing-a-connection"><span class="post-toc-text">Closing a connection</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Manager-DDL"><span class="post-toc-text">Manager DDL</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Creating-a-Table"><span class="post-toc-text">Creating a Table</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Describing-a-Table"><span class="post-toc-text">Describing a Table</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dropping-a-Table"><span class="post-toc-text">Dropping a Table</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Adding-Data"><span class="post-toc-text">Adding Data</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Retrieving-Data"><span class="post-toc-text">Retrieving Data</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Using-AUTO-INCREMENT"><span class="post-toc-text">Using AUTO_INCREMENT</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Preventing-Hacking-Attempts"><span class="post-toc-text">Preventing Hacking Attempts</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Steps-You-Can-Take"><span class="post-toc-text">Steps You Can Take</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Using-Placeholders"><span class="post-toc-text">Using Placeholders</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Preventing-HTML-Injection"><span class="post-toc-text">Preventing HTML Injection</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ultimate-protection"><span class="post-toc-text">ultimate protection</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Using-mysqli-Procedurally"><span class="post-toc-text">Using mysqli Procedurally</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#A-Practical-Example"><span class="post-toc-text">A Practical Example</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-php-mysql"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">PHP MySQL</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-05-27 00:00:00" datetime="2015-05-26T16:00:00.000Z"  itemprop="datePublished">2015-05-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>See <a href="http://www.salttiger.com/modern-php/" target="_blank" rel="external">《Modern PHP》</a> and <a href="http://www.salttiger.com/learning-php-mysql-javascript-4th-edition/" target="_blank" rel="external">《Learning PHP, MySQL &amp; JavaScript, 4th Edition》</a>.</p>
<h2 id="Creating-a-Login-File"><a href="#Creating-a-Login-File" class="headerlink" title="Creating a Login File"></a>Creating a Login File</h2><p>I’ve called <code>login.php</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?php // login.php</div><div class="line">  $hn = &apos;localhost&apos;;</div><div class="line">  $db = &apos;publications&apos;;</div><div class="line">  $un = &apos;username&apos;;</div><div class="line">  $pw = &apos;password&apos;;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="Connecting-to-a-MySQL-Database"><a href="#Connecting-to-a-MySQL-Database" class="headerlink" title="Connecting to a MySQL Database"></a>Connecting to a MySQL Database</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>The <code>die</code> function is great for when you are developing PHP code, but of course you will want more user-friendly error messages on a production server. In this case, you won’t abort your PHP program, but format a message that will be displayed when the program exits normally, perhaps something like this:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysql_fatal_error</span><span class="params">($msg)</span></span></div><div class="line">&#123;</div><div class="line">    $msg2 = mysql_error();</div><div class="line">    <span class="keyword">echo</span> &lt;&lt;&lt; _END</div><div class="line">We are sorry, but it was not possible to complete</div><div class="line">the requested task. The error message we got was:</div><div class="line"></div><div class="line">    &lt;p&gt;$msg: $msg2&lt;/p&gt;</div><div class="line"></div><div class="line">Please click the back button on your browser</div><div class="line"><span class="keyword">and</span> <span class="keyword">try</span> again. <span class="keyword">If</span> you are still having problems,</div><div class="line">please &lt;a href=<span class="string">"mailto:admin@server.com"</span>&gt;email</div><div class="line">our administrator&lt;/a&gt;. Thank you.</div><div class="line">_END;</div><div class="line"><span class="meta">?&gt;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Building-and-executing-a-query"><a href="#Building-and-executing-a-query" class="headerlink" title="Building and executing a query"></a>Building and executing a query</h2><p>Sending a query to MySQL from PHP is as simple as issuing it using the <code>query</code> method of a connection object.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  $query  = &quot;SELECT * FROM classics&quot;;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die($conn-&gt;error);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p><strong>Fetching a result</strong></p>
<p>Once you have an object returned in <code>$result</code>, you can use it to extract the data you want, one item at a time, using the <code>fetch_assoc</code> method of the object.</p>
<p>I suggest that you save this script using the filename <em>query.php</em></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="comment">// query.php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = <span class="string">"SELECT * FROM classics"</span>;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  <span class="keyword">if</span> (!$result) <span class="keyword">die</span>($conn-&gt;error);</div><div class="line"></div><div class="line">  $rows = $result-&gt;num_rows;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> ($j = <span class="number">0</span> ; $j &lt; $rows ; ++$j)</div><div class="line">  &#123;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Author: '</span>   . $result-&gt;fetch_assoc()[<span class="string">'author'</span>]   . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Title: '</span>    . $result-&gt;fetch_assoc()[<span class="string">'title'</span>]    . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Category: '</span> . $result-&gt;fetch_assoc()[<span class="string">'category'</span>] . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Year: '</span>     . $result-&gt;fetch_assoc()[<span class="string">'year'</span>]     . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    <span class="keyword">echo</span> <span class="string">'ISBN: '</span>     . $result-&gt;fetch_assoc()[<span class="string">'isbn'</span>]     . <span class="string">'&lt;br&gt;&lt;br&gt;'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $result-&gt;close();</div><div class="line">  $conn-&gt;close();</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Here, to seek to the correct row each time around the loop, we call the <code>data_seek</code> method of <code>$result</code> before fetching each item of data. Then we call the <code>fetch_assoc</code> method to retrieve the value stored in each cell, and output the result using <code>echo</code> statements.</p>
<p>To fetch one row at a time:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="comment">//fetchrow.php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = <span class="string">"SELECT * FROM classics"</span>;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  <span class="keyword">if</span> (!$result) <span class="keyword">die</span>($conn-&gt;error);</div><div class="line"></div><div class="line">  $rows = $result-&gt;num_rows;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> ($j = <span class="number">0</span> ; $j &lt; $rows ; ++$j)</div><div class="line">  &#123;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    $row = $result-&gt;fetch_array(MYSQLI_ASSOC);</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">'Author: '</span>   . $row[<span class="string">'author'</span>]   . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Title: '</span>    . $row[<span class="string">'title'</span>]    . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Category: '</span> . $row[<span class="string">'category'</span>] . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">'Year: '</span>     . $row[<span class="string">'year'</span>]     . <span class="string">'&lt;br&gt;'</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">'ISBN: '</span>     . $row[<span class="string">'isbn'</span>]     . <span class="string">'&lt;br&gt;&lt;br&gt;'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $result-&gt;close();</div><div class="line">  $conn-&gt;close();</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>In this modified code, only one seek into the object is made in each iteration of the loop, because each row is fetched in its entirety via the <code>fetch_array</code> method. This returns a single row of data as an array, which is then assigned to the array <code>$row</code>.</p>
<p>The <code>fetch_array</code> method can return three types of array according to the value passed to it:</p>
<ul>
<li><p>MYSQLI_NUM</p>
<p>  Numeric array. Each column appears in the array in the order in which you defined it when you created (or altered) the table. In our case, the zeroth element of the array contains the Author column, element 1 contains the Title, and so on.</p>
</li>
<li><p>MYSQLI_ASSOC</p>
<p>  Associative array. Each key is the name of a column. Because items of data are referenced by column name (rather than index number), use this option where possible in your code to make debugging easier and help other programmers better manage your code.</p>
</li>
<li><p>MYSQLI_BOTH</p>
<p>  Associative and numeric array. Associative arrays are usually more useful than numeric ones because you can refer to each column by name, such as <code>$row[&#39;author&#39;]</code>, instead of trying to remember where it is in the column order. So this script uses an associative array, leading us to pass <code>MYSQLI_ASSOC</code>.</p>
</li>
</ul>
<h2 id="Closing-a-connection"><a href="#Closing-a-connection" class="headerlink" title="Closing a connection"></a>Closing a connection</h2><p>PHP will eventually return the memory it has allocated for objects after you have finished with the script, so in small scripts, you don’t usually need to worry about releasing memory yourself. However, if you’re allocating a lot of result objects or fetching large amounts of data, it can be a good idea to free the memory you have been using to prevent problems later in your script.</p>
<p>This becomes particularly important on higher-traffic pages, because the amount of memory consumed in a session can rapidly grow. Therefore, note the calls to the <code>close</code> methods of the objects <code>$result</code> and <code>$conn</code> in the preceding scripts, as soon as each object is no longer needed, like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$result-&gt;close();</div><div class="line">$conn-&gt;close();</div></pre></td></tr></table></figure>
<h2 id="Manager-DDL"><a href="#Manager-DDL" class="headerlink" title="Manager DDL"></a>Manager DDL</h2><h3 id="Creating-a-Table"><a href="#Creating-a-Table" class="headerlink" title="Creating a Table"></a>Creating a Table</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query = &quot;CREATE TABLE cats (</div><div class="line">    id SMALLINT NOT NULL AUTO_INCREMENT,</div><div class="line">    family VARCHAR(32) NOT NULL,</div><div class="line">    name VARCHAR(32) NOT NULL,</div><div class="line">    age TINYINT NOT NULL,</div><div class="line">    PRIMARY KEY (id)</div><div class="line">  )&quot;;</div><div class="line"></div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die (&quot;Database access failed: &quot; . $conn-&gt;error);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h3 id="Describing-a-Table"><a href="#Describing-a-Table" class="headerlink" title="Describing a Table"></a>Describing a Table</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = <span class="string">"DESCRIBE cats"</span>;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  <span class="keyword">if</span> (!$result) <span class="keyword">die</span> (<span class="string">"Database access failed: "</span> . $conn-&gt;error);</div><div class="line"></div><div class="line">  $rows = $result-&gt;num_rows;</div><div class="line"></div><div class="line">  <span class="keyword">echo</span> <span class="string">"&lt;table&gt;&lt;tr&gt;&lt;th&gt;Column&lt;/th&gt;&lt;th&gt;Type&lt;/th&gt;&lt;th&gt;Null&lt;/th&gt;&lt;th&gt;Key&lt;/th&gt;&lt;/tr&gt;"</span>;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> ($j = <span class="number">0</span> ; $j &lt; $rows ; ++$j)</div><div class="line">  &#123;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    $row = $result-&gt;fetch_array(MYSQLI_NUM);</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;"</span>;</div><div class="line">    <span class="keyword">for</span> ($k = <span class="number">0</span> ; $k &lt; <span class="number">4</span> ; ++$k) <span class="keyword">echo</span> <span class="string">"&lt;td&gt;$row[$k]&lt;/td&gt;"</span>;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;"</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/table&gt;"</span>;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Dropping-a-Table"><a href="#Dropping-a-Table" class="headerlink" title="Dropping a Table"></a>Dropping a Table</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = &quot;DROP TABLE cats&quot;;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die (&quot;Database access failed: &quot; . $conn-&gt;error);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h3 id="Adding-Data"><a href="#Adding-Data" class="headerlink" title="Adding Data"></a>Adding Data</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = &quot;INSERT INTO cats VALUES(NULL, &apos;Lion&apos;, &apos;Leo&apos;, 4)&quot;;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die (&quot;Database access failed: &quot; . $conn-&gt;error);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h3 id="Retrieving-Data"><a href="#Retrieving-Data" class="headerlink" title="Retrieving Data"></a>Retrieving Data</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = &quot;SELECT * FROM cats&quot;;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die (&quot;Database access failed: &quot; . $conn-&gt;error);</div><div class="line"></div><div class="line">  $rows = $result-&gt;num_rows;</div><div class="line">  echo &quot;&lt;table&gt;&lt;tr&gt; &lt;th&gt;Id&lt;/th&gt; &lt;th&gt;Family&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Age&lt;/th&gt;&lt;/tr&gt;&quot;;</div><div class="line"></div><div class="line">  for ($j = 0 ; $j &lt; $rows ; ++$j)</div><div class="line">  &#123;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    $row = $result-&gt;fetch_array(MYSQLI_NUM);</div><div class="line"></div><div class="line">    echo &quot;&lt;tr&gt;&quot;;</div><div class="line">    for ($k = 0 ; $k &lt; 4 ; ++$k) echo &quot;&lt;td&gt;$row[$k]&lt;/td&gt;&quot;;</div><div class="line">    echo &quot;&lt;/tr&gt;&quot;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  echo &quot;&lt;/table&gt;&quot;;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h2 id="Using-AUTO-INCREMENT"><a href="#Using-AUTO-INCREMENT" class="headerlink" title="Using AUTO_INCREMENT"></a>Using AUTO_INCREMENT</h2><p>When using <code>AUTO_INCREMENT</code>, you cannot know what value has been given to a column before a row is inserted. Instead, if you need to know it, you must ask MySQL afterward using the <code>mysql_insert_id</code> function. This need is common: for instance, when you process a purchase, you might insert a new customer into a <em>Customers</em> table and then refer to the newly created <em>CustId</em> when inserting a purchase into the purchase table.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $query  = &quot;INSERT INTO cats VALUES(NULL, &apos;Lynx&apos;, &apos;Stumpy&apos;, 5)&quot;;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  if (!$result) die (&quot;Database access failed: &quot; . $conn-&gt;error);</div><div class="line"></div><div class="line">  echo &quot;The Insert ID was: &quot; . $result-&gt;insert_id;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>It’s very common to insert data in multiple tables: a book followed by its author, or a customer followed by his purchase, and so on. When doing this with an auto-increment column, you will need to retain the insert ID returned for storing in the related table.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$query    = &quot;INSERT INTO cats VALUES(NULL, &apos;Lynx&apos;, &apos;Stumpy&apos;, 5)&quot;;</div><div class="line">$result   = $conn-&gt;query($query);</div><div class="line">$insertID = $result-&gt;insert_id;</div><div class="line"></div><div class="line">$query    = &quot;INSERT INTO owners VALUES($insertID, &apos;Ann&apos;, &apos;Smith&apos;)&quot;;</div><div class="line">$result   = $conn-&gt;query($query);</div></pre></td></tr></table></figure>
<p>A completely safe procedure for linking tables through the insert ID is to use locks. It can slow down response time a bit when there are many people submitting data to the same table, but it can also be worth it. The sequence is as follows:</p>
<ol>
<li>Lock the first table (e.g., <em>cats</em>).</li>
<li>Insert data into the first table.</li>
<li>Retrieve the unique ID from the first table (the <code>insert_id</code> property).</li>
<li>Unlock the first table.</li>
<li>Insert data into the second table.</li>
</ol>
<p>You can safely release the lock before inserting data into the second table, because the insert ID has been retrieved and is stored in a program variable. You could also use a transaction instead of locking, but that slows down the MySQL server even more.</p>
<h2 id="Preventing-Hacking-Attempts"><a href="#Preventing-Hacking-Attempts" class="headerlink" title="Preventing Hacking Attempts"></a>Preventing Hacking Attempts</h2><h3 id="Steps-You-Can-Take"><a href="#Steps-You-Can-Take" class="headerlink" title="Steps You Can Take"></a>Steps You Can Take</h3><p>You should always use the <code>real_escape_string</code> method for all calls to MySQL.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    <span class="keyword">return</span> $conn-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>The <code>get_magic_quotes_gpc</code> function returns <code>TRUE</code> if magic quotes are active. In that case, any slashes that have been added to a string have to be removed, or the <code>real_escape_string</code> method could end up double-escaping some characters, creating corrupted strings.</p>
<p>We can use it llike this:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $user  = mysql_fix_string($conn, $_POST[<span class="string">'user'</span>]);</div><div class="line">  $pass  = mysql_fix_string($conn, $_POST[<span class="string">'pass'</span>]);</div><div class="line">  $query = <span class="string">"SELECT * FROM users WHERE user='$user' AND pass='$pass'"</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Etc...</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    <span class="keyword">return</span> $conn-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Using-Placeholders"><a href="#Using-Placeholders" class="headerlink" title="Using Placeholders"></a>Using Placeholders</h3><p>Prepared statements with placeholders provide a method by which only data is transferred to the database, without the possibility of user-submitted (or other) data being interpreted as MySQL statements (and the potential for hacking that could then result).</p>
<p>It works by requiring you to first prepare the statement you wish to be executed in MySQL, but leave all the parts of the statement that refer to data as simple question marks.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">PREPARE statement FROM &quot;INSERT INTO classics VALUES(?,?,?,?,?)&quot;;</div><div class="line"></div><div class="line">SET @author   = &quot;Emily Brontë&quot;,</div><div class="line">    @title    = &quot;Wuthering Heights&quot;,</div><div class="line">    @category = &quot;Classic Fiction&quot;,</div><div class="line">    @year     = &quot;1847&quot;,</div><div class="line">    @isbn     = &quot;9780553212587&quot;;</div><div class="line"></div><div class="line">EXECUTE statement USING @author,@title,@category,@year,@isbn;</div><div class="line">DEALLOCATE PREPARE statement;</div></pre></td></tr></table></figure>
<p>This can be cumbersome to submit to MySQL, so the mysqli extension makes handling placeholders easier for you with a ready-made method called <code>prepare</code>, which you call like this:</p>
<pre><code>$stmt = $conn-&gt;prepare(&apos;INSERT INTO classics VALUES(?,?,?,?,?)&apos;);
</code></pre><p>The object <code>$stmt</code> (or whatever you choose to name it) returned by this method is then used for sending the data to the server in place of the question marks. It’s first use is to bind some PHP variables to each of the question marks (the placeholder parameters) in turn, like this:</p>
<pre><code>$stmt-&gt;bind_param(&apos;sssss&apos;, $author, $title, $category, $year, $isbn);
</code></pre><p>The first argument to <code>bind_param</code> is a string representing the type of each of the arguments in turn. In this case, it comprises five <code>s</code> characters, representing strings, but any combination of types can be specified here, out of the following:</p>
<ul>
<li><code>i</code> The data is an integer.</li>
<li><code>d</code> The data is a double.</li>
<li><code>s</code> The data is a string.</li>
<li><code>b</code> The data is a BLOB (and will be sent in packets).</li>
</ul>
<p>At this point, PHP now has everything it needs in order to execute the prepared statement, so we issue the following command, which calls the <code>execute</code> method of the <code>$stmt</code> object earlier created:</p>
<pre><code>$stmt-&gt;execute();
</code></pre><p>Before going any further, it makes sense to next check whether the command was executed successfully, so here’s how you can do that by checking the <code>affected_rows</code> property of <code>$statement</code>:</p>
<pre><code>printf(&quot;%d Row inserted.\n&quot;, $stmt-&gt;affected_rows);
</code></pre><p>Once you are happy that the statement executed successfully (or you have otherwise dealt with any errors), you can close the <code>$stmt</code> object, like this:</p>
<pre><code>$stmt-&gt;close();
</code></pre><p>And finally, close the <code>$conn</code> object (assuming you have finished with it too), like this:</p>
<pre><code>$conn-&gt;close();
</code></pre><p>When you put all this together:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $conn = new mysqli($hn, $un, $pw, $db);</div><div class="line">  if ($conn-&gt;connect_error) die($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $stmt = $conn-&gt;prepare(&apos;INSERT INTO classics VALUES(?,?,?,?,?)&apos;);</div><div class="line">  $stmt-&gt;bind_param(&apos;sssss&apos;, $author, $title, $category, $year, $isbn);</div><div class="line"></div><div class="line">  $author   = &apos;Emily Brontë&apos;;</div><div class="line">  $title    = &apos;Wuthering Heights&apos;;</div><div class="line">  $category = &apos;Classic Fiction&apos;;</div><div class="line">  $year     = &apos;1847&apos;;</div><div class="line">  $isbn     = &apos;9780553212587&apos;;</div><div class="line"></div><div class="line">  $stmt-&gt;execute();</div><div class="line">  printf(&quot;%d Row inserted.\n&quot;, $stmt-&gt;affected_rows);</div><div class="line">  $stmt-&gt;close();</div><div class="line">  $conn-&gt;close();</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>Every time you are able to use prepared statements in place of nonprepared, you will be closing a potential security hole, so it’s worth spending the time getting to know how to use them.</p>
<h3 id="Preventing-HTML-Injection"><a href="#Preventing-HTML-Injection" class="headerlink" title="Preventing HTML Injection"></a>Preventing HTML Injection</h3><p>There’s another type of injection you need to concern yourself about—not for the safety of your own websites, but for your users’ privacy and protection. That’s <em>cross-site scripting</em>, also referred to as <em>XSS</em>.</p>
<p>This occurs when you allow HTML, or more often JavaScript code, to be input by a user and then displayed back by your website. One place this is common is in a comment form. What happens most often is that a malicious user will try to write code that steals cookies from your site’s users, allowing him or her to discover username and password pairs or other information. Even worse, the malicious user might launch an attack to download a Trojan onto a user’s computer.</p>
<p>But preventing this is as simple as calling the <code>htmlentities</code> function, which strips out all HTML markup codes and replaces them with a form that displays the characters, but does not allow a browser to act on them. For example, consider this HTML:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&apos;http://x.com/hack.js&apos;&gt;</div><div class="line">&lt;/script&gt;&lt;script&gt;hack();&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>This code loads in a JavaScript program and then executes malicious functions. But if it is first passed through <code>htmlentities</code>, it will be turned into the following totally harmless string:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&amp;lt;script src=&apos;http://x.com/hack.js&apos;&amp;gt; &amp;lt;/script&amp;gt;</div><div class="line">&amp;lt;script&amp;gt;hack();&amp;lt;/script&amp;gt;</div></pre></td></tr></table></figure>
<p>Therefore, if you are ever going to display anything that your users enter, either immediately or after storing it in a database, you need to first sanitize it using the <code>htmlentities</code> function. To do this, I recommend that you create a new function, which can sanitize for both SQL and XSS injections.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_entities_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">return</span> htmlentities(mysql_fix_string($conn, $string));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    <span class="keyword">return</span> $conn-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>The <code>mysql_entities_fix_string</code> function first calls <code>mysql_fix_string</code> and then passes the result through <code>htmlentities</code> before returning the fully sanitized string. </p>
<h3 id="ultimate-protection"><a href="#ultimate-protection" class="headerlink" title="ultimate protection"></a>ultimate protection</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  $user  = mysql_entities_fix_string($conn, $_POST[<span class="string">'user'</span>]);</div><div class="line">  $pass  = mysql_entities_fix_string($conn, $_POST[<span class="string">'pass'</span>]);</div><div class="line">  $query = <span class="string">"SELECT * FROM users WHERE user='$user' AND pass='$pass'"</span>;</div><div class="line"></div><div class="line">  <span class="comment">//Etc...</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_entities_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">return</span> htmlentities(mysql_fix_string($conn, $string));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mysql_fix_string</span><span class="params">($conn, $string)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">if</span> (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    <span class="keyword">return</span> $conn-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Using-mysqli-Procedurally"><a href="#Using-mysqli-Procedurally" class="headerlink" title="Using mysqli Procedurally"></a>Using mysqli Procedurally</h2><p>If you prefer, there is an alternative set of functions you can use to access mysqli in a procedural (rather than object-oriented) manner.So, instead of creating a <code>$conn</code> object like this:</p>
<pre><code>$conn = new mysqli($hn, $un, $pw, $db);
</code></pre><p>You can use the following:</p>
<pre><code>$link = mysqli_connect($hn, $un, $pw, $db);
</code></pre><h2 id="A-Practical-Example"><a href="#A-Practical-Example" class="headerlink" title="A Practical Example"></a>A Practical Example</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="comment">// sqltest.php</span></div><div class="line">  <span class="keyword">require_once</span> <span class="string">'login.php'</span>;</div><div class="line">  $conn = <span class="keyword">new</span> mysqli($hn, $un, $pw, $db);</div><div class="line">  <span class="keyword">if</span> ($conn-&gt;connect_error) <span class="keyword">die</span>($conn-&gt;connect_error);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'delete'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'isbn'</span>]))</div><div class="line">  &#123;</div><div class="line">    $isbn   = get_post($conn, <span class="string">'isbn'</span>);</div><div class="line">    $query  = <span class="string">"DELETE FROM classics WHERE isbn='$isbn'"</span>;</div><div class="line">    $result = $conn-&gt;query($query);</div><div class="line">    <span class="keyword">if</span> (!$result) <span class="keyword">echo</span> <span class="string">"DELETE failed: $query&lt;br&gt;"</span> .</div><div class="line">      $conn-&gt;error . <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'author'</span>])   &amp;&amp;</div><div class="line">      <span class="keyword">isset</span>($_POST[<span class="string">'title'</span>])    &amp;&amp;</div><div class="line">      <span class="keyword">isset</span>($_POST[<span class="string">'category'</span>]) &amp;&amp;</div><div class="line">      <span class="keyword">isset</span>($_POST[<span class="string">'year'</span>])     &amp;&amp;</div><div class="line">      <span class="keyword">isset</span>($_POST[<span class="string">'isbn'</span>]))</div><div class="line">  &#123;</div><div class="line">    $author   = get_post($conn, <span class="string">'author'</span>);</div><div class="line">    $title    = get_post($conn, <span class="string">'title'</span>);</div><div class="line">    $category = get_post($conn, <span class="string">'category'</span>);</div><div class="line">    $year     = get_post($conn, <span class="string">'year'</span>);</div><div class="line">    $isbn     = get_post($conn, <span class="string">'isbn'</span>);</div><div class="line">    $query    = <span class="string">"INSERT INTO classics VALUES"</span> .</div><div class="line">      <span class="string">"('$author', '$title', '$category', '$year', '$isbn')"</span>;</div><div class="line">    $result   = $conn-&gt;query($query);</div><div class="line">    <span class="keyword">if</span> (!$result) <span class="keyword">echo</span> <span class="string">"INSERT failed: $query&lt;br&gt;"</span> .</div><div class="line">      $conn-&gt;error . <span class="string">"&lt;br&gt;&lt;br&gt;"</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;_END</span></div><div class="line">  &lt;form action="sqltest.php" method="post"&gt;&lt;pre&gt;</div><div class="line">    Author &lt;input type="text" name="author"&gt;</div><div class="line">     Title &lt;input type="text" name="title"&gt;</div><div class="line">  Category &lt;input type="text" name="category"&gt;</div><div class="line">      Year &lt;input type="text" name="year"&gt;</div><div class="line">      ISBN &lt;input type="text" name="isbn"&gt;</div><div class="line">           &lt;input type="submit" value="ADD RECORD"&gt;</div><div class="line">  &lt;/pre&gt;&lt;/form&gt;</div><div class="line">_END;</div><div class="line"></div><div class="line">  $query  = <span class="string">"SELECT * FROM classics"</span>;</div><div class="line">  $result = $conn-&gt;query($query);</div><div class="line">  <span class="keyword">if</span> (!$result) <span class="keyword">die</span> (<span class="string">"Database access failed: "</span> . $conn-&gt;error);</div><div class="line"></div><div class="line">  $rows = $result-&gt;num_rows;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> ($j = <span class="number">0</span> ; $j &lt; $rows ; ++$j)</div><div class="line">  &#123;</div><div class="line">    $result-&gt;data_seek($j);</div><div class="line">    $row = $result-&gt;fetch_array(MYSQLI_NUM);</div><div class="line"></div><div class="line">    <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;_END</span></div><div class="line">  &lt;pre&gt;</div><div class="line">    Author <span class="subst">$row</span>[0]</div><div class="line">     Title <span class="subst">$row</span>[1]</div><div class="line">  Category <span class="subst">$row</span>[2]</div><div class="line">      Year <span class="subst">$row</span>[3]</div><div class="line">      ISBN <span class="subst">$row</span>[4]</div><div class="line">  &lt;/pre&gt;</div><div class="line">  &lt;form action="sqltest.php" method="post"&gt;</div><div class="line">  &lt;input type="hidden" name="delete" value="yes"&gt;</div><div class="line">  &lt;input type="hidden" name="isbn" value="<span class="subst">$row</span>[4]"&gt;</div><div class="line">  &lt;input type="submit" value="DELETE RECORD"&gt;&lt;/form&gt;</div><div class="line">_END;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $result-&gt;close();</div><div class="line">  $conn-&gt;close();</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">get_post</span><span class="params">($conn, $var)</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">return</span> $conn-&gt;real_escape_string($_POST[$var]);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/php-mysql-query.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>So, back to the <code>get_post</code> function, which passes each item it retrieves through the <code>real_escape_string</code> method of the connection object to strip out any characters that a hacker may have inserted in order to break into or alter your database, like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function get_post($conn, $var)</div><div class="line">&#123;</div><div class="line">  return $conn-&gt;real_escape_string($_POST[$var]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/PHP/2015-05-27-php-mysql.html" target="_blank" rel="external">http://blog.inching.org/PHP/2015-05-27-php-mysql.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&title=《PHP MySQL》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&title=《PHP MySQL》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Cre..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-27-php-mysql.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP MySQL》 — Balance&url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/PHP/2015-05-27-php-form.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">PHP Form</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Database/2015-05-26-database-mysql.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">MySQL Tutorial</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&title=《PHP MySQL》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&title=《PHP MySQL》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Cre..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-27-php-mysql.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP MySQL》 — Balance&url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-27-php-mysql.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLklEQVR42u3aO3LDMAxF0ex/00qbIpTuA+hMBF5WHjuWdVQg+H194XP9OPfvkE/5NTcfGTJkvJZx3Z7V39x/l3zaucIvVBkyZBzAWEUw8pqz76Pl/euHe5YhQ4YMzCCpHn9fhgwZMjqM1k+GZa0MGTJk8CL2HslL1k6KuaEWlyFDxgsZvOv+968/Mt+QIUPGqxhXeHhix2/xah8ZMmTMZvAAxxtqPClMi96Hhp0MGTKGMj7XUOsMLzn4431BGTJk/AMGb8fvDZG8fUYetAwZMk5m8PK1FmrT4Pvw+GTIkDGUUUvC0iWJWsJX3BaRIUPGMYzOcLFYgoJbX15HhgwZBzNSDE8Za0PKZZIqQ4aMAxh8AYIEQf5o0hHpMpTLkCHjGAb/yV0zxE4Ru+wXypAhYxxjb7O+Nlogg4d0OCFDhoxJDB5q0xSwE4J5IY1SQxkyZLycUQuyvBmXJpppeipDhowTGDzVI4ldbQmDf3f5LRkyZIxmpO2tvYsUtTT04T+GDBkyhjLS1C1dntj7OFDTTYYMGUMZtZZW2hrjJTG5ExkyZJzJqBWQfGzABwbxMocMGTKGMq7wpLsNvIjlSWQwT5AhQ8YIRlouppeujTPT4agMGTJOYHRWsviQclcgRl1DGTJkDGXwwJc2+nly2Qn9MmTIkNFJ8sgaBw/WxW0RGTJkHMboF6VphY1GFzJkyDiAURsGkABaS/vSxyFDhozZDP4DtZWLlJdiZMiQMZrxDVwY+gih1wiFAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
