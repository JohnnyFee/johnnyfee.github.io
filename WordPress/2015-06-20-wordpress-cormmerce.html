<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>WordPress Ecormmerce | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,wordpress">
    <meta name="description" content="Choosing a PluginThere are many different plugins that will allow you to accept payments on your site. Each has its strengths and weaknesses. Choosing between the various plugins can be daunting, but">
<meta property="og:type" content="article">
<meta property="og:title" content="WordPress Ecormmerce">
<meta property="og:url" content="http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="Choosing a PluginThere are many different plugins that will allow you to accept payments on your site. Each has its strengths and weaknesses. Choosing between the various plugins can be daunting, but">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-certificate-warning.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-pay.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-ssl.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-ssl-error.jpg">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-paid-membership-activate.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-add-new-membership">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-paid-membership-setting.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-setup.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-set.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-email.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-advance-setting.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-lock.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-billing.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/wordpress-payment-long-form.png">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WordPress Ecormmerce">
<meta name="twitter:description" content="Choosing a PluginThere are many different plugins that will allow you to accept payments on your site. Each has its strengths and weaknesses. Choosing between the various plugins can be daunting, but">
<meta name="twitter:image" content="http://johnnyimages.qiniudn.com/wordpress-certificate-warning.png">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">

    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2846834382442028",
        enable_page_level_ads: true
      });
    </script>

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">WordPress Ecormmerce</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">WordPress Ecormmerce</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-06-19T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2015-06-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WordPress/">WordPress</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Choosing-a-Plugin"><span class="post-toc-text">Choosing a Plugin</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Shopping-Cart-Plugins"><span class="post-toc-text">Shopping Cart Plugins</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Our-favorite-Jigoshop"><span class="post-toc-text">Our favorite: Jigoshop</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Notable-runner-up-WooCommerce"><span class="post-toc-text">Notable runner-up: WooCommerce</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Membership-Plugins"><span class="post-toc-text">Membership Plugins</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Our-favorite-Paid-Memberships-Pro"><span class="post-toc-text">Our favorite: Paid Memberships Pro</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Digital-Downloads"><span class="post-toc-text">Digital Downloads</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Our-favorite-Easy-Digital-Downloads"><span class="post-toc-text">Our favorite: Easy Digital Downloads</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Payment-Gateways"><span class="post-toc-text">Payment Gateways</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Merchant-Accounts"><span class="post-toc-text">Merchant Accounts</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SSL-Certificates-and-HTTPS"><span class="post-toc-text">SSL Certificates and HTTPS</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Installing-an-SSL-Certificate-on-Your-Server"><span class="post-toc-text">Installing an SSL Certificate on Your Server</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SSL-with-Paid-Memberships-Pro"><span class="post-toc-text">SSL with Paid Memberships Pro</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SSL-with-Jigoshop"><span class="post-toc-text">SSL with Jigoshop</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#WordPress-Login-and-WordPress-Admin-over-SSL"><span class="post-toc-text">WordPress Login and WordPress Admin over SSL</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#WordPress-Frontend-over-SSL"><span class="post-toc-text">WordPress Frontend over SSL</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SSL-on-Select-Pages"><span class="post-toc-text">SSL on Select Pages</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Avoiding-SSL-Errors-with-the-“Nuclear-Option”"><span class="post-toc-text">Avoiding SSL Errors with the “Nuclear Option”</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Setting-Up-Software-as-a-Service-SaaS-with-Paid-Memberships-Pro"><span class="post-toc-text">Setting Up Software as a Service (SaaS) with Paid Memberships Pro</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#The-Software-as-a-Service-Model"><span class="post-toc-text">The Software as a Service Model</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-0-Figure-Out-How-You-Want-to-Charge-for-Your-App"><span class="post-toc-text">Step 0: Figure Out How You Want to Charge for Your App</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-1-Installing-and-Activating-Paid-Memberships-Pro"><span class="post-toc-text">Step 1: Installing and Activating Paid Memberships Pro</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-2-Setting-Up-the-Level"><span class="post-toc-text">Step 2: Setting Up the Level</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-3-Setting-Up-Pages"><span class="post-toc-text">Step 3: Setting Up Pages</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-4-Payment-Settings"><span class="post-toc-text">Step 4: Payment Settings</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-5-Email-Settings"><span class="post-toc-text">Step 5: Email Settings</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-6-Advanced-Settings"><span class="post-toc-text">Step 6: Advanced Settings</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-7-Locking-Down-Pages"><span class="post-toc-text">Step 7: Locking Down Pages</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lock-down-a-specific-page"><span class="post-toc-text">Lock down a specific page</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lock-down-a-page-by-URL"><span class="post-toc-text">Lock down a page by URL</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lock-down-a-portion-of-a-page-by-shortcode"><span class="post-toc-text">Lock down a portion of a page by shortcode</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Lock-down-a-portion-of-a-page-by-PHP-code-using-the-pmpro-hasMembershipLevel-function"><span class="post-toc-text">Lock down a portion of a page by PHP code using the pmpro_hasMembershipLevel() function</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-8-Customizing-Paid-Memberships-Pro"><span class="post-toc-text">Step 8: Customizing Paid Memberships Pro</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Restricting-nonmembers-to-the-homepage"><span class="post-toc-text">Restricting nonmembers to the homepage</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Locking-down-files"><span class="post-toc-text">Locking down files</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Change-user-roles-based-on-membership-levels"><span class="post-toc-text">Change user roles based on membership levels</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#International-and-long-form-addresses"><span class="post-toc-text">International and long-form addresses</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Upgrade-downgrade-pricing"><span class="post-toc-text">Upgrade/downgrade pricing</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-wordpress-cormmerce"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">WordPress Ecormmerce</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-06-20 00:00:00" datetime="2015-06-19T16:00:00.000Z"  itemprop="datePublished">2015-06-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/WordPress/">WordPress</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Choosing-a-Plugin"><a href="#Choosing-a-Plugin" class="headerlink" title="Choosing a Plugin"></a>Choosing a Plugin</h2><p>There are many different plugins that will allow you to accept payments on your site. Each has its strengths and weaknesses. Choosing between the various plugins can be daunting, but we’re here to help.</p>
<p>WordPress ecommerce plugins generally fall into two main categories: shopping cart plugins and membership plugins. We’ll also cover a couple of plugins that don’t fall inside these categories exactly.</p>
<a id="more"></a>
<p>All plugins in this section have these features in common:</p>
<ul>
<li>Integration with multiple payment gateways</li>
<li>Secure checkout forms</li>
<li>Saved order information</li>
<li>Products (or membership levels) with pricing</li>
</ul>
<h3 id="Shopping-Cart-Plugins"><a href="#Shopping-Cart-Plugins" class="headerlink" title="Shopping Cart Plugins"></a>Shopping Cart Plugins</h3><p>The plugins we’ll cover in this section focus around offering products for sale on your site.</p>
<p>Features of these plugins include:</p>
<ul>
<li>A products custom post type</li>
<li>The ability to browse products</li>
<li>The ability to search through products</li>
<li>The ability to purchase multiple products at once</li>
<li>Support for shipping addresses and shipping price calculations</li>
<li>Support for custom tax rules</li>
</ul>
<h4 id="Our-favorite-Jigoshop"><a href="#Our-favorite-Jigoshop" class="headerlink" title="Our favorite: Jigoshop"></a>Our favorite: Jigoshop</h4><p>Why: the <a href="http://jigoshop.com" target="_blank" rel="external">Jigoshop ecommerce plugin</a> is released under the GPL license and available in the WordPress plugin repository. Dozens of extensions exist for Jigoshop that do everything from add support for different payment gateways to customize your emails to conform to Norwegian tax rules.</p>
<p>The base plugin, which includes all of the functionality to add products and process orders, is free. Most of the extensions are available for under $50 each, or you can purchase a membership to gain access to all of the extensions sold through the main Jigoshop store.</p>
<p>Jigoshop works well with any WordPress theme you might be using. There are Jigoshop-specific themes, and you can also easily customize the default CSS that Jigoshop provides with the plugin itself.</p>
<p>The code behind Jigoshop includes a lot of hooks and filters you can use to override the default behavior. And the source code for the base Jigoshop plugin is managed on GitHub, making it easy to do a pull request to add your own hooks and filters or to get involved in the development of the plugin. The Jigoshop developers are very responsive with merging in new code that is clean and improves the plugin.</p>
<h4 id="Notable-runner-up-WooCommerce"><a href="#Notable-runner-up-WooCommerce" class="headerlink" title="Notable runner-up: WooCommerce"></a>Notable runner-up: WooCommerce</h4><p><a href="http://woocommerce.com" target="_blank" rel="external">WooCommerce</a>, which was forked from Jigoshop, has improved both the underlying code and the number and quality of extensions. The community is definitely behind WooCommerce in a big way as WooCommerce is quickly eclipsing Jigoshop (and ecommerce platforms in general) in terms of both user and developer adoption.</p>
<p>WooCommerce extensions are pricier than Jigoshop extensions. They run about $50–$200 each, with no membership with access to all extensions. More important for many app developers is the fact that licenses for each individual extension must be maintained to ensure updates. In practice this isn’t so bad, but we worry about the added overhead around using the licensed extensions versus a system like Jigoshop’s where you simply pay for access to GPL code and get it.</p>
<p>Other shopping cart plugins include WP e-Commerce, Shopp Plugin, and Cart 66.</p>
<h3 id="Membership-Plugins"><a href="#Membership-Plugins" class="headerlink" title="Membership Plugins"></a>Membership Plugins</h3><p>Plugins in this section focus around accepting payment for a membership access to a WordPress site or app.</p>
<p>Features of these plugins include:</p>
<ul>
<li>Recurring pricing for subscriptions</li>
<li>Tools for locking down content based on membership level</li>
</ul>
<h4 id="Our-favorite-Paid-Memberships-Pro"><a href="#Our-favorite-Paid-Memberships-Pro" class="headerlink" title="Our favorite: Paid Memberships Pro"></a>Our favorite: Paid Memberships Pro</h4><p>Why: Besides being developed by our coauthor Jason Coleman, <a href="http://www.paidmembershipspro.com" target="_blank" rel="external">Paid Memberships Pro</a> is the only WordPress membership plugin that is 100% GPL and available for free in the WordPress repository. Other plugins have either paid modules or upgraded versions that are necessary to gain access to all of the plugin’s features.</p>
<p>All of the Paid Memberships Pro code is managed on GitHub and open to developer input. Like Jigoshop, there are a lot of hooks and filters available to change the default behavior of the plugin.</p>
<p>Nearly every membership site has a slightly different way of calculating upgrades or special offers, or exactly how and when to lock down content. Instead of offering an extra long settings page, Paid Memberships Pro carefully designed its hooks and filters to make it easy to setup nearly any pricing model with just a few lines of code.</p>
<p>Another key difference between Paid Memberships Pro and some other membership plugins is that Paid Memberships Pro uses its own table to define membership levels and their relationships to users and orders. Some membership plugins use the built-in WordPress user roles so that each membership level is also a user role. User roles are very important in some membership sites (see <a href="ch06.html" title="Chapter 6. Users, Roles, and Capabilities">Chapter 6</a>), but in general, it’s better to separate the concept of a membership level and a user role, allowing you for example to have members who are admins <em>and</em> members who are subscribers. If you <em>do</em> need to assign roles based on membership level, that is easy to do with Paid Memberships Pro, and we have an example later in this chapter.</p>
<p>Other membership plugins include s2Members, Restrict Content Pro, Members, WPMU Membership, and MemberPress.</p>
<h3 id="Digital-Downloads"><a href="#Digital-Downloads" class="headerlink" title="Digital Downloads"></a>Digital Downloads</h3><h4 id="Our-favorite-Easy-Digital-Downloads"><a href="#Our-favorite-Easy-Digital-Downloads" class="headerlink" title="Our favorite: Easy Digital Downloads"></a>Our favorite: Easy Digital Downloads</h4><p>All of the ecommerce and membership plugins mentioned so far can be used for digital products and downloads as well as physical goods. However, if you are only planning on selling digital goods, you should consider <a href="http://easydigitaldownloads.com" target="_blank" rel="external">Easy Digital Downloads</a>, which was developed specifically for this use case.</p>
<p>Like Jigoshop, the core Easy Digital Downloads plugin is available for free in the WordPress repository, while extensions are available for purchase at the plugin’s website. Extension prices range from $6–$83. There is a core extensions bundle that includes many of the most popular extensions at a reduced price.</p>
<p>Notable extensions that could be useful to app developers include the Software Licensing and Product Support add-ons. The core plugin and all of the extensions are well coded and well supported.</p>
<h2 id="Payment-Gateways"><a href="#Payment-Gateways" class="headerlink" title="Payment Gateways"></a>Payment Gateways</h2><p>A payment gateway is a service that processes and sometime stores customer credit cards and makes sure that the money winds up in your bank account.<sup>[</sup>26]<br>Popular gateways in the United States include Stripe, PayPal, Authorize.net, and Braintree Payments. There are dozens of gateways, many specializing in particular parts of the world or in particular markets.</p>
<p>These are the important things to look out for when choosing a gateway:</p>
<ul>
<li>Does the gateway support the country and currency you do business in?</li>
<li>Does the gateway integrate with the plugin you are using for ecommerce?</li>
<li>Does the gateway work with the type of business you are in? Some gateways will not work with adult sites, gambling sites, or other “high-risk merchants.”</li>
<li>Does the gateway offer the features you need like recurring billing or stored credit cards?</li>
<li>How does the gateway handle Payment Card Industry (PCI) compliance?<sup>[</sup>27]</li>
<li>Will the gateway work with my merchant account? (See the merchant account section below.)</li>
<li>Finally, what are the fees? 1% of $10 million is a lot of money, and it is worth fighting for lower fees. However, in general, the fees are fairly standard across gateways, and you should first look for a gateway that will work with your business setup. As your business grows in revenue and volume, it becomes very easy to negotiate lowering your fees to the standard minimums in your industry.</li>
</ul>
<h2 id="Merchant-Accounts"><a href="#Merchant-Accounts" class="headerlink" title="Merchant Accounts"></a>Merchant Accounts</h2><p>Merchant accounts are often confused with payment gateways, but are actually a separate thing you need to process payments on your website. Part of the confusion comes from the fact that some gateways use their own merchant accounts.</p>
<p>In any case, both a payment gateway and merchant account are required to make money online, and both kinds of providers will help you secure the other service. That is, you can shop for a payment gateway and have it help you find a merchant account, or you can shop for a merchant account and have it help you find a payment gateway. We find that younger companies typically get better fees when they start with a payment gateway and get a merchant account with their help, rather than going to their bank to open a merchant account.</p>
<p>Here is how the credit card information and money flows from a customer on your website into your checking account: WordPress → Ecommerce Plugin → Payment Gateway → Merchant Account → Your Checking Account.</p>
<p>One way to think of the difference between gateways and merchant accounts is that the payment gateway is largely technology related, and the merchant account is largely business related.</p>
<p>The payment gateway provides the technology to validate and charge a credit card and setup recurring payments, and some can store customer information for later billing.</p>
<p>The merchant account is a kind of bank account that stores incoming money until it can be moved to your bank account. Why not just put the money directly into your bank account? The delay is kind of like waiting for a check to clear. If for some reason the credit card company needs to request the money back, because of an error or a customer request, it can pull it out of your merchant account.</p>
<p>These are the important things to look out for when choosing a merchant account:</p>
<ul>
<li>Will my gateway work with this merchant account?</li>
<li>Will this merchant account underwrite my type of business? Some merchant accounts will not work with adult sites, gambling sites, or other “high-risk merchants.”</li>
<li>Will this merchant account underwrite my size of business? Some merchant accounts will not approve new businesses that sell high-priced (thousands of dollars) goods.</li>
<li>Finally, what are the fees? Sometimes these fees are bundled into the payment gateway fees, and sometimes they are separate.</li>
</ul>
<p>The best route to accepting credit cards online is usually to choose a plugin first, then choose a payment gateway that works with that plugin, and then work with the gateway to find a merchant account.</p>
<h2 id="SSL-Certificates-and-HTTPS"><a href="#SSL-Certificates-and-HTTPS" class="headerlink" title="SSL Certificates and HTTPS"></a>SSL Certificates and HTTPS</h2><p>When accepting sensitive information through a web form, for example, a credit card number, you should encrypt that information by loading and submitting the form over SSL or HTTPS.</p>
<p>First some definitions:<br><em>SSL</em> stands for “Secure Sockets Layer” and is the technology that encrypts data that is transferred to and from a web page.<br><em>HTTP</em> stands for “Hypertext Transfer Protocol.” This is the standard <em>protocol</em> for serving web pages without encryption.<br><em>HTTPS</em> stands for “HTTP Secure.” This is the protocol for serving web pages with SSL encryption.</p>
<h3 id="Installing-an-SSL-Certificate-on-Your-Server"><a href="#Installing-an-SSL-Certificate-on-Your-Server" class="headerlink" title="Installing an SSL Certificate on Your Server"></a>Installing an SSL Certificate on Your Server</h3><p>First make sure that you have SSL enabled on your web server. How to do that will depend on your specific host and web server. O’Reilly’s ONLamp has great <a href="http://bit.ly/config-ssl-apache" target="_blank" rel="external">instructions for setting up SSL on a server running Apache</a>.</p>
<p>When setting up SSL, you’ll need an SSL certificate. You can use self-signed certificates for testing purposes, but modern-day browsers will show some fairly dire warnings when browsing to a site using a self-signed certificate. <a href="ch15.html#Chrome_SSL_warning" title="Figure 15-1. Chrome SSL warning">Figure 15-1</a> shows the warning shown to Chrome users.</p>
<p>For production environments, you’ll want to use a public key certificate from a certificate authority or CA. Public key certificates must be purchased, and are usually bundled or offered as an add-on to your web hosting package. You can also use public key certificates (SSL certificates) purchased from third parties; visit <a href="http://bwawwp.com/ssl/" target="_blank" rel="external">this book’s website</a> for a list of vendors we like. A good CA certificate will be trusted by all modern web browsers, which is what gives you the green or golden padlock icon on your website instead of a broken or red padlock.</p>
<p>What you’re really doing is paying for the confirmation that you really own the domain you are using the certificate on. Ownership of the domain is usually confirmed via email to an address on the domain.</p>
<p>Internet consumers are trained to look for that padlock (see <a href="ch15.html#padlocks" title="Figure 15-2. Various padlocks across browsers">Figure 15-2</a>). Both savvy and nonsavvy users will feel better seeing it. So even if you aren’t accepting credit card information directly on your page (e.g., if you are sending users to PayPal to pay), it’s still a good idea to purchase a CA certificate and serve your checkout page over SSL.</p>
<p>Besides using a CA certificate, the other thing to do when setting up SSL is to have your HTTPS directory point to your HTTP directory through a symbolic link, or symlink for short. A symlink is like a shortcut in a Windows PC. The symlink points to another directory rather than being a directory of its own.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-certificate-warning.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>The end result of using a symlink for your HTTPS directory is that the same <em>.php</em> source files will be loaded when people visit <em><a href="https://yoursite.com" target="_blank" rel="external">https://yoursite.com</a></em> as when they visit <em><a href="http://yoursite.com" target="_blank" rel="external">http://yoursite.com</a></em>. Your server will make sure that the traffic through the HTTPS link is encrypted and both WordPress and your ecommerce plugin will make sure that the correct secure page is shown to the user when being served over SSL.</p>
<p>Assuming your HTTP directory is called “html” and you want your HTTPS directory to be called “ssl_html,” you would issue the following Linux command to create a symlink to that directory: <code>ln -s http ssl_http</code>.</p>
<p>Next you’ll need to tell your ecommerce plugin to use SSL on your checkout page.</p>
<h3 id="SSL-with-Paid-Memberships-Pro"><a href="#SSL-with-Paid-Memberships-Pro" class="headerlink" title="SSL with Paid Memberships Pro"></a>SSL with Paid Memberships Pro</h3><p>The next image shows the Payment Settings tab of the Membership settings in your WordPress dashboard.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-pay.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>To get Paid Memberships Pro to serve your checkout page over SSL, set the Force SSL option to Yes. Depending on which payment gateway you are using, this option will either be forced to Yes or will give you the option to choose Yes or No. Set to Yes and click the Save Settings button.</p>
<p>When this setting is enabled, a user browsing to the HTTP version of the page will be redirected to the HTTPS version of the page. Conversely, users browsing to an HTTPS version of a noncheckout page will be redirected to the HTTP version.</p>
<h3 id="SSL-with-Jigoshop"><a href="#SSL-with-Jigoshop" class="headerlink" title="SSL with Jigoshop"></a>SSL with Jigoshop</h3><p>To get Jigoshop to serve your checkout page over HTTPS, go to Jigoshop → Settings in your WordPress dashboard, click the General tab, then check the “Force SSL on checkout” option and click the Save General Changes button.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-ssl.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>Other ecommerce plugins will have similar settings.</p>
<h3 id="WordPress-Login-and-WordPress-Admin-over-SSL"><a href="#WordPress-Login-and-WordPress-Admin-over-SSL" class="headerlink" title="WordPress Login and WordPress Admin over SSL"></a>WordPress Login and WordPress Admin over SSL</h3><p>Serving your checkout page over SSL is the minimum you can do to secure the private data passed to and from your site. You can also set up WordPress to use SSL on the login page, in the admin dashboard, across the entire site, or only on select pages.</p>
<p>SSL logins in WordPress are done by setting the <code>FORCE_SSL_LOGIN</code> constant to <code>true</code> in your <em>wp-config.php</em> file. Place the following line of code above the “That’s all, stop editing! Happy blogging.” comment at the end of the file:</p>
<pre><code>define(&apos;FORCE_SSL_LOGIN&apos;, true);
</code></pre><p>To use SSL on the login page <em>and</em> in the admin dashboard, use the following <code>FORCE_SSL_ADMIN</code> constant instead:</p>
<pre><code>define(&apos;FORCE_SSL_ADMIN&apos;, true);
</code></pre><p>The <code>FORCE_SSL_ADMIN</code> constant supersedes the <code>FORCE_SSL_LOGIN</code> constant. You should only set one or the other constant to <code>true</code>. If <code>FORCE_SSL_LOGIN</code> is <code>false</code> and <code>FORCE_SSL_ADMIN</code> is <code>true</code>, your login page will still be served over SSL.</p>
<h3 id="WordPress-Frontend-over-SSL"><a href="#WordPress-Frontend-over-SSL" class="headerlink" title="WordPress Frontend over SSL"></a>WordPress Frontend over SSL</h3><p>You might think, “Why not serve my entire site over SSL?” The reason not to is that the SSL encryption adds a small bit of CPU computation and a few microseconds to each page load. This may not matter, but on larger sites at scale, it could add up.</p>
<p>There are occasions when you may need to use SSL across the entire frontend and backend of your site. Maybe you don’t mind the extra bit of CPU use and just want to set your members at ease. Maybe you have secure forms and information on many pages in your frontend. In these cases, you can set the <code>FORCE_SSL_ADMIN</code> constant to <code>true</code> in your <em>wp-config.php</em> file and then include this plugin:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">/*</div><div class="line">Plugin Name: Always HTTPS</div><div class="line">Plugin URI: http://www.strangerstudios.com/wp/always-https</div><div class="line">Description: Redirect all URLs to the HTTPS version.</div><div class="line">Version: .1</div><div class="line">Author: strangerstudios</div><div class="line">*/</div><div class="line"></div><div class="line">/*</div><div class="line">    Make sure to set FORCE_SSL_ADMIN to true.</div><div class="line">        Add the following to your wp-config.php:</div><div class="line"></div><div class="line">define(&apos;FORCE_SSL_ADMIN&apos;, true);</div><div class="line">*/</div><div class="line"></div><div class="line">//redirect to https</div><div class="line">function always_https_redirect()</div><div class="line">&#123;</div><div class="line">        //if FORCE_SSL_ADMIN is true and we&apos;re not over HTTPS</div><div class="line">        if(force_ssl_admin() &amp;&amp; !is_ssl())</div><div class="line">        &#123;</div><div class="line">                //redirect to https version of the page</div><div class="line">                wp_redirect(&quot;https://&quot; . $_SERVER[&apos;HTTP_HOST&apos;] .</div><div class="line">            $_SERVER[&apos;REQUEST_URI&apos;]);</div><div class="line">                exit;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(&apos;wp&apos;, &apos;always_https_redirect&apos;, 2);</div><div class="line"></div><div class="line">//(optional) Tell Paid Memberships Pro to get on board with the HTTPS redirect.</div><div class="line">add_filter(&quot;pmpro_besecure&quot;, &quot;__return_true&quot;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p><code>`If</code>FORCE_SSL_ADMIN` is on, but the current page is not already being served over HTTPS, the user is redirected to the HTTPS version of the page.</p>
<p>This code can cause an infinite redirect loop in a few situations. Sometimes plugins, like Paid Memberships Pro, will have their own idea on which pages should and shouldn’t be served over HTTPS. In the preceding code, we use a filter in Paid Memberships Pro to tell it that all pages should be served over HTTPS. Other plugins should have similar filters.</p>
<p>Another situation that comes up is that certain server setups, particularly those that are using a proxy like the Varnish caching system (covered in <a href="ch16.html" title="Chapter 16. WordPress Optimization and Scaling">Chapter 16</a>), will fail to properly set the <code>$_SERVER[&#39;HTTPS&#39;]</code> global, which the <code>is_ssl()</code> function checks to see if the current page is being served over HTTPS. These conflicts are harder to handle. Sometimes, you can update your <em>wp-config.php</em> to set the <code>$_SERVER[&#39;HTTPS&#39;]</code> global based on some other global being set by the proxy. Or you can adjust the check in the Always HTTPS plugin to check for the particular values set by your proxy.</p>
<p>We’re going to go through two more techniques, which we’ve bundled into the Paid Memberships Pro plugin. We’ll show you how to use these features in Paid Memberships Pro and also how to set them up yourself if you aren’t using the Paid Memberships Pro plugin.</p>
<h3 id="SSL-on-Select-Pages"><a href="#SSL-on-Select-Pages" class="headerlink" title="SSL on Select Pages"></a>SSL on Select Pages</h3><p>Sometimes you will want to serve only certain pages over SSL. Paid Memberships Pro does this, where by default only the checkout page is served over SSL, and all other pages are served over regular HTTP.</p>
<p>If you’re using the Paid Memberships Pro plugin, and there are other pages you’d like to serve over SSL, you can add a custom field to the post, page, or CPT called “besecure” and set the value to “1” or “true.” Paid Memberships Pro will then make sure that the page is served over SSL.</p>
<p>Let’s see how Paid Memberships Pro does this so you can understand what’s going on and potentially use the same method for your site that isn’t running the Paid Memberships Pro plugin.</p>
<p>The code in this section is similar to the code found in the Paid Memberships Pro plugin, but is slightly altered for clarity.</p>
<p>To serve certain pages over SSL, we’ll need a few things:</p>
<ul>
<li>A way to detect if the user is on the login page, so we can respect the <code>FORCE_SSL_LOGIN</code> or <code>FORCE_SSL_ADMIN</code> constants</li>
<li>A way to set which pages should be served over SSL and a function to redirect pages to either the HTTP or HTTPS version of a page depending on that setting</li>
<li>A way to filter URLs used on a page to use the correct protocol (HTTP or HTTPS)</li>
</ul>
<p>First up, our function to detect if the user is on the login page. This function checks if we’re on the <em>/wp-login.php</em> or <em>/wp-register.php</em> pages or if the current page has the slug “login”:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function my_is_login_page()</div><div class="line">&#123;</div><div class="line">    return (in_array(</div><div class="line">                $GLOBALS[&apos;pagenow&apos;], array(&apos;wp-login.php&apos;, &apos;wp-register.php&apos;)) ||</div><div class="line">                is_page(&quot;login&quot;)</div><div class="line">        );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>WordPress sets the <code>pagenow</code> global to the filename of the PHP script loaded. Typically this is <em>index.php</em>, but the login page will be accessed via <em>wp-login.php</em>.</p>
<p>Fresh installs of WordPress will not have a <em>wp-register.php</em> file, but we’re still checking for it here. WordPress sites set up before version 3.4 included a <em>wp-register.php</em> file. A redirect from <em>wp-register.php</em> to the actual registration page at <em>wp-login.php?action=register</em> was added in WP 3.4, but the old <em>wp-register.php</em> file wasn’t deleted if you upgraded. Since it doesn’t hurt anything, we can check for <em>wp-register.php</em> too just in case the WordPress site includes it.</p>
<p>The <code>is_page()</code> function can take a post ID or slug as a parameter and will return <code>true</code> if the current page has that ID or slug. If you use a plugin like Theme My Login or a similar method to place your login page within your theme on the frontend, you’ll have a WordPress page for your login page. Tweak the code to check for whatever you set the slug to on your login page.</p>
<p>Next up is a function to redirect the user to the correct version of a page (HTTP or HTTPS), depending on if the page is set to be served over SSL or not:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">function my_besecure()</div><div class="line">&#123;</div><div class="line">    global $besecure, $post;</div><div class="line"></div><div class="line"> //check the post meta for a besecure custom field</div><div class="line"> if(!empty($post-&gt;ID) &amp;&amp; !$besecure)</div><div class="line">        $besecure = get_post_meta($post-&gt;ID, &quot;besecure&quot;, true);</div><div class="line"></div><div class="line"> //if forcing ssl on admin, be secure in admin and login page</div><div class="line"> if(!$besecure &amp;&amp; force_ssl_admin() &amp;&amp; (is_admin() || my_is_login_page()))</div><div class="line">        $besecure = true;</div><div class="line"></div><div class="line"> //if forcing ssl on login, be secure on the login page</div><div class="line"> if(!$besecure &amp;&amp; force_ssl_login() &amp;&amp; my_is_login_page())</div><div class="line">        $besecure = true;</div><div class="line"></div><div class="line"> //a hook so we can filter this setting if need be</div><div class="line"> $besecure = apply_filters(&quot;my_besecure&quot;, $besecure);</div><div class="line"></div><div class="line"> if($besecure &amp;&amp; (!is_ssl())</div><div class="line"> &#123;</div><div class="line">   //need to be secure</div><div class="line">   wp_redirect(&quot;https://&quot; . $_SERVER[&apos;HTTP_HOST&apos;] . $_SERVER[&apos;REQUEST_URI&apos;]);</div><div class="line">     exit;</div><div class="line">   &#125;</div><div class="line">   elseif(!$besecure &amp;&amp; is_ssl())</div><div class="line">   &#123;</div><div class="line">   //don&apos;t need to be secure</div><div class="line">   wp_redirect(&quot;http://&quot; . $_SERVER[&apos;HTTP_HOST&apos;] . $_SERVER[&apos;REQUEST_URI&apos;]);</div><div class="line">          exit;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line">add_action(&apos;wp&apos;, &apos;my_besecure&apos;, 2);</div><div class="line">add_action(&apos;login_init&apos;, &apos;my_besecure&apos;, 2);</div></pre></td></tr></table></figure>
<p>Stepping through the preceding code, first we check for a “besecure” custom field in the current post’s post meta. If this custom field is set, we’ll want to serve over SSL.</p>
<p>Then we check if we’re on the login page and if either the <code>FORCE_SSL_LOGIN</code> or <code>FORCE_SSL_ADMIN</code> constant is set to <code>true</code>. If so, we’ll want to serve over SSL.</p>
<p>We add a hook in there to allow other code throughout our application to override the <code>$besecure</code> variable at this point.</p>
<p>Then we figure out if we need to redirect. We’re using WP’s built-in <code>is_ssl()</code> function, which will return <code>true</code> if <code>$_SERVER[&#39;HTTPS&#39;]</code> is turned on or if <code>$_SERVER[&#39;SERVER_PORT&#39;]</code> is set to 443 (the typical port number for SSL).</p>
<p>As explained above, some server setups with proxies may not properly set the $_SERVER globals. You can add a check to your wp-config.php for the value they do set and set $_SERVER[‘HTTPS’] to true if you are over HTTPS.</p>
<p>If <code>$besecure</code> is <code>true</code>, but we’re not serving over SSL, we redirect the browser to the HTTPS version of the page.</p>
<p>Similarly, if <code>$besecure</code> is <code>false</code>, but we <em>are</em> serving over HTTPS, we redirect the browser to the HTTP version of the page.</p>
<p>We’re rebuilding the current URL by appending the appropriate protocol to the <code>$_SERVER[&#39;HTTP_HOST&#39;]</code> and <code>$_SERVER[&#39;REQUEST_URI&#39;]</code> globals set up by PHP.</p>
<p>The two lines at the bottom of the previous code block set up this function to fire during the <code>wp</code> and <code>login_init</code> events in WordPress. The <code>wp</code> hook is activated on the frontend of WordPress after loading the theme, but before generating any output. The <code>login_init</code> hook is found in the <em>wp-login.php</em> file. We’re setting the priority to 2 here so this will fire before any actions set up using the default priority (10), but after any action that may be set up with a priority 1 or lower. You may need to tweak this depending on the other plugins and custom code you are running using these hooks.</p>
<p>Finally, we’re going to write a quick little function to filter URLs generated by WordPress to use the same protocol as the current page. Remember earlier we talked about how URLs like <em><a href="http://yoursite.com/some-page/" target="_blank" rel="external">http://yoursite.com/some-page/</a></em> (HTTP) that show up on a page like <em><a href="https://yoursite.com/checkout/" target="_blank" rel="external">https://yoursite.com/checkout/</a></em> (HTTPS) will cause your browser to show a security warning:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">function my_https_filter($s)</div><div class="line">&#123;</div><div class="line">    global $besecure;</div><div class="line">        if($besecure)</div><div class="line">                return str_replace(&quot;http:&quot;, &quot;https:&quot;, $s);</div><div class="line">        else</div><div class="line">                return str_replace(&quot;https:&quot;, &quot;http:&quot;, $s);</div><div class="line">&#125;</div><div class="line">add_filter(&apos;bloginfo_url&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;wp_list_pages&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;option_home&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;option_siteurl&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;logout_url&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;login_url&apos;, &apos;my_https_filter&apos;);</div><div class="line">add_filter(&apos;home_url&apos;, &apos;my_https_filter&apos;);</div></pre></td></tr></table></figure>
<p>Since we saved <code>$besecure</code> to a global variable in the <code>my_besecure()</code> function, we don’t need to recalculate it. Then we use the <code>str_replace</code> function to swap “http:” for “https:” or vice versa. We set this filter to run on a number of built in WordPress hooks used at various places throughout the WordPress code base where URLs are generated.</p>
<p>When you output URLs in other places of your custom application code, be sure to use the <code>home_url()</code> function to make sure the URL is generated correctly and the <code>my_https_filter</code> is run on it.</p>
<h3 id="Avoiding-SSL-Errors-with-the-“Nuclear-Option”"><a href="#Avoiding-SSL-Errors-with-the-“Nuclear-Option”" class="headerlink" title="Avoiding SSL Errors with the “Nuclear Option”"></a>Avoiding SSL Errors with the “Nuclear Option”</h3><p>The <code>my_https_filter</code> function will make sure links that show up on a page use the correct protocol. However, sometimes raw <em>http://…</em> URLs may be hardcoded into your posts, or maybe a plugin you use doesn’t use the built-in WordPress functions like it should when outputting same site URLs or loading JavaScript or CSS files. <a href="ch15.html#SSL_error_Chrome_Developer_Tools_Console" title="Figure 15-5. An SSL error in the Chrome Developer Tools Console. Use the Chrome Developer Tools Console to find SSL errors, or use the Nuclear Option to avoid them.">Figure 15-5</a> shows the Chrome Developer Tools Console, which can help locate errors.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-ssl-error.jpg" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>In these cases, you can try to find each case of a bad URL and fix the link in your posts or code to use a relative URL or the proper WordPress function to make sure it will output on the frontend using the proper protocol. However, it’s sometimes easier to use what we call the Nuclear Option:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">constant(&apos;MY_SITE_DOMAIN&apos;, &apos;yoursite.com&apos;);</div><div class="line"></div><div class="line">function my_NuclearHTTPS()</div><div class="line">&#123;</div><div class="line">        ob_start(&quot;my_replaceURLsInBuffer&quot;);</div><div class="line">&#125;</div><div class="line">add_action(&quot;init&quot;, &quot;my_NuclearHTTPS&quot;);</div><div class="line"></div><div class="line">function my_replaceURLsInBuffer($buffer)</div><div class="line">&#123;</div><div class="line">    global $besecure;</div><div class="line"></div><div class="line">        //only swap URLs if this page is secure</div><div class="line">        if($besecure)</div><div class="line">        &#123;</div><div class="line">/*</div><div class="line">okay swap out all links like these:</div><div class="line">* http://yoursite.com</div><div class="line">* http://anysubdomain.yoursite.com</div><div class="line">* http://any.number.of.sub.domains.yoursite.com</div><div class="line">*/</div><div class="line">$buffer = preg_replace(</div><div class="line">      &apos;/http\:\/\/([a-zA-Z0-9\.\-]*&apos;.str_replace(&apos;.&apos;,&apos;\.&apos;,MY_SITE_DOMAIN).&apos;)/i&apos;,</div><div class="line">      &apos;https://$1&apos;,</div><div class="line">$buffer</div><div class="line">      );</div><div class="line">          &#125;</div><div class="line"></div><div class="line">        return $buffer;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>First we need to make sure we define a constant <code>MY_SITE_DOMAIN</code> and set it to the second-level domain (SLD) for your site. Your <code>site_url()</code> set in WordPress may be <em>www.yoursite.com</em>, but we are interested here in just the <em>yoursite.com</em> part of that.</p>
<p>Then <code>my_NuclearHTTPS()</code> fires on the <code>init</code> hook and uses the PHP function <code>ob_start()</code> to turn on output buffering. Output buffering means that all output generated by PHP (e.g., via echo function calls or inline HTML) goes into a buffer string instead of straight to the browser. Then, when PHP is finished generating all output (or if you call the <code>ob_end_flush()</code> function first), the buffer string is passed to a callback function, which is <code>my_replaceURLsInBuffer()</code> in this case.</p>
<p>The <code>my_replaceURLsInBuffer()</code> function filters the buffer string, swapping out “http:” for “https:” on <em>every</em> link. The regular expression magic we’re doing in the <code>preg_replace()</code> call there makes sure that links to any subdomain using the same domain (why we needed to set the <code>MY_SITE_DOMAIN</code> constant) will also be filtered.</p>
<p>So you might have caught on by now why we call this the “Nuclear Option.” Instead of finding the source of bad URLs in your app and fixing them, we just fix all of the URLs at once before sending the output to the browser. There will be a small performance hit here, depending on how large your HTML output is. But this method can be useful in a pinch, especially if you are using many third-party plugins that you can’t or don’t want to fix to output site URLs properly.</p>
<h2 id="Setting-Up-Software-as-a-Service-SaaS-with-Paid-Memberships-Pro"><a href="#Setting-Up-Software-as-a-Service-SaaS-with-Paid-Memberships-Pro" class="headerlink" title="Setting Up Software as a Service (SaaS) with Paid Memberships Pro"></a>Setting Up Software as a Service (SaaS) with Paid Memberships Pro</h2><p>The model of charging for access to a web app is called software as a service, or SaaS (pronounced “sass”) for short.</p>
<p>In this section, we will go through setting up Paid Memberships Pro on our SchoolPress app, with a $10/month membership.</p>
<h2 id="The-Software-as-a-Service-Model"><a href="#The-Software-as-a-Service-Model" class="headerlink" title="The Software as a Service Model"></a>The Software as a Service Model</h2><p>The software as a service model (of SaaS) basically means that instead of purchasing your software in a shrink-wrapped box and installing it on your computer, you pay—typically a monthly or annual fee—for access to a cloud-enabled web app.</p>
<p>Examples of companies using the SaaS model are GitHub, Dropbox, Evernote, and Google Apps, and now even Microsoft Office can be purchased under a SaaS plan.</p>
<p>SaaS is popular because it generates relatively predictable recurring revenue. But SaaS is also an important way to make money off of open source software like WordPress. Because WordPress is GPL, if you were to sell and distribute the code for your software, your customers would be entitled under the GPL to redistribute that code…potentially for free. So using the SaaS service model allows your customers to use your software without having to distribute your source code to them.</p>
<p>The following instructions will help you if you want to charge a one-time, monthly, or annual fee for access to your app.</p>
<h3 id="Step-0-Figure-Out-How-You-Want-to-Charge-for-Your-App"><a href="#Step-0-Figure-Out-How-You-Want-to-Charge-for-Your-App" class="headerlink" title="Step 0: Figure Out How You Want to Charge for Your App"></a>Step 0: Figure Out How You Want to Charge for Your App</h3><p>Is it a lifetime fee, or a monthly subscription? Is it an annual subscription? Does the subscription automatically bill every year, or does the customer have to renew?</p>
<p>These are questions you will want to answer as best as you can before you start integrating Paid Memberships Pro or coding up customizations. Jason has a good series for <a href="http://bit.ly/pmp-pricing" target="_blank" rel="external">how to price your web apps and premium content sites</a>.</p>
<p>For our SchoolPress app, we will be charging each school account a $1,000 annual fee. When a school signs up, we will create a WordPress network site for it (e.g., <em>myschool.schoolpress.com</em>) and give it admin access to that site so it can start adding teachers and other content.</p>
<p>We will set the membership level to automatically bill the schools each year.</p>
<h3 id="Step-1-Installing-and-Activating-Paid-Memberships-Pro"><a href="#Step-1-Installing-and-Activating-Paid-Memberships-Pro" class="headerlink" title="Step 1: Installing and Activating Paid Memberships Pro"></a>Step 1: Installing and Activating Paid Memberships Pro</h3><p>Paid Memberships Pro is available in the WordPress plugin repository, which makes installing and activating the plugin a breeze</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-paid-membership-activate.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<ol>
<li>From your WordPress dashboard, go to Plugins → Add New.</li>
<li>Search for Paid Memberships Pro.</li>
<li>Find Paid Memberships Pro and click the Install link.</li>
<li>Optionally enter your FTP information here. (Some hosting setups will not require this.)</li>
<li>When the plugin installs successfully, click the Activate link.</li>
</ol>
<h3 id="Step-2-Setting-Up-the-Level"><a href="#Step-2-Setting-Up-the-Level" class="headerlink" title="Step 2: Setting Up the Level"></a>Step 2: Setting Up the Level</h3><ol>
<li>From your WordPress dashboard, go to the newly created Memberships page.</li>
<li>Click the “Add new level” link or button.</li>
<li><p>Enter the membership information in the boxes, as shown in <a href="ch15.html#NewLevel1" title="Figure 15-7. Paid Memberships Pro New Level screen">Figure 15-7</a>. For our level, that will be:</p>
<ol>
<li>Name:</li>
<li>Description: School administrators should sign up here to create and gain access to your SchoolPress site.</li>
<li>Confirmation Message: (can leave it blank)</li>
<li>Initial Payment: 1000</li>
<li><p>Recurring Subscription: Checked</p>
<ol>
<li>Billing Amount: 1000</li>
<li>Per: 1</li>
<li>Days/Weeks/Years: Years</li>
<li>Billing Cycle Limit: 0</li>
<li>Custom Trial: Unchecked</li>
</ol>
</li>
<li><p>Disable New Signups: Unchecked</p>
</li>
<li>Membership Expiration: Unchecked</li>
<li>Categories: All Unchecked</li>
</ol>
</li>
<li><p>Click Save Level.</p>
<p><img src="http://johnnyimages.qiniudn.com/wordpress-add-new-membership" alt=""></p>
</li>
</ol>
<h3 id="Step-3-Setting-Up-Pages"><a href="#Step-3-Setting-Up-Pages" class="headerlink" title="Step 3: Setting Up Pages"></a>Step 3: Setting Up Pages</h3><p>Paid Memberships Pro needs several pages to facilitate checkout and other member-related functions. When you click on the “Page” tab of the PMPro settings, you will see a form like the one</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-paid-membership-setting.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>If you already have pages dedicated to describing your levels or for a user account, you can choose those pages through the dropdowns on the Pages tab of the Paid Memberships Pro settings. In most cases though, you will just want to click the “click here to let us generate them for you” link and pages will be created for the Account, Billing Information, Cancel, Checkout, Confirmation, Invoice, and Levels pages. </p>
<p><img src="http://johnnyimages.qiniudn.com/wordpress-payment-setup.png" alt=""></p>
<h3 id="Step-4-Payment-Settings"><a href="#Step-4-Payment-Settings" class="headerlink" title="Step 4: Payment Settings"></a>Step 4: Payment Settings</h3><p>The next image shows the Payment Gateway &amp; SSL tab of the PMPro settings. Here you will choose your gateway and then fill out of corresponding user and/or API values. Depending on which gateway option you choose, this page will also allow you to change the currency used, which credit cards are available, whether to use SSL or not (remember you should always install SSL unless it is a test site), and whether to use the Nuclear Option for SSL or not.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-payment-set.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>The payment settings page will also give you a place to paste in your SSL Seal Code and enter a tax state and percentage. The tax calculation can also be done programmatically through the <code>pmpro_tax</code> filter (described below).</p>
<p>The payment settings page will also show you the URL you should share with your gateway to enable behind-the-scenes communication from the gateway to your site. This function has various names depending on the gateway: PayPal calls it an “IPN handler”; Authorize.net calls it a “silent post URL”; and Stripe and Braintree will call it a “webhook.”</p>
<h3 id="Step-5-Email-Settings"><a href="#Step-5-Email-Settings" class="headerlink" title="Step 5: Email Settings"></a>Step 5: Email Settings</h3><p>By default, WordPress will send emails from your site from “WordPress” at <em>wordpress@yoursite.com</em>. This doesn’t look nice and is often not a real email address. The Email tab of the Paid Memberships Pro settings, shown below in <a href="ch15.html#email_settings" title="Figure 15-11. Paid Memberships Pro email settings">Figure 15-11</a>, allows you to override these values and also check or uncheck which membership-related admin emails you would like to receive.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-payment-email.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="Step-6-Advanced-Settings"><a href="#Step-6-Advanced-Settings" class="headerlink" title="Step 6: Advanced Settings"></a>Step 6: Advanced Settings</h3><p>The next image shows the Advanced Settings tab, which has a few built-in options for running Paid Memberships Pro. Of particular interest may be the option to choose a Terms of Service page to show users on sign up. They will see a scrollable text box with the TOS page content shown within it and will have to check a box to agree to the Terms of Service.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-advance-setting.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h3 id="Step-7-Locking-Down-Pages"><a href="#Step-7-Locking-Down-Pages" class="headerlink" title="Step 7: Locking Down Pages"></a>Step 7: Locking Down Pages</h3><p>Besides generating a checkout page and integrating with your payment gateway, the main functionality added by Paid Memberships Pro is the ability to lock down certain pages or portions of pages based on a user’s membership level. There are a few different ways to do this.</p>
<h4 id="Lock-down-a-specific-page"><a href="#Lock-down-a-specific-page" class="headerlink" title="Lock down a specific page"></a>Lock down a specific page</h4><p>Paid Memberships Pro adds a Require Membership box to the sidebar of the edit post and edit page pages in the WordPress dashboard. An example of the Require Membership box is shown in the next image. Check which levels are required to view this page”). To lock down a page for a certain membership level, check the box next to that level.</p>
<p>If more than one level is checked, members of <em>either</em> level will be able to view that page. If no levels are checked, anyone (including nonusers) will be able to view that page.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-payment-lock.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h4 id="Lock-down-a-page-by-URL"><a href="#Lock-down-a-page-by-URL" class="headerlink" title="Lock down a page by URL"></a>Lock down a page by URL</h4><p>Sometimes it may be easier to restrict access to a page or group of pages by checking the page’s URL. For example, to keep nonmembers out of certain BuddyPress groups, you could add the following code to a custom plugin:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//lock down our members group</div><div class="line">function my_buddy_press_members_group()</div><div class="line">&#123;</div><div class="line">    $uri = $_SERVER[&apos;REQUEST_URI&apos;];</div><div class="line">        if(strtolower(substr($uri, 0, 16)) == &quot;/groups/members/&quot;)</div><div class="line">        &#123;</div><div class="line">                //make sure they are a member</div><div class="line">                if(!pmpro_hasMembershipLevel())</div><div class="line">                &#123;</div><div class="line">                        wp_redirect(pmpro_url(&quot;levels&quot;));</div><div class="line">                        exit;</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(&quot;init&quot;, &quot;my_buddy_press_members_group&quot;);</div></pre></td></tr></table></figure>
<p>The workhorse here is the <code>pmpro_hasMembershipLevel()</code> function. This function can take two parameters. The first is the ID or name of a membership level to check for. The second parameter is the user ID of the user you want to check. If no parameters are set, the function will check if the current user has <em>any</em> membership level.</p>
<p>You can also do negative checks by passing, for example, “-1” as the level ID. <code>pmpro_hasMembershipLevel(-1)</code> will return <code>true</code> if the current user <em>doesn’t</em> have level 1. If you pass a zero specifically, the function will check that the user has <em>no</em> level at all. So <code>pmpro_hasMembershipLevel(0)</code> will return <code>true</code> if the current user does not have a membership level. (You could also do <code>!pmpro_hasMembershipLevel()</code>.)</p>
<p>Multiple level IDs and names can be passed in an array. For example, to check for members with level 1 or 2, use this code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if(pmpro_hasMembershipLevel(array(1,2)))</div><div class="line">&#123;</div><div class="line">    //do something for level 1 and 2 members here</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Lock-down-a-portion-of-a-page-by-shortcode"><a href="#Lock-down-a-portion-of-a-page-by-shortcode" class="headerlink" title="Lock down a portion of a page by shortcode"></a>Lock down a portion of a page by shortcode</h4><p>Another way to restrict access to content is to use shortcodes in your post body content. The following is an example of some page content that will show different messages to different membership levels:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Welcome to SchoolPress!</div><div class="line"></div><div class="line">[membership level=&quot;1&quot;]Thanks for your continuing membership.[/membership]</div><div class="line"></div><div class="line">[membership level=&quot;-1&quot;]Sign up your school now![/membership]</div></pre></td></tr></table></figure>
<p>The <code>[membership]</code> shortcode is fairly simple. It takes one parameter level that, similar to the parameter for the <code>pmpro_hasMembershipLevel()</code> function, can take a level ID, name, or a zero or negative level ID. Any content within the shortcode will be shown based on the stated level. Multiple level IDs can be passed separated by commas.</p>
<h4 id="Lock-down-a-portion-of-a-page-by-PHP-code-using-the-pmpro-hasMembershipLevel-function"><a href="#Lock-down-a-portion-of-a-page-by-PHP-code-using-the-pmpro-hasMembershipLevel-function" class="headerlink" title="Lock down a portion of a page by PHP code using the pmpro_hasMembershipLevel() function"></a>Lock down a portion of a page by PHP code using the pmpro_hasMembershipLevel() function</h4><p>When locking down the BuddyPress members group, we used the <code>pmpro_hasMembershipLevel()</code> function. You can also use this function within your page templates or other code to restrict access to content or portions of code. For example, you might find code like this in your header:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?php if(is_user_logged_in()) &#123; ?&gt;</div><div class="line">&lt;div class=&quot;user-welcome&quot;&gt;</div><div class="line">  Welcome</div><div class="line">  &lt;?php if(function_exists(&quot;pmpro_hasMembershipLevel&quot;)</div><div class="line">    &amp;&amp; pmpro_hasMembershipLevel()) &#123; ?&gt;</div><div class="line">        &lt;a href=&quot;&lt;?php echo pmpro_url(&quot;account&quot;); ?&gt;&quot;&gt;</div><div class="line">    &lt;?php echo $current_user-&gt;display_name;?&gt;</div><div class="line">    &lt;/a&gt;</div><div class="line">  &lt;?php &#125; else &#123; ?&gt;</div><div class="line">        &lt;a href=&quot;&lt;?php echo home_url(&quot;/wp-admin/profile.php&quot;); ?&gt;&quot;&gt;</div><div class="line">    &lt;?php echo $current_user-&gt;display_name;?&gt;</div><div class="line">    &lt;/a&gt;</div><div class="line">  &lt;?php &#125; ?&gt;</div><div class="line">&lt;/div&gt; &lt;!-- end user-welcome --&gt;</div><div class="line">&lt;?php &#125; ?&gt;</div></pre></td></tr></table></figure>
<p>The preceding code will show members a link to the PMPro account page. Users without a membership level are shown a link to their WP profile page.</p>
<h3 id="Step-8-Customizing-Paid-Memberships-Pro"><a href="#Step-8-Customizing-Paid-Memberships-Pro" class="headerlink" title="Step 8: Customizing Paid Memberships Pro"></a>Step 8: Customizing Paid Memberships Pro</h3><p>Below are a few common customizations for Paid Memberships Pro. The general process for customizing a plugin like Paid Memberships Pro is to:</p>
<ol>
<li>Figure out what you want to change.</li>
<li>Find out where the default behavior for your change is coded.</li>
<li>Locate or add a hook to support the customization you want.</li>
<li>Write an action or filter to use the hook.</li>
</ol>
<h4 id="Restricting-nonmembers-to-the-homepage"><a href="#Restricting-nonmembers-to-the-homepage" class="headerlink" title="Restricting nonmembers to the homepage"></a>Restricting nonmembers to the homepage</h4><p>By default, Paid Memberships Pro does not lock down any part of your site unless you specifically tell it to. For some sites, you will want very limited public access (just the sales, about, and contact pages). You can do this by redirecting nonmembers away from any nonapproved page. Use the following code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">function my_template_redirect()</div><div class="line">&#123;</div><div class="line">        $okay_pages = array(</div><div class="line">        pmpro_getOption(&apos;billing_page_id&apos;),</div><div class="line">        pmpro_getOption(&apos;account_page_id&apos;),</div><div class="line">        pmpro_getOption(&apos;levels_page_id&apos;),</div><div class="line">        pmpro_getOption(&apos;checkout_page_id&apos;),</div><div class="line">        pmpro_getOption(&apos;confirmation_page_id&apos;)</div><div class="line">    );</div><div class="line"></div><div class="line">        //if the user doesn&apos;t have a membership, send them home</div><div class="line">        if(!is_user_logged_in()</div><div class="line">                &amp;&amp; !is_home()</div><div class="line">                &amp;&amp; !is_page($okay_pages)</div><div class="line">                &amp;&amp; !strpos($_SERVER[&apos;REQUEST_URI&apos;], &quot;login&quot;))</div><div class="line">        &#123;</div><div class="line">            wp_redirect(home_url(&apos;wp-login.php?redirect_to=&apos;.</div><div class="line">            urlencode($_SERVER[&apos;REQUEST_URI&apos;])));</div><div class="line">        &#125;</div><div class="line">        elseif(is_page()</div><div class="line">                        &amp;&amp; !is_home()</div><div class="line">                        &amp;&amp; !is_page($okay_pages)</div><div class="line">                        &amp;&amp; !pmpro_hasMembershipLevel()</div><div class="line">        &#123;</div><div class="line">                wp_redirect(home_url());</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(&apos;template_redirect&apos;, &apos;my_template_redirect&apos;);</div></pre></td></tr></table></figure>
<p>In the preceding code, we set up an array of post IDs for pages that nonmembers should be able to see. We use the <code>pmpro_getOption()</code> function to get the IDs of the pages generated by PMPro and also allow access to the home page by using the WordPress <code>is_home()</code> function. We also allow access to any page with the word “login” in the URL, which on our setup will just the login page.</p>
<h4 id="Locking-down-files"><a href="#Locking-down-files" class="headerlink" title="Locking down files"></a>Locking down files</h4><p>Some of the pages you are locking down may have images or other files attached to them. If the page is locked down, the link or image will not show up on the site for your users. However, users who know the direct URL to the file will be able to download to the file without first being logged in as a member.</p>
<p>This is because when Apache processes a URL like <em><a href="http://schoolpress.me/wp-content/uploads/logo.png" target="_blank" rel="external">http://schoolpress.me/wp-content/uploads/logo.png</a></em>, it serves the file directly to the user without checking with PHP or WordPress first.</p>
<p>You can change this behavior by adding a rule to your site’s <em>.htaccess</em> file that will redirect any URL like the preceding one through a special script bundled with Paid Memberships Pro. Add the following code to the top of your <em>.htaccess</em> file, above the other rewrite rules:</p>
<pre><code>RewriteEngine On
RewriteBase /
RewriteRule ^wp-content/uploads/(.*)$ \
    /wp-content/plugins/paid-memberships-pro/services/getfile.php [L]
</code></pre><p>How does this work? In WordPress, images and files can be uploaded to a post or page. These files, called attachments by WordPress, are all stored in the <em>/wp-content/uploads/</em> folder, but they are also associated with the post they were attached to via an entry in the <code>wp_posts</code> table.</p>
<p>Attachments are stored in the <code>wp_posts</code> table with the <code>post_status</code> set to “attachment” and the post_parent set to the ID of the post they are attached to.</p>
<p>The <em>getfile.php</em> script will find the corresponding entry in the <code>wp_posts</code> table for the requested file; and if the attachment’s parent requires membership, it will check to make sure a valid member is logged in before serving the file.</p>
<h4 id="Change-user-roles-based-on-membership-levels"><a href="#Change-user-roles-based-on-membership-levels" class="headerlink" title="Change user roles based on membership levels"></a>Change user roles based on membership levels</h4><p>For most of the examples in this section, we assume that members only have access to the frontend application of your site. However, sometimes you may want to give members access to the WordPress dashboard, give them the “author” role so they can post to the blog, or otherwise assign a role other than “subscriber” to them.</p>
<p>This code will add the author role to any new member of a particular level. It will also downgrade the member to a subscriber role if her membership level is removed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">function my_pmpro_after_change_membership_level($level_id, $user_id)</div><div class="line">&#123;</div><div class="line">    if($level_id == 1)</div><div class="line">        &#123;</div><div class="line">                //New member of level #1.</div><div class="line">        //If they are a subscriber, make them an author.</div><div class="line">                $wp_user_object = new WP_User($user_id);</div><div class="line">                if(in_array(&quot;subscriber&quot;, $wp_user_object-&gt;roles))</div><div class="line">                        $wp_user_object-&gt;set_role(&apos;author&apos;);</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">                //Not a member of level #1.</div><div class="line">        //If they are an author, make them a subscriber.</div><div class="line">                $wp_user_object = new WP_User($user_id);</div><div class="line">                if(in_array(&quot;author&quot;, $wp_user_object-&gt;roles))</div><div class="line">                        $wp_user_object-&gt;set_role(&apos;subscriber&apos;);</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line">add_action(</div><div class="line">    &quot;pmpro_after_change_membership_level&quot;,</div><div class="line">    &quot;my_pmpro_after_change_membership_level&quot;,</div><div class="line">    10,</div><div class="line">    2</div><div class="line">);</div></pre></td></tr></table></figure>
<p>More information on users and roles is in <a href="ch06.html" title="Chapter 6. Users, Roles, and Capabilities">Chapter 6</a>.</p>
<h4 id="International-and-long-form-addresses"><a href="#International-and-long-form-addresses" class="headerlink" title="International and long-form addresses"></a>International and long-form addresses</h4><p>By default, the Paid Memberships Pro checkout form will show address fields with the city, state, and zip code formatted on one line and the country hidden and assumed to be “US.” The default Paid Memberships Pro billing address form is shown in <a href="ch15.html#billing_address" title="Figure 15-14. Paid Memberships Pro billing address">Figure 15-14</a>.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-payment-billing.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>If you anticipate international users, you will want to show a long-form address with a dropdown to select your country. This is done with the following code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">add_filter(&quot;pmpro_international_addresses&quot;, &quot;__return_true&quot;);</div><div class="line">add_filter(&quot;pmpro_longform_address&quot;, &quot;__return_true&quot;);</div></pre></td></tr></table></figure>
<p>That’s it, two lines. The <code>pmpro_international_addresses</code> hook/setting will show a country dropdown if <code>true</code>. The <code>pmpro_longform_address</code> hook/setting will show each address field on its own line if <code>true</code>.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/wordpress-payment-long-form.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>You may also want to change the default country, change the list of countries, or make some of the address fields not required. Here is some example code doing that:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">    Change the Default Country from US to GB (Great Britain)</div><div class="line">*/</div><div class="line">function my_pmpro_default_country($default)</div><div class="line">&#123;</div><div class="line">        return &quot;GB&quot;;</div><div class="line">&#125;</div><div class="line">add_filter(&quot;pmpro_default_country&quot;, &quot;my_pmpro_default_country&quot;);</div><div class="line"></div><div class="line">/*</div><div class="line">        Add/remove some countries from the default list.</div><div class="line">*/</div><div class="line">function my_pmpro_countries($countries)</div><div class="line">&#123;</div><div class="line">        //remove the US</div><div class="line">        unset($countries[&quot;US&quot;]);</div><div class="line"></div><div class="line">        //add The Moon (LN short for Lunar?)</div><div class="line">        $countries[&quot;LN&quot;] = &quot;The Moon&quot;;</div><div class="line"></div><div class="line">        //You could also rebuild the array from scratch.</div><div class="line">        //$countries = array(&quot;CA&quot; =&gt; &quot;Canada&quot;, &quot;US&quot; =&gt; &quot;United States&quot;,</div><div class="line">    //  &quot;GB&quot; =&gt; &quot;United Kingdom&quot;);</div><div class="line"></div><div class="line">        return $countries;</div><div class="line">&#125;</div><div class="line">add_filter(&quot;pmpro_countries&quot;, &quot;my_pmpro_countries&quot;);</div><div class="line"></div><div class="line">/*</div><div class="line">        (optional) You may want to add/remove certain countries from the list.</div><div class="line">    The pmpro_countries filter allows you to do this.</div><div class="line">        The array is formatted like</div><div class="line">    array(&quot;US&quot;=&gt;&quot;United States&quot;, &quot;GB&quot;=&gt;&quot;United Kingdom&quot;);</div><div class="line">    with the acronym as the key and the full</div><div class="line">        country name as the value.</div><div class="line">*/</div><div class="line">function my_pmpro_countries($countries)</div><div class="line">&#123;</div><div class="line">        //remove the US</div><div class="line">        unset($countries[&quot;US&quot;]);</div><div class="line"></div><div class="line">        //add The Moon (LN short for Lunar?)</div><div class="line">        $countries[&quot;LN&quot;] = &quot;The Moon&quot;;</div><div class="line"></div><div class="line">        //You could also rebuild the array from scratch.</div><div class="line">        //$countries = array(&quot;CA&quot; =&gt; &quot;Canada&quot;, &quot;US&quot; =&gt; &quot;United States&quot;,</div><div class="line">    //  &quot;GB&quot; =&gt; &quot;United Kingdom&quot;);</div><div class="line"></div><div class="line">        return $countries;</div><div class="line">&#125;</div><div class="line">add_filter(&quot;pmpro_countries&quot;, &quot;my_pmpro_countries&quot;);</div><div class="line"></div><div class="line">/*</div><div class="line">        Change some of the billing fields to be not required.</div><div class="line">        Default fields are: bfirstname, blastname, baddress1, bcity, bstate,</div><div class="line">    bzipcode, bphone, bemail, bcountry, CardType, AccountNumber,</div><div class="line">    ExpirationMonth, ExpirationYear, CVV</div><div class="line">*/</div><div class="line">function my_pmpro_required_billing_fields($fields)</div><div class="line">&#123;</div><div class="line">        //remove state and zip</div><div class="line">        unset($fields[&apos;bstate&apos;]);</div><div class="line">        unset($fields[&apos;bzipcode&apos;]);</div><div class="line"></div><div class="line">        return $fields;</div><div class="line">&#125;</div><div class="line">add_filter(&quot;pmpro_required_billing_fields&quot;, &quot;my_pmpro_required_billing_fields&quot;);</div></pre></td></tr></table></figure>
<h4 id="Upgrade-downgrade-pricing"><a href="#Upgrade-downgrade-pricing" class="headerlink" title="Upgrade/downgrade pricing"></a>Upgrade/downgrade pricing</h4><p>By default, when an existing member checks out for a new membership level, the member’s old level is cancelled immediately and he’s charged full price for the new membership level starting on the day he is checking out.</p>
<p>This works for some setups, but sometimes you might want to either (1) keep your member’s payment date the same or (2) give him some credit from his old membership level toward his new membership level. In other words, you want to prorate his payment.</p>
<p>You can do the math in many different ways, but the following code will show the idea behind overriding the subscription start date and the checkout price based on factors like old membership level:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">    Calculate the prorated membership cost.</div><div class="line">*/</div><div class="line">function my_pmpro_checkout_level($level)</div><div class="line">&#123;</div><div class="line">    //does the user have a level already?</div><div class="line">        if(pmpro_hasMembershipLevel())</div><div class="line">        &#123;</div><div class="line">                //get current level</div><div class="line">                global $current_user;</div><div class="line">                $clevel = $current_user-&gt;membership_level;</div><div class="line"></div><div class="line">                //get the difference in amount</div><div class="line">                $diff = $level-&gt;billing_amount - $clevel-&gt;billing_amount;</div><div class="line"></div><div class="line">                //only prorate if the difference is positive (upgrading)</div><div class="line">                if($diff &gt; 0)</div><div class="line">                &#123;</div><div class="line">                        //what day is it?</div><div class="line">                        $now = time();</div><div class="line">                        $today = intval(date(&quot;j&quot;, $now));</div><div class="line"></div><div class="line">                        //get their payment date</div><div class="line">                        $morder = new MemberOrder();</div><div class="line">                        $morder-&gt;getLastMemberOrder();</div><div class="line"></div><div class="line">                        $payment_day = intval(date(&quot;j&quot;, $morder-&gt;timestamp));</div><div class="line"></div><div class="line">                        //how many days in that month?</div><div class="line">            //either 1 for months with 31 days or -2 for Feb</div><div class="line">                        $days_in_month = date(&quot;t&quot;, $morder-&gt;timestamp);</div><div class="line">                        $extra_days = $days_in_month - 30;</div><div class="line"></div><div class="line">                        //how many days are left in this payment period?</div><div class="line">                        $days_left = $payment_day - $today + $extra_days;</div><div class="line"></div><div class="line">            //if negative, we need to &quot;flip it&quot;</div><div class="line">            if($days_left &lt; 0) $days_left = 30 + $days_left;</div><div class="line"></div><div class="line">            //as a % (decimal)</div><div class="line">            $per_left = $days_left / $days_in_month;</div><div class="line"></div><div class="line">                        //how many days have passed</div><div class="line">                        $days_passed = $days_in_month - $days_left;</div><div class="line"></div><div class="line">            //as a % (decimal)</div><div class="line">                        $per_passed = $days_passed / $days_in_month;</div><div class="line"></div><div class="line">                        /*</div><div class="line">                        Now figure out how to adjust the price.</div><div class="line">                        (a) What they should pay for new level</div><div class="line">                = $level-&gt;billing_amount * $per_left.</div><div class="line">                        (b) What they should have paid for current level</div><div class="line">                = $clevel-&gt;billing_amount * $per_passed.</div><div class="line">                        What they need to pay = (a) + (b) - (already paid)</div><div class="line">                        */</div><div class="line">                        $new_level_cost = $level-&gt;billing_amount * $per_left;</div><div class="line">                        $old_level_cost = $clevel-&gt;billing_amount * $per_passed;</div><div class="line"></div><div class="line">                        $level-&gt;initial_payment = round($new_level_cost +</div><div class="line">                $old_level_cost - $morder-&gt;total, 2);</div><div class="line"></div><div class="line">                        //just in case we have a negative payment</div><div class="line">                        if($level-&gt;initial_payment &lt; 0)</div><div class="line">                                $level-&gt;initial_payment = 0;</div><div class="line">                &#125;</div><div class="line">                else</div><div class="line">                &#123;</div><div class="line">                        //let&apos;s just zero out the initial payment for</div><div class="line">            //downgrades or you could figure out how to do a credit</div><div class="line">                        $level-&gt;initial_payment = 0;</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return $level;</div><div class="line">&#125;</div><div class="line">add_filter(&quot;pmpro_checkout_level&quot;, &quot;my_pmpro_checkout_level&quot;);</div><div class="line"></div><div class="line">/*</div><div class="line">        If you have an old membership level, keep your startdate.</div><div class="line">*/</div><div class="line">function my_pmpro_checkout_start_date_keep_startdate($startdate, $user_id,</div><div class="line">  $level)</div><div class="line">&#123;</div><div class="line">        if(pmpro_hasMembershipLevel())</div><div class="line">        &#123;</div><div class="line">          global $wpdb;</div><div class="line">          $sqlQuery = &quot;SELECT startdate FROM $wpdb-&gt;pmpro_memberships_users</div><div class="line">          WHERE user_id = &apos;&quot; . $wpdb-&gt;escape($user_id) . &quot;&apos;</div><div class="line">              AND membership_id = &apos;&quot; . $wpdb-&gt;escape($level-&gt;id) . &quot;&apos;</div><div class="line">              AND status = &apos;active&apos;</div><div class="line">          ORDER BY id DESC</div><div class="line">          LIMIT 1&quot;;</div><div class="line">      $old_startdate = $wpdb-&gt;get_var($sqlQuery);</div><div class="line"></div><div class="line">            if(!empty($old_startdate))</div><div class="line">                    $startdate = &quot;&apos;&quot; . $old_startdate . &quot;&apos;&quot;;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return $startdate;</div><div class="line">&#125;</div><div class="line">//remove the default PMPro filter</div><div class="line">remove_filter(&quot;pmpro_checkout_start_date&quot;,</div><div class="line">    &quot;pmpro_checkout_start_date_keep_startdate&quot;, 10, 3);</div><div class="line"></div><div class="line">//our filter works with ANY level</div><div class="line">add_filter(&quot;pmpro_checkout_start_date&quot;,</div><div class="line">    &quot;my_pmpro_checkout_start_date_keep_startdate&quot;, 10, 3);</div></pre></td></tr></table></figure>
<p>The integration with Paid Memberships Pro here is pretty straightforward. We are filtering the initial (first month) cost of a membership level using the <code>pmpro_checkout_level filter</code>. We also filter the subscription start date (or payment date) using the <code>pmpro_checkout_start_date</code> filter.</p>
<p>In both cases, we check if the user checking out already has a membership, meaning this is an upgrade or downgrade.</p>
<p>The rest of the code is simply math to figure out what percentage of a payment period has passed or what the user’s next payment date was going to be.</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/WordPress/2015-06-20-wordpress-cormmerce.html" target="_blank" rel="external">http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wordpress/">wordpress</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&title=《WordPress Ecormmerce》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&title=《WordPress Ecormmerce》 — Balance&source=Choosing a PluginThere are many different plugins that will allow you to acce..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《WordPress Ecormmerce》 — Balance&url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/SEO/2015-09-16-seo-robots.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">WordPress robots.txt Example</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/WordPress/2015-06-20-wordpress-library.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">PHP Libraries, External APIs, and Web Services</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&title=《WordPress Ecormmerce》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&title=《WordPress Ecormmerce》 — Balance&source=Choosing a PluginThere are many different plugins that will allow you to acce..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《WordPress Ecormmerce》 — Balance&url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/WordPress/2015-06-20-wordpress-cormmerce.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACwUlEQVR42u3aS3IbMQwFQN//0s42rpRG7wGk46R6Vip9ONNcEBCAj4/4+gyu37/5vM6rd/58na+8uvDw8PCOPvqrmyXrPDNa2Kt3nu+Lh4eHd4/3fIi3R/9+a2bhBw8PD+9f4c0S63wL8PDw8P4n3izZnSXxeHh4eD+N16awb0oAwTa1q12vteDh4eHFvLyL9HNeX+nv4eHh4R0aCHhuaLXfzMPD7Am/rICHh4d3gZcfuLMya1tQyFPz4jnx8PDwLvDaZDoZqGoz2/3oVbsReHh4eDNe3kbaJLv7ptpw7AAPDw/vAm/f3Ep+tQktyTpRfw8PDw/vEK9tLyXlhk3ynRcXonXw8PDwLvBmg1BJbWP2qzZ1XjXA8PDw8Ba8fQE3P77brdxsKB4eHt4N3vPRnzSr8rGAvPTQjme9iXh4eHh413h5kJg18vNtaqPZy+3Aw8PDu8BrR6ZmRYq8JDFrlb25Cx4eHt5RXl5c2B/ueahoBxQOjFvh4eHhlby2/T87uGfjCG2hJKq14OHh4S14+z//w95aPHTVjh0UoQIPDw9vxMsP4k0ZIg88p1pueHh4ePd47SG+SZHzB8qLGvvghIeHhzfjteNTp0quSTmjxUejV3h4eHgLXl4MzRPfdnRgVTt5xuPh4eFd4J1delaYaMNAkrK/nCnDw8PDO8rLaxU5oA0Mm2T9xFfx8PDwOl6eELfl1NkQVVsmfjMNgYeHh3eZlzT720/zldtQUQcGPDw8vAXvs7zao78dhNpv35d74eHh4V3g5ddqYuvx4dpNnDXS8PDw8M7y2mN9U0rIyx/5RqwSazw8PLwFLymYbrZjk2rPghAeHh7eT+PNEvG2udV++jKlxsPDw/urvLZU0YaNfFAg2mg8PDy8a7xN0ys5rPPCa1tueHMXPDw8vAu8+u/9tyTQs2+eqF7g4eHhPVy/AGnY7gPBBw/mAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
