<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-43567748-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    <title>PHP Form | Balance | 大道至简</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="tutorial,php">
    <meta name="description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Retrieving Submitted Data123456789101112if (isset($_POST[&amp;apos;author&amp;apos;])   &amp;amp;&amp;amp;      isset($_POST[&amp;apos;title&amp;apos;">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP Form">
<meta property="og:url" content="http://blog.inching.org/PHP/2015-05-27-php-form.html">
<meta property="og:site_name" content="Balance">
<meta property="og:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Retrieving Submitted Data123456789101112if (isset($_POST[&amp;apos;author&amp;apos;])   &amp;amp;&amp;amp;      isset($_POST[&amp;apos;title&amp;apos;">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/php-cookie.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/php-form-cookie.png">
<meta property="og:image" content="http://johnnyimages.qiniudn.com/php-form-sesstion.png">
<meta property="og:updated_time" content="2017-11-05T08:22:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP Form">
<meta name="twitter:description" content="See 《Modern PHP》 and 《Learning PHP, MySQL &amp;amp; JavaScript, 4th Edition》.
Retrieving Submitted Data123456789101112if (isset($_POST[&amp;apos;author&amp;apos;])   &amp;amp;&amp;amp;      isset($_POST[&amp;apos;title&amp;apos;">
<meta name="twitter:image" content="http://johnnyimages.qiniudn.com/php-cookie.png">
    
        <link rel="alternate" type="application/atom+xml" title="Balance" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/style/style.css?v=1.6.17">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Cody Fei</h5>
          <a href="mailto:inchingcode@gmail.com" title="inchingcode@gmail.com" class="mail">inchingcode@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/android"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/Android/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/inchingorg" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/CodyFee" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.inesoi.com" target="_blank" >
                <i class="icon icon-lg icon-shopping-bag"></i>
                Shopping Bag
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">PHP Form</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">PHP Form</h1>
        <h5 class="subtitle">
            
                <time datetime="2015-05-26T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2015-05-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Retrieving-Submitted-Data"><span class="post-toc-text">Retrieving Submitted Data</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#register-globals-An-Old-Solution-Hangs-On"><span class="post-toc-text">register_globals: An Old Solution Hangs On</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sanitizing"><span class="post-toc-text">Sanitizing</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#User-profile-information"><span class="post-toc-text">User profile information</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Cookies"><span class="post-toc-text">Cookies</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Setting-a-Cookie"><span class="post-toc-text">Setting a Cookie</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Accessing-a-Cookie"><span class="post-toc-text">Accessing a Cookie</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Destroying-a-Cookie"><span class="post-toc-text">Destroying a Cookie</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HTTP-Authentication"><span class="post-toc-text">HTTP Authentication</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Storing-Usernames-and-Passwords"><span class="post-toc-text">Storing Usernames and Passwords</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Salting"><span class="post-toc-text">Salting</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Sessions"><span class="post-toc-text">Sessions</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Starting-a-Session"><span class="post-toc-text">Starting a Session</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Ending-a-Session"><span class="post-toc-text">Ending a Session</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Setting-a-Time-Out"><span class="post-toc-text">Setting a Time-Out</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Session-Security"><span class="post-toc-text">Session Security</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Preventing-session-hijacking"><span class="post-toc-text">Preventing session hijacking</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Preventing-session-fixation"><span class="post-toc-text">Preventing session fixation</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Forcing-cookie-only-sessions"><span class="post-toc-text">Forcing cookie-only sessions</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Using-a-shared-server"><span class="post-toc-text">Using a shared server</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-php-form"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">PHP Form</h1>
        <div class="post-meta">
            <time class="post-time" title="2015-05-27 00:00:00" datetime="2015-05-26T16:00:00.000Z"  itemprop="datePublished">2015-05-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/PHP/">PHP</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>See <a href="http://www.salttiger.com/modern-php/" target="_blank" rel="external">《Modern PHP》</a> and <a href="http://www.salttiger.com/learning-php-mysql-javascript-4th-edition/" target="_blank" rel="external">《Learning PHP, MySQL &amp; JavaScript, 4th Edition》</a>.</p>
<h2 id="Retrieving-Submitted-Data"><a href="#Retrieving-Submitted-Data" class="headerlink" title="Retrieving Submitted Data"></a>Retrieving Submitted Data</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">if (isset($_POST[&apos;author&apos;])   &amp;&amp;</div><div class="line">      isset($_POST[&apos;title&apos;])    &amp;&amp;</div><div class="line">      isset($_POST[&apos;category&apos;]) &amp;&amp;</div><div class="line">      isset($_POST[&apos;year&apos;])     &amp;&amp;</div><div class="line">      isset($_POST[&apos;isbn&apos;]))</div><div class="line">&#123;</div><div class="line">    $author   = get_post($conn, &apos;author&apos;);</div><div class="line">    $title    = get_post($conn, &apos;title&apos;);</div><div class="line">    $category = get_post($conn, &apos;category&apos;);</div><div class="line">    $year     = get_post($conn, &apos;year&apos;);</div><div class="line">    $isbn     = get_post($conn, &apos;isbn&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>The PHP <code>isset</code> function is used to test whether <code>$_POST[&#39;name&#39;]</code> has been assigned a value. </p>
<p><code>$_POST</code> is an associative array. Depending on whether a form has been set to use the Post or the Get method, either the <code>$_POST</code> or the <code>$_GET</code> associative array will be populated with the form data. They can both be read in exactly the same way.</p>
<p>There is no reason to write to an element in the <code>$_POST</code> array. Its only purpose is to communicate information from the browser to the program, and you’re better off copying data to your own variables before altering it.</p>
<h3 id="register-globals-An-Old-Solution-Hangs-On"><a href="#register-globals-An-Old-Solution-Hangs-On" class="headerlink" title="register_globals: An Old Solution Hangs On"></a>register_globals: An Old Solution Hangs On</h3><p>Before security became such a big issue, the default behavior of PHP was to assign the <code>$_POST</code> and <code>$_GET</code> arrays directly to PHP variables. For example, there would be no need to use the instruction <code>$name=$_POST[&#39;name&#39;];</code> because <code>$name</code> would already be given that value automatically by PHP at the program start!Initially (prior to version 4.2.0 of PHP), this seemed a very useful idea that saved a lot of extra code writing, but this practice has now been discontinued and the feature is disabled by default. Should you find <code>register_globals</code> enabled on a production web server for which you are developing, you should urgently ask your server administrator to disable it.</p>
<p>So why disable <code>register_globals</code>? It enables anyone to enter a Get input on the tail of a URL, like this: <em><a href="http://myserver.com?override=1" target="_blank" rel="external">http://myserver.com?override=1</a></em>. If your code were ever to use the variable <code>$override</code> and you forgot to initialize it (for example, with the statement <code>$override=0;</code>), the program could be compromised by such an exploit.</p>
<p>In fact, because many installations on the Web still have this gaping hole, I advise you to always initialize every variable you use, just in case your code will ever run on such a system. Initialization is also good programming practice, because you can comment each initialization to remind yourself and other programmers what a variable is for.</p>
<h3 id="Sanitizing"><a href="#Sanitizing" class="headerlink" title="Sanitizing"></a>Sanitizing</h3><p>You sanitize HTML special characters (e.g., <code>&amp;</code>, <code>&gt;</code>, <code>&amp;#x2033;</code>) into their HTML entity equivalents with the <a href="http://php.net/manual/function.htmlentities.php" target="_blank" rel="external"><code>htmlentities()</code></a> function. This function escapes <em>all</em> HTML characters in a given string and renders the string safe for your application’s storage layer. </p>
<p>The <code>htmlentities()</code> function is dumb, though. It does not validate HTML input. It does not escape single quotes by default. And it cannot detect the input string’s character set. Here’s how to use the <code>htmlentities()</code> function correctly. The first argument is the input string. The second argument is the <code>ENT_QUOTES</code> constant, which prompts the function to encode single quotes. The third argument specifies the input string’s character set.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$input = &apos;&lt;p&gt;&lt;script&gt;alert(&quot;You won the Nigerian lottery!&quot;);&lt;/script&gt;&lt;/p&gt;&apos;;</div><div class="line">echo htmlentities($input, ENT_QUOTES, &apos;UTF-8&apos;);</div></pre></td></tr></table></figure>
<p>If you require more finesse when sanitizing HTML input, use the<a href="http://htmlpurifier.org/" target="_blank" rel="external">HTML Purifier</a> library. HTML Purifier is a very robust and secure PHP library that sanitizes HTML input according to rules that you provide. The HTML Purifier library’s downside is that it is slow and potentially difficult to configure.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sanitizeString</span><span class="params">($var)</span></span></div><div class="line">  &#123;</div><div class="line">    $var = stripslashes($var);</div><div class="line">    $var = strip_tags($var);</div><div class="line">    $var = htmlentities($var);</div><div class="line">    <span class="keyword">return</span> $var;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sanitizeMySQL</span><span class="params">($connection, $var)</span></span></div><div class="line">  &#123; </div><div class="line">    $var = $connection-&gt;real_escape_string($var);</div><div class="line">    $var = sanitizeString($var);</div><div class="line">    <span class="keyword">return</span> $var;</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>When it’s time to render output to a web page or API response, it is very important that you <em>escape</em> your output. This is one more layer of protection that prevents malicious code from being rendered and inadvertently executed by your application’s users.</p>
<p>Be sure you use <code>ENT_QUOTES</code> as the second argument so that it escapes both single and double quotes. Specify the appropriate character encoding (usually <code>UTF-8</code>) as the third argument.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$output = &apos;&lt;p&gt;&lt;script&gt;alert(&quot;NSA backdoor installed&quot;);&lt;/script&gt;&apos;;</div><div class="line">echo htmlentities($output, ENT_QUOTES, &apos;UTF-8&apos;);</div></pre></td></tr></table></figure>
<p>Some PHP template engines like <a href="https://packagist.org/packages/twig/twig" target="_blank" rel="external"><code>twig/twig</code></a> (my favorite) or <a href="https://packagist.org/packages/smarty/smarty" target="_blank" rel="external"><code>smarty/smarty</code></a> escape output automatically. The Twig template engine by Sensio Labs, for example, escapes all output by default unless you tell it otherwise. This is a brilliant default and provides a nice safety net for your PHP web applications.</p>
<h3 id="User-profile-information"><a href="#User-profile-information" class="headerlink" title="User profile information"></a>User profile information</h3><p>If your application has user accounts, you’ll likely encounter email addresses, telephone numbers, zip codes, and other profile-related information. PHP anticipates this scenario with the <code>filter_var()</code> and <code>filter_input()</code> functions. These two functions accept a variety of flags to sanitize different forms of input: emails, URL-encoded strings, integers, floats, HTML characters, URLs, and specific ASCII character ranges.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$email = &apos;john@example.com&apos;;</div><div class="line">$emailSafe = filter_var($email, FILTER_SANITIZE_EMAIL);</div></pre></td></tr></table></figure>
<p>Sanitize user profile international characters</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$string = &quot;\nIñtërnâtiônàlizætiøn\t&quot;;</div><div class="line">$safeString = filter_var(</div><div class="line">    $string,</div><div class="line">    FILTER_SANITIZE_STRING,</div><div class="line">    FILTER_FLAG_STRIP_LOW|FILTER_FLAG_ENCODE_HIGH</div><div class="line">);</div></pre></td></tr></table></figure>
<p>You can validate user input with the <code>filter_var()</code> function with any of the <code>FILTER_VALIDATE_*</code> flags. PHP provides flags to validate Booleans, emails, floats, integers, IP addresses, regular expressions, and URLs.Example 5-5 demonstrates how to validate an email address.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$input = &apos;john@example.com&apos;;</div><div class="line">$isEmail = filter_var($input, FILTER_VALIDATE_EMAIL);</div><div class="line">if ($isEmail !== false) &#123;</div><div class="line">    echo &quot;Success&quot;;</div><div class="line">&#125; else &#123;</div><div class="line">    echo &quot;Fail&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Although the <code>filter_var()</code> function provides a number of validation flags,<br>it cannot validate everything. I recommend these additional<br>validation components, too:</p>
<ul>
<li><a href="https://packagist.org/packages/aura/filter" target="_blank" rel="external"><code>aura/filter</code></a></li>
<li><a href="https://packagist.org/packages/respect/validation" target="_blank" rel="external"><code>respect/validation</code></a></li>
<li><a href="https://packagist.org/packages/symfony/validator" target="_blank" rel="external"><code>symfony/validator</code></a></li>
</ul>
<p>You should validate <em>and</em> sanitize input data to make sure input data<br>is safe <em>and</em> what you expect.</p>
<p>See <a href="http://php.net/manual/en/function.filter-var.php" target="_blank" rel="external">PHP: filter_var - Manual</a></p>
<h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><p>A <em>cookie</em> is an item of data that a web server saves to your computer’s hard disk via a web browser. It can contain almost any alphanumeric information (as long as it’s under 4 KB) and can be retrieved from your computer and returned to the server. Common uses include session tracking, maintaining data across multiple visits, holding shopping cart contents, storing login details, and more.</p>
<p>Because of their privacy implications, cookies can be read only from the issuing domain.</p>
<p>Cookies are exchanged during the transfer of headers, before the actual HTML of a web page is sent, and it is impossible to send a cookie once any HTML has been transferred.</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/php-cookie.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>This exchange shows a browser receiving two pages:</p>
<ol>
<li>The browser issues a request to retrieve the main page, <em>index.html</em>, at the website <em><a href="http://www.webserver.com" target="_blank" rel="external">http://www.webserver.com</a></em>. The first header specifies the file, and the second header specifies the server.</li>
<li>When the web server at <em>webserver.com</em> receives this pair of headers, it returns some of its own. The second header defines the type of content to be sent (<code>text/html</code>), and the third one sends a cookie of the name <em>name</em> and with the value <em>value</em>. Only then are the contents of the web page transferred.</li>
<li>Once the browser has received the cookie, it will then return it with every future request made to the issuing server until the cookie expires or is deleted. So, when the browser requests the new page <em>/news.html</em>, it also returns the cookie <em>name</em> with the value <em>value</em>.</li>
<li>Because the cookie has already been set, when the server receives the request to send <em>/news.html</em>, it does not have to resend the cookie, but just returns the requested page.</li>
</ol>
<h3 id="Setting-a-Cookie"><a href="#Setting-a-Cookie" class="headerlink" title="Setting a Cookie"></a>Setting a Cookie</h3><p>Setting a cookie in PHP is a simple matter. </p>
<pre><code>setcookie(name, value, expire, path, domain, secure, httponly);
</code></pre><p>The setcookie parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Example           </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>The name of the cookie. This is the name that your server will use to access the cookie on subsequent browser requests.</td>
<td><code>username</code>        </td>
</tr>
<tr>
<td><code>value</code></td>
<td>The value of the cookie, or the cookie’s contents. This can contain up to 4 KB of alphanumeric text.</td>
<td><code>Hannah</code></td>
</tr>
<tr>
<td><code>expire</code></td>
<td>(<em>Optional.</em>) Unix timestamp of the expiration date. Generally, you will probably use <code>time()</code> plus a number of seconds. If not set, the cookie expires when the browser closes.</td>
<td><code>time() + 2592000</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>(<em>Optional.</em>) The path of the cookie on the server. If this is a <code>/</code> (forward slash), the cookie is available over the entire domain, such as <em><a href="http://www.webserver.com" target="_blank" rel="external">www.webserver.com</a></em>. If it is a subdirectory, the cookie is available only within that subdirectory. The default is the current directory that the cookie is being set in, and this is the setting you will normally use.</td>
<td><code>/</code></td>
</tr>
<tr>
<td><code>domain</code></td>
<td>(<em>Optional.</em>) The Internet domain of the cookie. If this is <em>.webserver.com</em>, the cookie is available to all of <em>webserver.com</em> and its subdomains, such as <em><a href="http://www.webserver.com" target="_blank" rel="external">www.webserver.com</a></em> and <em>images.webserver.com</em>. If it is <em>images.webserver.com</em>, the cookie is available only to <em>images.webserver.com</em> and its subdomains such as <em>sub.images.webserver.com</em>, but not, say, to <em><a href="http://www.webserver.com" target="_blank" rel="external">www.webserver.com</a></em>.</td>
<td><code>.webserver.com</code>  </td>
</tr>
<tr>
<td><code>secure</code></td>
<td>(<em>Optional.</em>) Whether the cookie must use a secure connection (<em>https://</em>). If this value is <code>TRUE</code>, the cookie can be transferred only across a secure connection. The default is <code>FALSE</code>.</td>
<td><code>FALSE</code>           </td>
</tr>
<tr>
<td><code>httponly</code></td>
<td>(<em>Optional</em>; implemented since PHP version 5.2.0.) Whether the cookie must use the HTTP protocol. If this value is <code>TRUE</code>, scripting languages such as JavaScript cannot access the cookie. (Not supported in all browsers.) The default is <code>FALSE</code>.</td>
<td><code>FALSE</code></td>
</tr>
</tbody>
</table>
<p>So, to create a cookie with the name <code>username</code> and the value <code>Hannah</code> that is accessible across the entire web server on the current domain, and will be removed from the browser’s cache in seven days, use the following:</p>
<pre><code>setcookie(&apos;username&apos;, &apos;Hannah&apos;, time() + 60 * 60 * 24 * 7, &apos;/&apos;);
</code></pre><h3 id="Accessing-a-Cookie"><a href="#Accessing-a-Cookie" class="headerlink" title="Accessing a Cookie"></a>Accessing a Cookie</h3><p>Reading the value of a cookie is as simple as accessing the <code>$_COOKIE</code> system array. For example, if you wish to see whether the current browser has the cookie called <code>username</code> already stored and, if so, to read its value, use the following:</p>
<pre><code>if (isset($_COOKIE[&apos;username&apos;])) $username = $_COOKIE[&apos;username&apos;];
</code></pre><p>Note that you can read a cookie back only after it has been sent to a web browser. This means that when you issue a cookie, you cannot read it in again until the browser reloads the page (or another with access to the cookie) from your website and passes the cookie back to the server in the process.</p>
<h3 id="Destroying-a-Cookie"><a href="#Destroying-a-Cookie" class="headerlink" title="Destroying a Cookie"></a>Destroying a Cookie</h3><p>To delete a cookie, you must issue it again and set a date in the past. It is important for all parameters in your new <code>setcookie</code> call except the timestamp to be identical to the parameters when the cookie was first issued; otherwise, the deletion will fail. Therefore, to delete the cookie created earlier, you would use the following:</p>
<pre><code>setcookie(&apos;username&apos;, &apos;Hannah&apos;, time() - 2592000, &apos;/&apos;);
</code></pre><p>As long as the time given is in the past, the cookie should be deleted. However, I have used a time of 2,592,000 seconds (one month) in the past in case the client computer’s date and time are not correctly set.</p>
<h3 id="HTTP-Authentication"><a href="#HTTP-Authentication" class="headerlink" title="HTTP Authentication"></a>HTTP Authentication</h3><p>HTTP authentication uses the web server to manage users and passwords for the application. It’s adequate for most applications that ask users to log in, although some applications have specialized needs or more stringent security requirements that call for other techniques.</p>
<p>To use HTTP authentication, PHP sends a header request asking to start an authentication dialog with the browser. The server must have this feature turned on in order for it to work, but because it’s so common, your server is likely to offer the feature.</p>
<p>After entering your URL into the browser or visiting via a link, the user will see an “Authentication Required” prompt pop up, requesting two fields: User Name and Password:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://johnnyimages.qiniudn.com/php-form-cookie.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'PHP_AUTH_USER'</span>]) &amp;&amp;</div><div class="line">      <span class="keyword">isset</span>($_SERVER[<span class="string">'PHP_AUTH_PW'</span>]))</div><div class="line">  &#123;</div><div class="line">    <span class="keyword">echo</span> <span class="string">"Welcome User: "</span> . $_SERVER[<span class="string">'PHP_AUTH_USER'</span>] .</div><div class="line">         <span class="string">" Password: "</span>    . $_SERVER[<span class="string">'PHP_AUTH_PW'</span>];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">    header(<span class="string">'WWW-Authenticate: Basic realm="Restricted Section"'</span>);</div><div class="line">    header(<span class="string">'HTTP/1.0 401 Unauthorized'</span>);</div><div class="line">    <span class="keyword">die</span>(<span class="string">"Please enter your username and password"</span>);</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Incidentally, take a look at the wording of the error message: <code>Invalid username / password combination</code>. It doesn’t say whether the username or the password or both were wrong—the less information you can give to a potential hacker, the better.</p>
<p>A mechanism is now in place to authenticate users, but only for a single username and password. Also, the password appears in clear text within the PHP file, and if someone managed to hack into your server, he would instantly know it. So let’s look at a better way to handle usernames and passwords.</p>
<h3 id="Storing-Usernames-and-Passwords"><a href="#Storing-Usernames-and-Passwords" class="headerlink" title="Storing Usernames and Passwords"></a>Storing Usernames and Passwords</h3><p>Obviously, MySQL is the natural way to store usernames and passwords. But again, we don’t want to store the passwords as clear text, because our website could be compromised if the database were accessed by a hacker. Instead, we’ll use a neat trick called a <em>one-way function</em>.This type of function is easy to use and converts a string of text into a seemingly random string. Because of their one-way nature, such functions are virtually impossible to reverse, so their output can be safely stored in a database—and anyone who steals it will be none the wiser as to the passwords used.</p>
<p>In previous editions of this book, I recommended using the <em>md5</em> hashing algorithm for your data security. Time marches on, however, and now md5 is considered easily hackable and therefore unsafe, while even its previously recommended replacement of <em>sha1</em> can apparently be hacked (plus sha1 and sha2 were designed by the NSA and therefore considerable caution is recommended for their use in highly secure implementations).</p>
<p>So now I have moved on to using the PHP <code>hash</code> function, passing it a version of the <em>ripemd</em> algorithm, which was designed by the open academic community and which (like md5) returns a 32-character hexadecimal number—so it can easily replace md5 in most databases. Use it like this:</p>
<pre><code>$token = hash(&apos;ripemd128&apos;, &apos;mypassword&apos;);
</code></pre><p>That example happens to give <code>$token</code> this value:</p>
<pre><code>7b694600c8a2a2b0897c719958713619
</code></pre><p>By using the <code>hash</code> function, you can keep up with future developments in security and simply pass the hashing algorithm to it that you wish to implement, resulting in less code maintenance (although you will probably have to accommodate larger hash lengths than 32 characters in your databases).</p>
<h3 id="Salting"><a href="#Salting" class="headerlink" title="Salting"></a>Salting</h3><p>Unfortunately, <code>hash</code> on its own is not enough to protect a database of passwords, because it could still be susceptible to a brute force attack that uses another database of known 32-character hexadecimal tokens. Such databases do exist, as a quick Google search will verify, although probably only for md5 and sha1 or sha2 at the moment.</p>
<p>Thankfully, though, we can put a spanner in the works of any such attempts by <em>salting</em> all the passwords before they are sent to <code>hash</code>. Salting is simply a matter of adding some text that only we know about to each parameter to be encrypted, like this (with the salt highlighted in bold):</p>
<pre><code>$token = hash(&apos;ripemd128&apos;, &apos;**saltstring**mypassword&apos;);
</code></pre><p>In this example, the text <em>saltstring</em> has been prepended to the password. Of course, the more obscure you can make the salt, the better. I like to use salts such as this:</p>
<pre><code>$token = hash(&apos;ripemd128&apos;, &apos;**hqb%$t**mypassword**cg*l**&apos;);
</code></pre><p>Here some random characters have been placed both before and after the password. Given just the database, and without access to your PHP code, it should now be next to impossible to work out the stored passwords.</p>
<p>All you have to do when verifying someone’s login password is to add these same random strings back in before and after it, and then check the resulting token from a <code>hash</code> call against the one stored in the database for that user.</p>
<p>Creating a users table and adding two accounts:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&lt;?php // setupusers.php</div><div class="line">  require_once 'login.php';</div><div class="line">  $connection =</div><div class="line">    new mysqli($db_hostname, $db_username, $db_password, $db_database);</div><div class="line"></div><div class="line">  if ($connection-&gt;connect_error) die($connection-&gt;connect_error);</div><div class="line"></div><div class="line">  $query = "CREATE TABLE users (</div><div class="line">    forename VARCHAR(32) NOT NULL,</div><div class="line">    surname  VARCHAR(32) NOT NULL,</div><div class="line">    username VARCHAR(32) NOT NULL UNIQUE,</div><div class="line">    password VARCHAR(32) NOT NULL</div><div class="line">  )";</div><div class="line">  $result = $connection-&gt;query($query);</div><div class="line">  if (!$result) die($connection-&gt;error);</div><div class="line"></div><div class="line">  $salt1    = "qm&amp;h*";</div><div class="line">  $salt2    = "pg!@";</div><div class="line"></div><div class="line">  $forename = 'Bill';</div><div class="line">  $surname  = 'Smith';</div><div class="line">  $username = 'bsmith';</div><div class="line">  $password = 'mysecret';</div><div class="line">  $token    = hash('ripemd128', "$salt1$password$salt2");</div><div class="line"></div><div class="line">  add_user($connection, $forename, $surname, $username, $token);</div><div class="line"></div><div class="line">  $forename = 'Pauline';</div><div class="line">  $surname  = 'Jones';</div><div class="line">  $username = 'pjones';</div><div class="line">  $password = 'acrobat';</div><div class="line">  $token    = hash('ripemd128', "$salt1$password$salt2");</div><div class="line"></div><div class="line">  add_user($connection, $forename, $surname, $username, $token);</div><div class="line"></div><div class="line">  function add_user($connection, $fn, $sn, $un, $pw)</div><div class="line">  &#123;</div><div class="line">    $query  = "INSERT INTO users VALUES('$fn', '$sn', '$un', '$pw')";</div><div class="line">    $result = $connection-&gt;query($query);</div><div class="line">    if (!$result) die($connection-&gt;error);</div><div class="line">  &#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>Type it, save it as <em>authenticate.php</em>, and call it up in your browser.</p>
<p>PHP authentication using MySQL:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">&lt;?php // authenticate.php</div><div class="line">  require_once &apos;login.php&apos;;</div><div class="line">  $connection =</div><div class="line">    new mysqli($db_hostname, $db_username, $db_password, $db_database);</div><div class="line"></div><div class="line">  if ($connection-&gt;connect_error) die($connection-&gt;connect_error);</div><div class="line"></div><div class="line">  if (isset($_SERVER[&apos;PHP_AUTH_USER&apos;]) &amp;&amp;</div><div class="line">      isset($_SERVER[&apos;PHP_AUTH_PW&apos;]))</div><div class="line">  &#123;</div><div class="line">    $un_temp = mysql_entities_fix_string($connection, $_SERVER[&apos;PHP_AUTH_USER&apos;]);</div><div class="line">    $pw_temp = mysql_entities_fix_string($connection, $_SERVER[&apos;PHP_AUTH_PW&apos;]);</div><div class="line"></div><div class="line">    $query  = &quot;SELECT * FROM users WHERE username=&apos;$un_temp&apos;&quot;;</div><div class="line">    $result = $connection-&gt;query($query);</div><div class="line">    if (!$result) die($connection-&gt;error);</div><div class="line">    elseif ($result-&gt;num_rows)</div><div class="line">    &#123;</div><div class="line">        $row = $result-&gt;fetch_array(MYSQLI_NUM);</div><div class="line"></div><div class="line">          $result-&gt;close();</div><div class="line"></div><div class="line">        $salt1 = &quot;qm&amp;h*&quot;;</div><div class="line">        $salt2 = &quot;pg!@&quot;;</div><div class="line">        $token = hash(&apos;ripemd128&apos;, &quot;$salt1$pw_temp$salt2&quot;);</div><div class="line"></div><div class="line">        if ($token == $row[3]) echo &quot;$row[0] $row[1] :</div><div class="line">          Hi $row[0], you are now logged in as &apos;$row[2]&apos;&quot;;</div><div class="line">        else die(&quot;Invalid username/password combination&quot;);</div><div class="line">    &#125;</div><div class="line">    else die(&quot;Invalid username/password combination&quot;);</div><div class="line">  &#125;</div><div class="line">  else</div><div class="line">  &#123;</div><div class="line">    header(&apos;WWW-Authenticate: Basic realm=&quot;Restricted Section&quot;&apos;);</div><div class="line">    header(&apos;HTTP/1.0 401 Unauthorized&apos;);</div><div class="line">    die (&quot;Please enter your username and password&quot;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $connection-&gt;close();</div><div class="line"></div><div class="line">  function mysql_entities_fix_string($connection, $string)</div><div class="line">  &#123;</div><div class="line">    return htmlentities(mysql_fix_string($connection, $string));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  function mysql_fix_string($connection, $string)</div><div class="line">  &#123;</div><div class="line">    if (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    return $connection-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>As you might expect at this point in the book, some of these examples are starting to get quite a bit longer. But don’t be put off. The final 10 lines are simply Example 10-22 from <a href="ch10.html#accessing_mysql_using_php">Chapter 10</a>. They are there to sanitize the user input—very important.</p>
<p>The only lines to really concern yourself with at this point start with the assigning of two variables, <code>$un_temp</code> and <code>$pw_temp</code>, using the submitted username and password, highlighted in bold text. Next, a query is issued to MySQL to look up the user <code>$un_temp</code> and, if a result is returned, to assign the first row to <code>$row</code>. (Because usernames are unique, there will be only one row.) Then the two salts are created in <code>$salt1</code> and <code>$salt2</code>, which are then added before and after the submitted password <code>$pw_temp</code>. This string is then passed to the <code>hash</code> function, which returns a 32-character hexadecimal value in <code>$token</code>.</p>
<p>Now all that’s necessary is to check <code>$token</code> against the value stored in the database, which happens to be in the fourth column—which is column 3 when starting from 0. So <code>$row[3]</code> contains the previous token calculated for the salted password. If the two match, a friendly welcome string is output, calling the user by his or her first name (see Figure 12-4). Otherwise, an error message is displayed. As mentioned before, the error message is the same regardless of whether such a username exists, as this provides minimal information to potential hackers or password guessers.</p>
<h2 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h2><p>Because your program can’t tell what variables were set in other programs—or even what values the same program set the previous time it ran—you’ll sometimes want to track what your users are doing from one web page to another. You can do this by setting hidden fields in a form, and checking the value of the fields after the form is submitted, but PHP provides a much more powerful and simpler solution in the form of <em>sessions</em>. These are groups of variables that are stored on the server but relate only to the current user. To ensure that the right variables are applied to the right users, PHP saves a cookie in the users’ web browsers to uniquely identify them.</p>
<p>This cookie has meaning only to the web server and cannot be used to ascertain any information about a user. You might ask about those users who have their cookies turned off. Well, that’s not a problem as of PHP 4.2.0, because it will identify when this is the case and place a cookie token in the Get portion of each URL request instead. Either way, sessions provide a solid way of keeping track of your users.</p>
<h3 id="Starting-a-Session"><a href="#Starting-a-Session" class="headerlink" title="Starting a Session"></a>Starting a Session</h3><p>Starting a session requires calling the PHP function <code>session_start</code> before any HTML has been output, similarly to how cookies are sent during header exchanges. Then, to begin saving session variables, you just assign them as part of the <code>$_SESSION</code> array, like this:</p>
<pre><code>$_SESSION[&apos;variable&apos;] = $value;
</code></pre><p>They can then be read back just as easily in later program runs, like this:</p>
<pre><code>$variable = $_SESSION[&apos;variable&apos;];
</code></pre><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">&lt;?php //authenticate2.php</div><div class="line">  require_once 'login.php';</div><div class="line">  $connection =</div><div class="line">    new mysqli($db_hostname, $db_username, $db_password, $db_database);</div><div class="line"></div><div class="line">  if ($connection-&gt;connect_error) die($connection-&gt;connect_error);</div><div class="line"></div><div class="line">  if (isset($_SERVER['PHP_AUTH_USER']) &amp;&amp;</div><div class="line">      isset($_SERVER['PHP_AUTH_PW']))</div><div class="line">  &#123;</div><div class="line">    $un_temp = mysql_entities_fix_string($connection, $_SERVER['PHP_AUTH_USER']);</div><div class="line">    $pw_temp = mysql_entities_fix_string($connection, $_SERVER['PHP_AUTH_PW']);</div><div class="line"></div><div class="line">    $query = "SELECT * FROM users WHERE username='$un_temp'";</div><div class="line">    $result = $connection-&gt;query($query);</div><div class="line"></div><div class="line">    if (!$result) die($connection-&gt;error);</div><div class="line">    elseif ($result-&gt;num_rows)</div><div class="line">    &#123;</div><div class="line">          $row = $result-&gt;fetch_array(MYSQLI_NUM);</div><div class="line"></div><div class="line">          $result-&gt;close();</div><div class="line"></div><div class="line">          $salt1 = "qm&amp;h*";</div><div class="line">          $salt2 = "pg!@";</div><div class="line">        $token = hash('ripemd128', "$salt1$pw_temp$salt2");</div><div class="line"></div><div class="line">          if ($token == $row[3])</div><div class="line">          &#123;</div><div class="line">               session_start();</div><div class="line">               $_SESSION['username'] = $un_temp;</div><div class="line">               $_SESSION['password'] = $pw_temp;</div><div class="line">               $_SESSION['forename'] = $row[0];</div><div class="line">               $_SESSION['surname']  = $row[1];</div><div class="line">               echo "$row[0] $row[1] : Hi $row[0],</div><div class="line">                     you are now logged in as '$row[2]'";</div><div class="line">               die ("&lt;p&gt;&lt;a href=continue.php&gt;Click here to continue&lt;/a&gt;&lt;/p&gt;");</div><div class="line">          &#125;</div><div class="line">          else die("Invalid username/password combination");</div><div class="line">    &#125;</div><div class="line">    else die("Invalid username/password combination");</div><div class="line">  &#125;</div><div class="line">  else</div><div class="line">  &#123;</div><div class="line">    header('WWW-Authenticate: Basic realm="Restricted Section"');</div><div class="line">    header('HTTP/1.0 401 Unauthorized');</div><div class="line">    die ("Please enter your username and password");</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $connection-&gt;close();</div><div class="line"></div><div class="line">  function mysql_entities_fix_string($connection, $string)</div><div class="line">  &#123;</div><div class="line">    return htmlentities(mysql_fix_string($connection, $string));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  function mysql_fix_string($connection, $string)</div><div class="line">  &#123;</div><div class="line">    if (get_magic_quotes_gpc()) $string = stripslashes($string);</div><div class="line">    return $connection-&gt;real_escape_string($string);</div><div class="line">  &#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>One other addition to the program is the “Click here to continue” link with a destination URL of <em>continue.php</em>. This will be used to illustrate how the session will transfer to another program or PHP web page.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;?php // continue.php</div><div class="line">  session_start();</div><div class="line"></div><div class="line">  if (isset($_SESSION['username']))</div><div class="line">  &#123;</div><div class="line">    $username = $_SESSION['username'];</div><div class="line">    $password = $_SESSION['password'];</div><div class="line">    $forename = $_SESSION['forename'];</div><div class="line">    $surname  = $_SESSION['surname'];</div><div class="line"></div><div class="line">    echo "Welcome back $forename.&lt;br&gt;</div><div class="line">          Your full name is $forename $surname.&lt;br&gt;</div><div class="line">          Your username is '$username'</div><div class="line">          and your password is '$password'.";</div><div class="line">  &#125;</div><div class="line">  else echo "Please &lt;a href='authenticate2.php'&gt;click here&lt;/a&gt; to log in.";</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>Now you are ready to call up <em>authenticate2.php</em> into your browser. Enter a username of <code>bsmith</code> and password of <code>mysecret</code> (or <code>pjones</code> and <code>acrobat</code>) when prompted, and click the link to load in <em>continue.php</em>. </p>
<p><img src="http://johnnyimages.qiniudn.com/php-form-sesstion.png" alt=""></p>
<p>Sessions neatly confine to a single program the extensive code required to authenticate and log in a user. Once a user has been authenticated, and you have created a session, your program code becomes very simple indeed. You need only to call up <code>session_start</code> and look up any variables to which you need access from <code>$_SESSION</code>.</p>
<h3 id="Ending-a-Session"><a href="#Ending-a-Session" class="headerlink" title="Ending a Session"></a>Ending a Session</h3><p>When the time comes to end a session, usually when a user requests to log out from your site, you can use the <code>session_destroy</code> function in association.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">destroy_session_and_data</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    session_start();</div><div class="line">    $_SESSION = <span class="keyword">array</span>();</div><div class="line">    setcookie(session_name(), <span class="string">''</span>, time() - <span class="number">2592000</span>, <span class="string">'/'</span>);</div><div class="line">    session_destroy();</div><div class="line">  &#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>To see this in action, you could modify <em>continue.php</em>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  session_start();</div><div class="line"></div><div class="line">  if (isset($_SESSION[&apos;username&apos;]))</div><div class="line">  &#123;</div><div class="line">    $username = $_SESSION[&apos;username&apos;];</div><div class="line">    $password = $_SESSION[&apos;password&apos;];</div><div class="line">    $forename = $_SESSION[&apos;forename&apos;];</div><div class="line">    $surname  = $_SESSION[&apos;surname&apos;];</div><div class="line"></div><div class="line">    destroy_session_and_data();</div><div class="line"></div><div class="line">    echo &quot;Welcome back $forename.&lt;br&gt;</div><div class="line">          Your full name is $forename $surname.&lt;br&gt;</div><div class="line">          Your username is &apos;$username&apos;</div><div class="line">          and your password is &apos;$password&apos;.&quot;;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  else echo &quot;Please &lt;a href=&apos;authenticate2.php&apos;&gt;click here&lt;/a&gt; to log in.&quot;;</div><div class="line"></div><div class="line">  function destroy_session_and_data()</div><div class="line">  &#123;</div><div class="line">    $_SESSION = array();</div><div class="line">    setcookie(session_name(), &apos;&apos;, time() - 2592000, &apos;/&apos;);</div><div class="line">    session_destroy();</div><div class="line">  &#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>The first time you navigate from <em>authenticate2.php</em> to <em>continue.php</em>, it will display all the session variables. But, because of the call to <code>destroy_session_and_data</code>, if you then click your browser’s Reload button, the session will have been destroyed and you’ll be prompted to return to the login page.</p>
<h3 id="Setting-a-Time-Out"><a href="#Setting-a-Time-Out" class="headerlink" title="Setting a Time-Out"></a>Setting a Time-Out</h3><p>There are other times when you might wish to close a user’s session yourself, such as when the user has forgotten or neglected to log out, and you want the program to do so for her for her own security. You do this by setting the time-out after which a logout will automatically occur if there has been no activity.</p>
<p>To do this, use the <code>ini_set</code> function as follows. This example sets the time-out to exactly one day:</p>
<pre><code>ini_set(&apos;session.gc_maxlifetime&apos;, 60 * 60 * 24);
</code></pre><p>If you wish to know what the current time-out period is, you can display it using the following:</p>
<pre><code>echo ini_get(&apos;session.gc_maxlifetime&apos;);
</code></pre><h3 id="Session-Security"><a href="#Session-Security" class="headerlink" title="Session Security"></a>Session Security</h3><h4 id="Preventing-session-hijacking"><a href="#Preventing-session-hijacking" class="headerlink" title="Preventing session hijacking"></a>Preventing session hijacking</h4><p>When SSL is not a possibility, you can further authenticate users by storing their IP address along with their other details by adding a line such as the following when you store their session:</p>
<pre data-programming-language="perl">
$_SESSION['ip'] = $_SERVER['REMOTE_ADDR'];
</pre>

<p>Then, as an extra check, whenever any page loads and a session is available, perform the following check. It calls the function <code>different_user</code> if the stored IP address doesn’t match the current one:<pre data-programming-language="perl"><br>if ($_SESSION[‘ip’] != $_SERVER[‘REMOTE_ADDR’]) different_user();<br></pre></p>
<p>What code you place in your <code>different_user</code> function is up to you. I recommend that you simply delete the current session and ask the user to log in again due to a technical error. Don’t say any more than that, or you’re giving away potentially useful information.</p>
<p>Of course, you need to be aware that users on the same proxy server, or sharing the same IP address on a home or business network, will have the same IP address. Again, if this is a problem for you, use SSL. You can also store a copy of the browser <em>user agent string</em> (a string that developers put in their browsers to identify them by type and version), which might also distinguish users due to the wide variety of browser types, versions, and computer platforms. Use the following to store the user agent:</p>
<pre><code>$_SESSION[&apos;ua&apos;] = $_SERVER[&apos;HTTP_USER_AGENT&apos;];
</code></pre><p>And use this to compare the current agent string with the saved one:</p>
<pre><code>if ($_SESSION[&apos;ua&apos;] != $_SERVER[&apos;HTTP_USER_AGENT&apos;]) different_user();
</code></pre><p>Or, better still, combine the two checks like this and save the combination as a <code>hash</code> hexadecimal string:</p>
<pre><code>$_SESSION[&apos;check&apos;] = hash(&apos;ripemd128&apos;, $_SERVER[&apos;REMOTE_ADDR&apos;] .
    $_SERVER[&apos;HTTP_USER_AGENT&apos;]);
</code></pre><p>And use this to compare the current and stored strings:</p>
<p>if ($_SESSION[‘check’] != hash(‘ripemd128’, $_SERVER[‘REMOTE_ADDR’] .<br>    $_SERVER[‘HTTP_USER_AGENT’])) different_user();</p>
<h4 id="Preventing-session-fixation"><a href="#Preventing-session-fixation" class="headerlink" title="Preventing session fixation"></a>Preventing session fixation</h4><p><em>Session fixation</em> happens when a malicious user tries to present a session ID to the server rather than letting the server create one. It can happen when a user takes advantage of the ability to pass a session ID in the Get part of a URL, like this:<pre data-programming-language="perl"><br><a href="http://yourserver.com/authenticate.php?PHPSESSID=123456789" target="_blank" rel="external">http://yourserver.com/authenticate.php?PHPSESSID=123456789</a><br></pre></p>
<p>In this example, the made-up session ID of 123456789 is being passed to the server. Now, consider Example 12-9, which is susceptible to session fixation. To see how, type it and save it as <em>sessiontest.php</em>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?php // sessiontest.php</div><div class="line">  session_start();</div><div class="line"></div><div class="line">  if (!isset($_SESSION[&apos;count&apos;])) $_SESSION[&apos;count&apos;] = 0;</div><div class="line">  else ++$_SESSION[&apos;count&apos;];</div><div class="line"></div><div class="line">  echo $_SESSION[&apos;count&apos;];</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>Once it’s saved, call it up in your browser using the following URL (prefacing it with the correct pathname, such as _<a href="http://localhost/web/" target="_blank" rel="external"><em>http://localhost/web/</em></a>_):</p>
<pre><code>sessiontest.php?PHPSESSID=1234
</code></pre><p>Press Reload a few times, and you’ll see the counter increase. Now try browsing to</p>
<pre><code>sessiontest.php?PHPSESSID=5678
</code></pre><p>Press Reload a few times here, and you should see it count up again from 0. Leave the counter on a different number than the first URL and then go back to the first URL and see how the number changes back. You have created two different sessions of your own choosing here, and you could easily create as many as you needed.</p>
<p>The reason this approach is so dangerous is that a malicious attacker could try to distribute these types of URLs to unsuspecting users, and if any of them followed these links, the attacker would be able to come back and take over any sessions that had not been deleted or expired!</p>
<p>To prevent this, add a simple check to change the session ID using <code>session_regenerate_id</code>. This function keeps all current session variable values, but replaces the session ID with a new one that an attacker cannot know.To do this, check for a special session variable that you arbitrarily invent. If it doesn’t exist, you know that this is a new session, so you simply change the session ID and set the special session variable to note the change.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">  session_start();</div><div class="line"></div><div class="line">  if (!isset($_SESSION[&apos;initiated&apos;]))</div><div class="line">  &#123;</div><div class="line">    session_regenerate_id();</div><div class="line">    $_SESSION[&apos;initiated&apos;] = 1;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if (!isset($_SESSION[&apos;count&apos;])) $_SESSION[&apos;count&apos;] = 0;</div><div class="line">  else ++$_SESSION[&apos;count&apos;];</div><div class="line"></div><div class="line">  echo $_SESSION[&apos;count&apos;];</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>This way, an attacker can come back to your site using any of the session IDs that he or she generated, but none of them will call up another user’s session, as they will all have been replaced with regenerated IDs. If you want to be ultra-paranoid, you can even regenerate the session ID on each request.</p>
<h3 id="Forcing-cookie-only-sessions"><a href="#Forcing-cookie-only-sessions" class="headerlink" title="Forcing cookie-only sessions"></a>Forcing cookie-only sessions</h3><p>If you are prepared to require your users to enable cookies on your website, you can use the <code>ini_set</code> function, like this:</p>
<p>ini_set(‘session.use_only_cookies’, 1);</p>
<p>With that setting, the <code>?PHPSESSID=</code> trick will be completely ignored. If you use this security measure, I also recommend that you inform your users that your site requires cookies, so they know what’s wrong if they don’t get the results they want.</p>
<h3 id="Using-a-shared-server"><a href="#Using-a-shared-server" class="headerlink" title="Using a shared server"></a>Using a shared server</h3><p>On a server shared with other accounts, you will not want to have all your session data saved into the same directory as theirs. Instead, you should choose a directory to which only your account has access (and that is not web-visible) to store your sessions, by placing an <code>ini_set</code> call near the start of a program, like this:</p>
<pre><code>ini_set(&apos;session.save_path&apos;, &apos;/home/user/myaccount/sessions&apos;);
</code></pre><p>The configuration option will keep this new value only during the program’s execution, and the original configuration will be restored at the program’s ending.</p>
<p>This sessions folder can fill up quickly; you may wish to periodically clear out older sessions according to how busy your server gets. The more it’s used, the less time you will want to keep a session stored.</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-11-05T08:22:17.000Z" itemprop="dateUpdated">2017-11-05 16:22:17</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/PHP/2015-05-27-php-form.html" target="_blank" rel="external">http://blog.inching.org/PHP/2015-05-27-php-form.html</a>
        
    </div>
    <footer>
        <a href="http://blog.inching.org">
            <img src="/img/avatar.png" alt="Cody Fei">
            Cody Fei
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-27-php-form.html&title=《PHP Form》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-27-php-form.html&title=《PHP Form》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Ret..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-27-php-form.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP Form》 — Balance&url=http://blog.inching.org/PHP/2015-05-27-php-form.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-27-php-form.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/PHP/2015-05-28-php-components.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">PHP Components</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/PHP/2015-05-27-php-mysql.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">PHP MySQL</h4>
      </a>
    </div>
  
</nav>



    











</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.JPG" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.JPG" data-alipay="/img/alipay.JPG">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top" style="display:none">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Cody Fei &copy; 2012 - 2017</span>
            <span style="display:none">
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.inching.org/PHP/2015-05-27-php-form.html&title=《PHP Form》 — Balance&pic=http://blog.inching.org/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.inching.org/PHP/2015-05-27-php-form.html&title=《PHP Form》 — Balance&source=See 《Modern PHP》 and 《Learning PHP, MySQL &amp; JavaScript, 4th Edition》.
Ret..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.inching.org/PHP/2015-05-27-php-form.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《PHP Form》 — Balance&url=http://blog.inching.org/PHP/2015-05-27-php-form.html&via=http://blog.inching.org" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.inching.org/PHP/2015-05-27-php-form.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3aO3LDMAwFQN//0kqTIjMZUw+AXJhcVRlHFrkqaPxer/i6/ly9+/9/9909+SrlCwMD42sZ1/JaL7BeeP2Ed/9df/52RQwMjAMYySbyg7V3QFfXxcDAwMgDu+TYzUNADAwMjGcP3Op21+wk9cXAwDiZkSSxSfK5Bj/1fAwMjNMYTyWZn/j7I/0NDAyMr2JcxWsSCK6T4d5+fr+LgYGxNeOpBLWaduahYWH4AwMDY2tGHhRWk9I8re21EJqxLQYGxlcxetZquW1SPkvKcBgYGHsz8kNzfbIlod4DG13/GGBgYGzNqIaAvfp872nVUBUDA2M/xqT0Xz1SJ8NnN2wMDIytGZOhimqhLbkzH027+ZHAwMDYlPFUktlrEsxfCgYGxsmMXno5CRYfiHYxMDA2ZeTh2nqxyfGah4AYGBinMfLC/STJrMLKbVEMDIwDGJOCV7NrGmOaMyMYGBgbMXoBWW+0Yj6QcdPyxMDAOIAxL80nwxP5E5o9WAwMjO0Y1QGL6raazchqiwIDA+MARh609dqNveGM/BMMDIzTGNXN9YpoeRC5xmBgYOzNuIpXL3zMy3C914qBgbE3o9dcnKS+yWH9VFKNgYGxE2MSulWbl0kCXB31wMDAOIeRH3yTZHXy/JtXg4GBgREPe1WHKpJAsDAtgoGBgRGEaEmI2SvY3bwaDAyMAxjV5T9R7auGkhgYGOcw8tRxEjJ+DoOBgbE14we3pGqYSehwtQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.17"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.17" async></script>










</body>
</html>
